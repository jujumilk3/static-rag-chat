import{c as Jo,l as Wo,a as L,m as Ho,d as it,o as F,f as U}from"../chunks/DQQpVooK.js";import{i as Vt}from"../chunks/DDxtbRRp.js";import{o as Go}from"../chunks/CxCM4Tq1.js";import{I as _o,h as Oe,J as an,l as r,ah as $o,L as Yo,_ as Gn,Y as Kt,aa as Qt,e as zt,K as Qo,af as Xo,X as $n,c as Nt,a as nn,b2 as It,b as Mn,b3 as Zo,s as qo,at as er,aR as tr,ad as Dn,b4 as nr,b5 as or,aM as N,G as Yn,b6 as rr,r as yo,p as wo,b7 as pn,b8 as ir,ac as sr,d as ar,a8 as lr,a6 as bo,b9 as So,F as cr,ba as dr,bb as ur,a1 as fr,aE as hr,bc as pr,H as vr,aB as mr,bd as gr,aN as _r,i as K,D as yr,be as wr,v as jt,y as Bt,n as ne,z as m,B as _,A as v,w as Ee,aP as xo,bf as br,x as ue,bg as on,Z as ln,ao as p,bh as ht,bi as Sr,bj as Qn}from"../chunks/Ct7evnEA.js";import{l as rt,p as w,s as _t,i as ve,b as xr}from"../chunks/CiDdCK_m.js";import{a as Xn,b as Ze,c as rn,r as gt,i as Zn,d as qn,e as Cr}from"../chunks/BZXTrd9i.js";import{s as V}from"../chunks/BEjHsQSY.js";import{B as kr}from"../chunks/uC2UA348.js";function Ot(n,e){return e}function Ir(n,e,t){for(var o=[],i=e.length,s,l=e.length,d=0;d<i;d++){let g=e[d];wo(g,()=>{if(s){if(s.pending.delete(g),s.done.add(g),s.pending.size===0){var f=n.outrogroups;En(Dn(s.done)),f.delete(s),f.size===0&&(n.outrogroups=null)}}else l-=1},!1)}if(l===0){var c=o.length===0&&t!==null;if(c){var a=t,h=a.parentNode;sr(h),h.append(a),n.items.clear()}En(e,!c)}else s={pending:new Set(e),done:new Set},(n.outrogroups??=new Set).add(s)}function En(n,e=!0){for(var t=0;t<n.length;t++)ar(n[t],e)}var eo;function Et(n,e,t,o,i,s=null){var l=n,d=new Map,c=(e&So)!==0;if(c){var a=n;l=Oe?Kt(bo(a)):a.appendChild(nn())}Oe&&an();var h=null,g=er(()=>{var I=t();return tr(I)?I:I==null?[]:Dn(I)}),f,x=!0;function T(){y.fallback=h,Ar(y,f,l,e,o),h!==null&&(f.length===0?(h.f&It)===0?yo(h):(h.f^=It,Yt(h,null,l)):wo(h,()=>{h=null}))}var C=_o(()=>{f=r(g);var I=f.length;let E=!1;if(Oe){var O=$o(l)===Yo;O!==(I===0)&&(l=Gn(),Kt(l),Qt(!1),E=!0)}for(var M=new Set,z=Nt,b=qo(),k=0;k<I;k+=1){Oe&&zt.nodeType===Qo&&zt.data===Xo&&(l=zt,E=!0,Qt(!1));var A=f[k],me=o(A,k),G=x?null:d.get(me);G?(G.v&&$n(G.v,A),G.i&&$n(G.i,k),b&&z.unskip_effect(G.e)):(G=Tr(d,x?l:eo??=nn(),A,me,k,i,e,t),x||(G.e.f|=It),d.set(me,G)),M.add(me)}if(I===0&&s&&!h&&(x?h=Mn(()=>s(l)):(h=Mn(()=>s(eo??=nn())),h.f|=It)),I>M.size&&Zo(),Oe&&I>0&&Kt(Gn()),!x)if(b){for(const[we,se]of d)M.has(we)||z.skip_effect(se.e);z.oncommit(T),z.ondiscard(()=>{})}else T();E&&Qt(!0),r(g)}),y={effect:C,items:d,outrogroups:null,fallback:h};x=!1,Oe&&(l=zt)}function $t(n){for(;n!==null&&(n.f&ir)===0;)n=n.next;return n}function Ar(n,e,t,o,i){var s=(o&dr)!==0,l=e.length,d=n.items,c=$t(n.effect.first),a,h=null,g,f=[],x=[],T,C,y,I;if(s)for(I=0;I<l;I+=1)T=e[I],C=i(T,I),y=d.get(C).e,(y.f&It)===0&&(y.nodes?.a?.measure(),(g??=new Set).add(y));for(I=0;I<l;I+=1){if(T=e[I],C=i(T,I),y=d.get(C).e,n.outrogroups!==null)for(const G of n.outrogroups)G.pending.delete(y),G.done.delete(y);if((y.f&It)!==0)if(y.f^=It,y===c)Yt(y,null,t);else{var E=h?h.next:c;y===n.effect.last&&(n.effect.last=y.prev),y.prev&&(y.prev.next=y.next),y.next&&(y.next.prev=y.prev),At(n,h,y),At(n,y,E),Yt(y,E,t),h=y,f=[],x=[],c=$t(h.next);continue}if((y.f&pn)!==0&&(yo(y),s&&(y.nodes?.a?.unfix(),(g??=new Set).delete(y))),y!==c){if(a!==void 0&&a.has(y)){if(f.length<x.length){var O=x[0],M;h=O.prev;var z=f[0],b=f[f.length-1];for(M=0;M<f.length;M+=1)Yt(f[M],O,t);for(M=0;M<x.length;M+=1)a.delete(x[M]);At(n,z.prev,b.next),At(n,h,z),At(n,b,O),c=O,h=b,I-=1,f=[],x=[]}else a.delete(y),Yt(y,c,t),At(n,y.prev,y.next),At(n,y,h===null?n.effect.first:h.next),At(n,h,y),h=y;continue}for(f=[],x=[];c!==null&&c!==y;)(a??=new Set).add(c),x.push(c),c=$t(c.next);if(c===null)continue}(y.f&It)===0&&f.push(y),h=y,c=$t(y.next)}if(n.outrogroups!==null){for(const G of n.outrogroups)G.pending.size===0&&(En(Dn(G.done)),n.outrogroups?.delete(G));n.outrogroups.size===0&&(n.outrogroups=null)}if(c!==null||a!==void 0){var k=[];if(a!==void 0)for(y of a)(y.f&pn)===0&&k.push(y);for(;c!==null;)(c.f&pn)===0&&c!==n.fallback&&k.push(c),c=$t(c.next);var A=k.length;if(A>0){var me=(o&So)!==0&&l===0?t:null;if(s){for(I=0;I<A;I+=1)k[I].nodes?.a?.measure();for(I=0;I<A;I+=1)k[I].nodes?.a?.fix()}Ir(n,k,me)}}s&&cr(()=>{if(g!==void 0)for(y of g)y.nodes?.a?.apply()})}function Tr(n,e,t,o,i,s,l,d){var c=(l&nr)!==0?(l&or)===0?N(t,!1,!1):Yn(t):null,a=(l&rr)!==0?Yn(i):null;return{v:c,i:a,e:Mn(()=>(s(e,c??t,a??i,d),()=>{n.delete(o)}))}}function Yt(n,e,t){if(n.nodes)for(var o=n.nodes.start,i=n.nodes.end,s=e&&(e.f&It)===0?e.nodes.start:t;o!==null;){var l=lr(o);if(s.before(o),o===i)return;o=l}}function At(n,e,t){e===null?n.effect.first=t:e.next=t,t===null?n.effect.last=e:t.prev=e}function pt(n,e,t,o,i){Oe&&an();var s=e.$$slots?.[t],l=!1;s===!0&&(s=e.children,l=!0),s===void 0||s(n,l?()=>o:o)}function Mr(n,e,t,o,i,s){let l=Oe;Oe&&an();var d=null;Oe&&zt.nodeType===ur&&(d=zt,an());var c=Oe?zt:n,a=new kr(c,!1);_o(()=>{const h=e()||null;var g=pr;if(h===null){a.ensure(null,null);return}return a.ensure(h,f=>{if(h){if(d=Oe?d:hr(h,g),Jo(d,d),o){Oe&&Wo(h)&&d.append(document.createComment(""));var x=Oe?bo(d):d.appendChild(nn());Oe&&(x===null?Qt(!1):Kt(x)),o(d,x)}vr.nodes.end=d,f.before(d)}Oe&&Kt(f)}),()=>{}},fr),mr(()=>{}),l&&(Qt(!0),Kt(c))}function Ct(n,e,t=e){var o=new WeakSet;gr(n,"input",async i=>{var s=i?n.defaultValue:n.value;if(s=vn(n)?mn(s):s,t(s),Nt!==null&&o.add(Nt),await _r(),s!==(s=e())){var l=n.selectionStart,d=n.selectionEnd,c=n.value.length;if(n.value=s??"",d!==null){var a=n.value.length;l===d&&d===c&&a>c?(n.selectionStart=a,n.selectionEnd=a):(n.selectionStart=l,n.selectionEnd=Math.min(d,a))}}}),(Oe&&n.defaultValue!==n.value||K(e)==null&&n.value)&&(t(vn(n)?mn(n.value):n.value),Nt!==null&&o.add(Nt)),yr(()=>{var i=e();if(n===document.activeElement){var s=wr??Nt;if(o.has(s))return}vn(n)&&i===mn(n.value)||n.type==="date"&&!i&&!n.value||i!==n.value&&(n.value=i??"")})}function vn(n){var e=n.type;return e==="number"||e==="range"}function mn(n){return n===""?null:+n}const Lt={openai:"gpt-4.1-mini",anthropic:"claude-3-5-sonnet-latest",gemini:"gemini-2.0-flash"},kt={openai:"OpenAI",anthropic:"Claude (Anthropic)",gemini:"Gemini (Google)"};function Co(n){return Array.isArray(n)?n.map(e=>{if(typeof e=="string")return e;if(e&&typeof e=="object"){const t=(typeof e.id=="string"&&e.id)??(typeof e.name=="string"&&e.name)??"";return typeof t=="string"?t:""}return""}).filter(Boolean):[]}function Er(n){const e=n.toLowerCase().trim(),t=e.startsWith("ft:")?e.slice(3):e;return["instruct","whisper","tts","speech","audio","image","search","realtime","transcribe","transcription","embedding","moderation","text-","dall-e","dalle","sora","davinci","babbage","curie","ada"].some(i=>t.includes(i))?!1:/^(gpt-(4|5|3\.5|oss)|chatgpt-|o[1-9])/.test(t)}function Rr(n){return Array.isArray(n)?n.map(e=>{if(!e||typeof e!="object")return"";const t=e,o=typeof t.name=="string"?t.name:"";return(Array.isArray(t.supportedGenerationMethods)?t.supportedGenerationMethods:[]).some(l=>typeof l=="string"&&l==="generateContent")?o.startsWith("models/")?o.slice(7):o:""}).filter(Boolean):[]}function Fn(n){const e=new Set;return n.map(o=>o.trim()).filter(o=>o.length>0).filter(o=>{const i=o.toLowerCase();return e.has(i)?!1:(e.add(i),!0)}).sort((o,i)=>o.localeCompare(i))}const Lr={openai:"",anthropic:"",gemini:""};function gn(n){return Lr[n]?.trim()??""}async function zr(n,e){if(!e.trim())return[];switch(n){case"openai":return Pr(e);case"anthropic":return Or(e);case"gemini":return Dr(e);default:return[]}}async function Pr(n){const e=await fetch("https://api.openai.com/v1/models",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}}),t=await Jt(e,"openai"),o=Co(t?.data).filter(Er);return Fn(o)}async function Or(n){const e=await fetch("https://api.anthropic.com/v1/models",{method:"GET",headers:{"x-api-key":n,"anthropic-version":"2023-06-01","anthropic-dangerous-direct-browser-access":"true"}}),t=await Jt(e,"anthropic"),o=Co(t?.data);return Fn(o)}async function Dr(n){const e=await fetch(`https://generativelanguage.googleapis.com/v1/models?key=${encodeURIComponent(n)}`,{method:"GET",headers:{"Content-Type":"application/json"}}),t=await Jt(e,"gemini"),o=Rr(t?.models);return Fn(o)}function Fr(n){if(typeof n!="object"||n===null)return null;const e=n;if(typeof e.error=="string")return e.error;if(typeof e.message=="string")return e.message;if(typeof e.error=="object"&&e.error!==null){const t=e.error;if(typeof t.message=="string")return t.message}return null}async function Nr(n){try{return await n.json()}catch{return null}}async function Jt(n,e){const t=await Nr(n);if(!n.ok){const o=Fr(t)??`HTTP ${n.status}`;throw new Error(`${kt[e]} request failed: ${o}`)}return t}async function Kr(n){const e=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.apiKey}`},body:JSON.stringify({model:n.model,messages:n.messages,temperature:n.temperature??.2,max_tokens:n.maxTokens??1e3}),signal:n.signal}),t=await Jt(e,"openai"),l=(Array.isArray(t.choices)?t.choices:[])[0]?.message?.content;if(typeof l=="string"&&l.trim())return l;if(Array.isArray(l)){const d=l.map(c=>{if(typeof c=="object"&&c!==null&&"text"in c){const a=c.text;return typeof a=="string"?a:""}return""}).filter(Boolean).join(`
`);if(d.trim())return d}throw new Error("OpenAI response did not include text content.")}async function Ur(n){const e=n.messages.filter(d=>d.role==="system").map(d=>d.content).join(`

`),t=n.messages.filter(d=>d.role!=="system").map(d=>({role:d.role==="assistant"?"assistant":"user",content:[{type:"text",text:d.content}]})),o=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":n.apiKey,"anthropic-version":"2023-06-01","anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify({model:n.model,system:e,messages:t,temperature:n.temperature??.2,max_tokens:n.maxTokens??1e3}),signal:n.signal}),i=await Jt(o,"anthropic"),l=(Array.isArray(i.content)?i.content:[]).map(d=>{if(typeof d=="object"&&d!==null){const c=d;if(c.type==="text"&&typeof c.text=="string")return c.text}return""}).filter(Boolean).join(`
`);if(!l.trim())throw new Error("Claude response did not include text content.");return l}async function Vr(n){const e=n.messages.filter(f=>f.role==="system").map(f=>f.content).join(`

`),t=n.messages.filter(f=>f.role!=="system").map(f=>({role:f.role==="assistant"?"model":"user",parts:[{text:f.content}]})),o=`https://generativelanguage.googleapis.com/v1beta/models/${encodeURIComponent(n.model)}:generateContent?key=${encodeURIComponent(n.apiKey)}`,i={contents:t,generationConfig:{temperature:n.temperature??.2,maxOutputTokens:n.maxTokens??1e3}};e.trim()&&(i.systemInstruction={parts:[{text:e}]});const s=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i),signal:n.signal}),l=await Jt(s,"gemini"),a=(Array.isArray(l.candidates)?l.candidates:[])[0]?.content,g=(Array.isArray(a?.parts)?a?.parts:[]).map(f=>{if(typeof f=="object"&&f!==null&&"text"in f){const x=f.text;return typeof x=="string"?x:""}return""}).filter(Boolean).join(`
`);if(!g.trim())throw new Error("Gemini response did not include text content.");return g}async function jr(n){if(!n.apiKey.trim())throw new Error("API key is required.");if(!n.model.trim())throw new Error("Model is required.");switch(n.provider){case"openai":return Kr(n);case"anthropic":return Ur(n);case"gemini":return Vr(n);default:throw new Error(`Unsupported provider: ${n.provider}`)}}const Br={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const Jr=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0;return!1};const to=(...n)=>n.filter((e,t,o)=>!!e&&e.trim()!==""&&o.indexOf(e)===t).join(" ").trim();var Wr=Ho("<svg><!><!></svg>");function yt(n,e){const t=rt(e,["children","$$slots","$$events","$$legacy"]),o=rt(t,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);jt(e,!1);let i=w(e,"name",8,void 0),s=w(e,"color",8,"currentColor"),l=w(e,"size",8,24),d=w(e,"strokeWidth",8,2),c=w(e,"absoluteStrokeWidth",8,!1),a=w(e,"iconNode",24,()=>[]);Vt();var h=Wr();Xn(h,(x,T,C)=>({...Br,...x,...o,width:l(),height:l(),stroke:s(),"stroke-width":T,class:C}),[()=>Jr(o)?void 0:{"aria-hidden":"true"},()=>(ne(c()),ne(d()),ne(l()),K(()=>c()?Number(d())*24/Number(l()):d())),()=>(ne(to),ne(i()),ne(t),K(()=>to("lucide-icon","lucide",i()?`lucide-${i()}`:"",t.class)))]);var g=m(h);Et(g,1,a,Ot,(x,T)=>{var C=xo(()=>br(r(T),2));let y=()=>r(C)[0],I=()=>r(C)[1];var E=it(),O=Ee(E);Mr(O,y,!0,(M,z)=>{Xn(M,()=>({...I()}))}),L(x,E)});var f=_(g);pt(f,e,"default",{}),v(h),L(n,h),Bt()}function Hr(n,e){const t=rt(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M20 6 9 17l-5-5"}]];yt(n,_t({name:"check"},()=>t,{get iconNode(){return o},children:(i,s)=>{var l=it(),d=Ee(l);pt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}function Gr(n,e){const t=rt(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M4 5h16"}],["path",{d:"M4 12h16"}],["path",{d:"M4 19h16"}]];yt(n,_t({name:"menu"},()=>t,{get iconNode(){return o},children:(i,s)=>{var l=it(),d=Ee(l);pt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}function $r(n,e){const t=rt(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"}]];yt(n,_t({name:"moon"},()=>t,{get iconNode(){return o},children:(i,s)=>{var l=it(),d=Ee(l);pt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}function ko(n,e){const t=rt(e,["children","$$slots","$$events","$$legacy"]);const o=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"}],["path",{d:"M9 3v18"}],["path",{d:"m16 15-3-3 3-3"}]];yt(n,_t({name:"panel-left-close"},()=>t,{get iconNode(){return o},children:(i,s)=>{var l=it(),d=Ee(l);pt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}function Yr(n,e){const t=rt(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];yt(n,_t({name:"pencil"},()=>t,{get iconNode(){return o},children:(i,s)=>{var l=it(),d=Ee(l);pt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}function Qr(n,e){const t=rt(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M5 12h14"}],["path",{d:"M12 5v14"}]];yt(n,_t({name:"plus"},()=>t,{get iconNode(){return o},children:(i,s)=>{var l=it(),d=Ee(l);pt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}function Xr(n,e){const t=rt(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]];yt(n,_t({name:"send"},()=>t,{get iconNode(){return o},children:(i,s)=>{var l=it(),d=Ee(l);pt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}function Zr(n,e){const t=rt(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915"}],["circle",{cx:"12",cy:"12",r:"3"}]];yt(n,_t({name:"settings"},()=>t,{get iconNode(){return o},children:(i,s)=>{var l=it(),d=Ee(l);pt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}function qr(n,e){const t=rt(e,["children","$$slots","$$events","$$legacy"]);const o=[["circle",{cx:"12",cy:"12",r:"4"}],["path",{d:"M12 2v2"}],["path",{d:"M12 20v2"}],["path",{d:"m4.93 4.93 1.41 1.41"}],["path",{d:"m17.66 17.66 1.41 1.41"}],["path",{d:"M2 12h2"}],["path",{d:"M20 12h2"}],["path",{d:"m6.34 17.66-1.41 1.41"}],["path",{d:"m19.07 4.93-1.41 1.41"}]];yt(n,_t({name:"sun"},()=>t,{get iconNode(){return o},children:(i,s)=>{var l=it(),d=Ee(l);pt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}function ei(n,e){const t=rt(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M10 11v6"}],["path",{d:"M14 11v6"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}],["path",{d:"M3 6h18"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}]];yt(n,_t({name:"trash-2"},()=>t,{get iconNode(){return o},children:(i,s)=>{var l=it(),d=Ee(l);pt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}function Nn(n,e){const t=rt(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]];yt(n,_t({name:"x"},()=>t,{get iconNode(){return o},children:(i,s)=>{var l=it(),d=Ee(l);pt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}var ti=U('<div class="notice warning"><span>You must enter an API key before sending messages.</span> <button type="button">Open Settings</button></div>'),ni=U('<article class="starter-card"><span> </span> <small> </small></article>'),oi=U("<p>There are currently no documents in this Static Rag Chat payload.</p>"),ri=U('<section class="empty-state"><h3>Loaded documents in Static Rag Chat</h3> <p>These documents are embedded in the current payload and available for retrieval in this session.</p> <div class="starter-grid"><!></div></section>'),ii=U('<article><div class="message-avatar"> </div> <div class="message-bubble"><div class="message-meta"><strong> </strong> <span> </span></div> <p> </p></div></article>'),si=U('<article class="message-row assistant"><div class="message-avatar">AI</div> <div class="message-bubble typing"><div class="message-meta"><strong>Assistant</strong> <span>Thinking...</span></div> <div class="typing-indicator" aria-hidden="true"><span></span> <span></span> <span></span></div></div></article>'),ai=U('<button type="button" class="danger">Stop</button>'),li=U('<section class="chat-column"><header class="chat-header"><button type="button" class="icon-btn mobile-menu-btn" aria-label="Toggle side menu"><!></button> <div class="chat-title"><p class="kicker">Conversation</p> <h2> </h2> <p class="chat-subtitle"> </p></div> <div class="chat-toolbar"><span> </span> <span class="chat-pill"> </span> <button type="button" class="chat-pill ghost mobile-pill-btn mobile-toolbar-btn">New</button> <button type="button" class="chat-pill ghost mobile-pill-btn mobile-toolbar-btn"> </button></div></header> <!> <div class="message-stream" aria-live="polite"><!> <!> <!></div> <form class="composer"><textarea rows="3" placeholder="Ask about this shared Static Rag Chat context... (Enter send / Shift+Enter newline)"></textarea> <div class="composer-foot"><p>Context-aware responses combine multi-turn history with retrieved chunks.</p> <div class="composer-actions"><!> <button type="submit" class="send-btn"><span> </span> <!></button></div></div></form></section>');function ci(n,e){jt(e,!1);let t=w(e,"mobileLeftRailOpen",8),o=w(e,"activeSessionTitle",8),i=w(e,"payloadTitle",8),s=w(e,"hasApiKey",8),l=w(e,"providerLabel",8),d=w(e,"hasConversation",8),c=w(e,"chatMessages",24,()=>[]),a=w(e,"canSend",8,!1),h=w(e,"loading",8,!1),g=w(e,"prompt",8,""),f=w(e,"mobileContextOpen",8,!1),x=w(e,"ragDocs",24,()=>[]),T=w(e,"formatMessageTime",8),C=w(e,"onToggleLeftRail",8),y=w(e,"onClearChat",8),I=w(e,"onToggleContext",8),E=w(e,"onOpenSettings",8),O=w(e,"onSubmit",8),M=w(e,"onPromptInput",8),z=w(e,"onPromptKeydown",8),b=w(e,"onStopGeneration",8),k=w(e,"bindComposerTextarea",12);Vt();var A=li(),me=m(A),G=m(me),we=m(G);{var se=D=>{ko(D,{size:18})},Ie=D=>{Gr(D,{size:18})};ve(we,D=>{t()?D(se):D(Ie,!1)})}v(G);var Z=_(G,2),oe=_(m(Z),2),Fe=m(oe,!0);v(oe);var st=_(oe,2),at=m(st);v(st),v(Z);var Je=_(Z,2),Ae=m(Je),lt=m(Ae,!0);v(Ae);var We=_(Ae,2),Ve=m(We,!0);v(We);var He=_(We,2),Ge=_(He,2),J=m(Ge,!0);v(Ge),v(Je),v(me);var W=_(me,2);{var ee=D=>{var $=ti(),Le=_(m($),2);v($),F("click",Le,()=>E()("connection")),L(D,$)};ve(W,D=>{s()||D(ee)})}var ke=_(W,2),$e=m(ke);{var Ne=D=>{var $=ri(),Le=_(m($),4),vt=m(Le);{var X=H=>{var te=it(),xe=Ee(te);Et(xe,1,x,Ot,(he,ae,re)=>{var Y=ni(),ie=m(Y),P=m(ie);v(ie);var ce=_(ie,2),_e=m(ce);v(ce),v(Y),ue(Q=>{V(P,`${re+1}. ${r(ae),K(()=>r(ae).title)??""}`),V(_e,`${Q??""}${r(ae),K(()=>r(ae).content.length>240?"…":"")??""}`)},[()=>(r(ae),K(()=>r(ae).content.slice(0,240)))]),L(he,Y)}),L(H,te)},fe=H=>{var te=oi();L(H,te)};ve(vt,H=>{ne(x()),K(()=>x().length>0)?H(X):H(fe,!1)})}v(Le),v($),L(D,$)};ve($e,D=>{d()||D(Ne)})}var Te=_($e,2);Et(Te,1,c,Ot,(D,$)=>{var Le=ii(),vt=m(Le),X=m(vt,!0);v(vt);var fe=_(vt,2),H=m(fe),te=m(H),xe=m(te,!0);v(te);var he=_(te,2),ae=m(he,!0);v(he),v(H);var re=_(H,2),Y=m(re,!0);v(re),v(fe),v(Le),ue(ie=>{Ze(Le,1,`message-row ${r($),K(()=>r($).role)??""} ${r($),K(()=>r($).isError?"message-error":"")??""}`),V(X,(r($),K(()=>r($).role==="user"?"ME":"AI"))),V(xe,(r($),K(()=>r($).role==="user"?"You":r($).isError?"System Error":"Assistant"))),V(ae,ie),V(Y,(r($),K(()=>r($).content)))},[()=>(ne(T()),r($),K(()=>T()(r($).createdAt)))]),L(D,Le)});var Me=_(Te,2);{var ge=D=>{var $=si();L(D,$)};ve(Me,D=>{h()&&D(ge)})}v(ke);var be=_(ke,2),Se=m(be);on(Se),xr(Se,D=>k(D),()=>k());var qe=_(Se,2),je=_(m(qe),2),Re=m(je);{var wt=D=>{var $=ai();F("click",$,function(...Le){b()?.apply(this,Le)}),L(D,$)};ve(Re,D=>{h()&&D(wt)})}var Be=_(Re,2),ct=m(Be),Ke=m(ct,!0);v(ct);var dt=_(ct,2);Xr(dt,{size:16}),v(Be),v(je),v(qe),v(be),v(A),ue(()=>{V(Fe,o()),V(at,`${i()??""} · ${s()?"API key loaded":"API key required"} · ${ne(d()),ne(c()),K(()=>d()?`${c().length} messages`:"empty conversation")??""}`),Ze(Ae,1,`chat-pill ${s()?"chat-pill-ok":"chat-pill-warn"}`),V(lt,s()?"API Connected":"API Missing"),V(Ve,l()),V(J,f()?"Close Context":"Context"),rn(Se,g()),Be.disabled=!a(),V(Ke,h()?"Sending...":"Send Message")}),F("click",G,function(...D){C()?.apply(this,D)}),F("click",He,function(...D){y()?.apply(this,D)}),F("click",Ge,function(...D){I()?.apply(this,D)}),F("input",Se,function(...D){M()?.apply(this,D)}),F("compositionend",Se,function(...D){M()?.apply(this,D)}),F("keydown",Se,function(...D){z()?.apply(this,D)}),F("submit",be,function(...D){O()?.apply(this,D)}),L(n,A),Bt()}var di=U('<div class="mobile-context-head"><h3>Session Context</h3> <button type="button" class="icon-btn" aria-label="Close context sheet"><!></button></div>'),ui=U('<button type="button" class="ghost mini-btn"> </button>'),fi=U('<p class="panel-empty">Send a message to show matched document chunks here.</p>'),hi=U('<article class="retrieval-item"><div class="retrieval-head"><strong> </strong> <span> </span></div> <p> </p></article>'),pi=U('<div class="retrieval-list"></div>'),vi=U('<p class="panel-meta"> </p> <!>',1),mi=U('<p class="error"> </p>'),gi=U('<p class="status"> </p>'),_i=U('<p class="panel-empty">No recent status.</p>'),yi=U('<aside><!> <section class="context-card"><h3>Session</h3> <p>Provider: <strong> </strong></p> <p>Model: <strong> </strong></p> <p>API Key: <strong> </strong></p> <div class="rail-inline-actions"><button type="button" class="ghost">Manage</button></div></section> <section class="context-card"><div class="card-head"><h3>Retrieved Context</h3> <!></div> <!></section> <section class="context-card"><h3>Activity</h3> <!></section></aside>');function wi(n,e){jt(e,!1);let t=w(e,"isNarrowViewport",8),o=w(e,"mobileContextOpen",8),i=w(e,"retrievedChunks",24,()=>[]),s=w(e,"showRetrievedContext",8),l=w(e,"providerLabel",8),d=w(e,"model",8),c=w(e,"hasApiKey",8),a=w(e,"payloadError",8),h=w(e,"status",8),g=w(e,"onClose",8),f=w(e,"onToggleRetrievedContext",8),x=w(e,"onOpenSettings",8);Vt();var T=yi();let C;var y=m(T);{var I=J=>{var W=di(),ee=_(m(W),2),ke=m(ee);Nn(ke,{size:16}),v(ee),v(W),F("click",ee,function(...$e){g()?.apply(this,$e)}),L(J,W)};ve(y,J=>{t()&&J(I)})}var E=_(y,2),O=_(m(E),2),M=_(m(O)),z=m(M,!0);v(M),v(O);var b=_(O,2),k=_(m(b)),A=m(k,!0);v(k),v(b);var me=_(b,2),G=_(m(me)),we=m(G,!0);v(G),v(me);var se=_(me,2),Ie=m(se);v(se),v(E);var Z=_(E,2),oe=m(Z),Fe=_(m(oe),2);{var st=J=>{var W=ui(),ee=m(W,!0);v(W),ue(()=>V(ee,s()?"Hide":"Show")),F("click",W,function(...ke){f()?.apply(this,ke)}),L(J,W)};ve(Fe,J=>{ne(i()),K(()=>i().length>0)&&J(st)})}v(oe);var at=_(oe,2);{var Je=J=>{var W=fi();L(J,W)},Ae=J=>{var W=vi(),ee=Ee(W),ke=m(ee);v(ee);var $e=_(ee,2);{var Ne=Te=>{var Me=pi();Et(Me,5,i,Ot,(ge,be,Se)=>{var qe=hi(),je=m(qe),Re=m(je),wt=m(Re);v(Re);var Be=_(Re,2),ct=m(Be,!0);v(Be),v(je);var Ke=_(je,2),dt=m(Ke,!0);v(Ke),v(qe),ue(D=>{V(wt,`${Se+1}. ${r(be),K(()=>r(be).docTitle)??""}`),V(ct,D),V(dt,(r(be),K(()=>r(be).content)))},[()=>(r(be),K(()=>r(be).score.toFixed(3)))]),L(ge,qe)}),v(Me),L(Te,Me)};ve($e,Te=>{s()&&Te(Ne)})}ue(()=>V(ke,`${ne(i()),K(()=>i().length)??""} chunk(s) selected`)),L(J,W)};ve(at,J=>{ne(i()),K(()=>i().length===0)?J(Je):J(Ae,!1)})}v(Z);var lt=_(Z,2),We=_(m(lt),2);{var Ve=J=>{var W=mi(),ee=m(W,!0);v(W),ue(()=>V(ee,a())),L(J,W)},He=J=>{var W=gi(),ee=m(W,!0);v(W),ue(()=>V(ee,h())),L(J,W)},Ge=J=>{var W=_i();L(J,W)};ve(We,J=>{a()?J(Ve):h()?J(He,1):J(Ge,!1)})}v(lt),v(T),ue(()=>{C=Ze(T,1,"context-column",null,C,{"mobile-open":o()&&t()}),V(z,l()),V(A,d()),V(we,c()?"Loaded":"Missing")}),F("click",Ie,()=>x()("connection")),L(n,T),Bt()}var bi=U('<p class="rail-note">No conversation yet. Start a new chat.</p>'),Si=U('<div class="session-edit"><input type="text" class="session-title-input"/> <button type="button" class="icon-btn mini-btn session-rename-confirm" aria-label="Save title"><!></button> <button type="button" class="icon-btn mini-btn" aria-label="Cancel rename"><!></button></div>'),xi=U('<button type="button" class="session-btn"><span class="session-title"> </span> <span class="session-meta"> </span></button> <div class="session-actions"><button type="button" class="icon-btn mini-btn" aria-label="Rename chat"><!></button> <button type="button" class="icon-btn mini-btn session-delete danger" aria-label="Delete chat"><!></button></div>',1),Ci=U("<div><!></div>"),ki=U('<div class="session-list"></div>'),Ii=U('<aside><button type="button" class="icon-btn rail-toggle" aria-label="Close side menu"><!></button> <div class="rail-content"><div class="brand"><p class="kicker">Static Rag Chat</p> <h1 class="rail-label">Static Rag Chat</h1> <p class="rail-note">Share one URL + your own API key so anyone can run the same Static Rag Chat session.</p></div> <div class="rail-actions"><button type="button"><span class="rail-icon" aria-hidden="true"><!></span> <span class="rail-label">New Chat</span></button> <button type="button" class="ghost"><span class="rail-icon" aria-hidden="true"><!></span> <span class="rail-label">Settings</span></button> <button type="button" class="ghost"><span class="rail-icon" aria-hidden="true"><!></span> <span class="rail-label"> </span></button></div> <section class="rail-card primary"><h2> </h2> <p> </p> <div class="chip-row"><span> </span> <span> </span></div></section> <section class="rail-card"><div class="card-head"><h3>Chat List</h3> <span class="pill"> </span></div> <!></section> <section class="rail-card"><div class="card-head"><h3>Share Bundle</h3> <span> </span></div> <p class="rail-note">Pack the RAG payload into the URL hash to share and deploy directly.</p> <div class="rail-inline-actions"><button type="button" class="ghost">Copy URL</button> <button type="button" class="ghost">RAG</button></div> <p class="rail-meta"> </p></section></div></aside>');function Ai(n,e){jt(e,!1);let t=w(e,"mobileOpen",8),o=w(e,"payloadTitle",8),i=w(e,"docCount",8),s=w(e,"docChars",8),l=w(e,"providerLabel",8),d=w(e,"model",8),c=w(e,"chatSessions",24,()=>[]),a=w(e,"activeSessionId",8),h=w(e,"urlRisk",8,"ok"),g=w(e,"urlLength",8),f=w(e,"encodedLength",8),x=w(e,"theme",8),T=w(e,"formatMessageTime",8),C=w(e,"onStartNewSession",8),y=w(e,"onCloseMobileRail",8),I=w(e,"onOpenSettings",8),E=w(e,"onToggleTheme",8),O=w(e,"onSetActiveSession",8),M=w(e,"onDeleteSession",8),z=w(e,"onRenameSession",8),b=w(e,"onCopyShareUrl",8),k=N(""),A=N("");function me(){y()()}function G(P,ce,_e){P.preventDefault(),P.stopPropagation(),p(k,ce),p(A,_e)}function we(P){P&&(P.preventDefault(),P.stopPropagation()),p(k,""),p(A,"")}function se(P,ce){if(P.preventDefault(),P.stopPropagation(),r(k)!==ce)return;const _e=r(A).trim();if(!_e){we();return}z()(ce,_e),p(k,""),p(A,"")}function Ie(P,ce){P.key==="Enter"&&(P.preventDefault(),se(P,ce)),P.key==="Escape"&&(P.preventDefault(),we())}Vt();var Z=Ii();let oe;var Fe=m(Z),st=m(Fe);ko(st,{size:18}),v(Fe);var at=_(Fe,2),Je=_(m(at),2),Ae=m(Je),lt=m(Ae),We=m(lt);Qr(We,{size:16}),v(lt),ln(2),v(Ae);var Ve=_(Ae,2),He=m(Ve),Ge=m(He);Zr(Ge,{size:16}),v(He),ln(2),v(Ve);var J=_(Ve,2),W=m(J),ee=m(W);{var ke=P=>{qr(P,{size:16})},$e=P=>{$r(P,{size:16})};ve(ee,P=>{x()==="dark"?P(ke):P($e,!1)})}v(W);var Ne=_(W,2),Te=m(Ne,!0);v(Ne),v(J),v(Je);var Me=_(Je,2),ge=m(Me),be=m(ge,!0);v(ge);var Se=_(ge,2),qe=m(Se);v(Se);var je=_(Se,2),Re=m(je),wt=m(Re,!0);v(Re);var Be=_(Re,2),ct=m(Be,!0);v(Be),v(je),v(Me);var Ke=_(Me,2),dt=m(Ke),D=_(m(dt),2),$=m(D,!0);v(D),v(dt);var Le=_(dt,2);{var vt=P=>{var ce=bi();L(P,ce)},X=P=>{var ce=ki();Et(ce,5,c,_e=>_e.id,(_e,Q)=>{var et=Ci(),mt=m(et);{var ut=ze=>{var Ye=Si(),le=m(Ye);gt(le);var Ue=_(le,2),Qe=m(Ue);Hr(Qe,{size:13}),v(Ue);var tt=_(Ue,2),q=m(tt);Nn(q,{size:13}),v(tt),v(Ye),Ct(le,()=>r(A),j=>p(A,j)),F("focus",le,j=>j.currentTarget.select()),F("keydown",le,j=>Ie(j,r(Q).id)),F("focusout",le,j=>se(j,r(Q).id)),F("click",Ue,j=>se(j,r(Q).id)),F("click",tt,we),L(ze,Ye)},bt=ze=>{var Ye=xi(),le=Ee(Ye),Ue=m(le),Qe=m(Ue,!0);v(Ue);var tt=_(Ue,2),q=m(tt);v(tt),v(le);var j=_(le,2),pe=m(j),St=m(pe);Yr(St,{size:13}),v(pe);var ye=_(pe,2),xt=m(ye);ei(xt,{size:14}),v(ye),v(j),ue(nt=>{V(Qe,(r(Q),K(()=>r(Q).title))),V(q,`${r(Q),K(()=>r(Q).messages.length)??""} msgs · ${nt??""}`)},[()=>(ne(T()),r(Q),K(()=>T()(r(Q).updatedAt)))]),F("click",le,()=>O()(r(Q).id)),F("click",pe,nt=>G(nt,r(Q).id,r(Q).title)),F("click",ye,nt=>M()(nt,r(Q).id)),L(ze,Ye)};ve(mt,ze=>{r(k),r(Q),K(()=>r(k)===r(Q).id)?ze(ut):ze(bt,!1)})}v(et),ue(()=>Ze(et,1,`session-item ${ne(a()),r(Q),K(()=>a()===r(Q).id?"active":"")??""}`)),L(_e,et)}),v(ce),L(P,ce)};ve(Le,P=>{ne(c()),K(()=>c().length===0)?P(vt):P(X,!1)})}v(Ke);var fe=_(Ke,2),H=m(fe),te=_(m(H),2),xe=m(te,!0);v(te),v(H);var he=_(H,4),ae=m(he),re=_(ae,2);v(he);var Y=_(he,2),ie=m(Y);v(Y),v(fe),v(at),v(Z),ue((P,ce,_e)=>{oe=Ze(Z,1,"left-rail",null,oe,{"mobile-open":t()}),V(Te,x()==="dark"?"Switch Light":"Switch Dark"),V(be,o()),V(qe,`${i()??""} docs · ${P??""} chars`),V(wt,l()),V(ct,d()),V($,(ne(c()),K(()=>c().length))),Ze(te,1,`pill ${h()??""}`),V(xe,h()==="ok"?"Stable":h()==="warn"?"Long":"Risky"),V(ie,`URL length ${ce??""} / payload ${_e??""}`)},[()=>(ne(s()),K(()=>s().toLocaleString())),()=>(ne(g()),K(()=>g().toLocaleString())),()=>(ne(f()),K(()=>f().toLocaleString()))]),F("click",Fe,me),F("click",Ae,function(...P){C()?.apply(this,P)}),F("click",Ve,()=>I()("connection")),F("click",J,function(...P){E()?.apply(this,P)}),F("click",ae,function(...P){b()?.apply(this,P)}),F("click",re,()=>I()("data")),L(n,Z),Bt()}var Ti=U('<p class="error"> </p>'),Mi=U('<p class="error"> </p>'),Ei=U('<p class="status"> </p>'),Ri=U('<div class="settings-alert-stack"><!> <!></div>'),Li=U("<option> </option>"),zi=U('<input type="text" disabled=""/>'),Pi=U("<option> </option>"),Oi=U("<option> </option>"),Di=U("<select><!><!></select>"),Fi=U('<input type="text"/>'),Ni=U(`<div class="panel-block"><h3>Provider & Model</h3> <div class="theme-row"><span class="theme-label">Theme</span> <div class="theme-options"><button type="button">Light</button> <button type="button">Dark</button></div></div> <label>Provider <select></select></label> <label>API key (saved in localStorage) <input type="password" placeholder="Paste your API key"/></label> <label class="toggle-field"><span><input type="checkbox" aria-label="Save API key in this browser"/> Save API key in localStorage</span> <small class="caution">Notice: localStorage is stored only in this browser. Disable saving on shared computers and delete
							it after use.</small></label> <label>Model <!></label> <div class="actions"><button type="button" class="ghost"> </button></div></div>`),Ki=U('<div class="panel-block"><h3>System Prompt</h3> <label>Chat title <input type="text"/></label> <label>System prompt <textarea rows="4"></textarea></label> <div class="actions"><button type="button">Apply Settings</button></div></div>'),Ui=U('<article><div class="doc-head"><strong> </strong> <button type="button" class="danger">Remove</button></div> <p> </p></article>'),Vi=U('<div class="panel-block"><h3>Documents</h3> <p class="help"> </p> <div class="doc-list"></div> <label>New document title (optional) <input type="text" placeholder="Example: Product FAQ"/></label> <label>New document content <textarea rows="5" placeholder="Paste source text here"></textarea></label> <div class="actions"><button type="button">Add Document</button></div> <label>Import files (.txt, .md, .json) <input type="file" multiple="" accept=".txt,.md,.json"/></label> <label>Import from shared URL/hash <input type="text" placeholder="https://.../#r=... or #r=..."/></label> <div class="actions"><button type="button" class="ghost">Import URL Payload</button></div></div> <div class="panel-block"><h3>Retrieval Settings</h3> <div class="retrieval-grid"><label>Top K <input type="number" min="1" max="12"/></label> <label>Chunk size <input type="number" min="200" max="4000" step="50"/></label> <label>Overlap <input type="number" min="0" max="2000" step="10"/></label></div> <div class="actions"><button type="button">Apply Settings</button></div></div> <div class="panel-block"><h3>Advanced JSON</h3> <textarea rows="12" spellcheck="false"></textarea> <div class="actions"><button type="button">Apply JSON</button> <button type="button" class="ghost">Reset Sample</button></div></div>',1),ji=U('<div role="presentation"><div role="dialog" aria-modal="true" aria-label="Settings"><header class="drawer-head"><div><p class="kicker">Configuration</p> <h2>Settings</h2></div> <button type="button" class="icon-btn" aria-label="Close settings"><!></button></header> <nav class="tab-row" aria-label="settings tabs"><button type="button">Connection</button> <button type="button">System Prompt</button> <button type="button">RAG</button></nav> <div class="tab-panel"><!> <!></div></div></div>');function Bi(n,e){jt(e,!1);let t=w(e,"settingsOpen",8,!1),o=w(e,"settingsPresentation",8,"modal"),i=w(e,"settingsTab",8,"connection"),s=w(e,"providers",24,()=>[]),l=w(e,"provider",8,"openai"),d=w(e,"theme",8,"light"),c=w(e,"model",8,""),a=w(e,"modelOptions",24,()=>[]),h=w(e,"isModelCatalogLoading",8,!1),g=w(e,"modelCatalogError",8,""),f=w(e,"apiKey",8,""),x=w(e,"persistApiKey",8,!1),T=w(e,"payloadError",8,""),C=w(e,"status",8,""),y=w(e,"titleInput",12,""),I=w(e,"systemPromptInput",12,""),E=w(e,"topKInput",12,1),O=w(e,"chunkSizeInput",12,500),M=w(e,"overlapInput",12,100),z=w(e,"newDocTitle",12,""),b=w(e,"newDocContent",12,""),k=w(e,"importUrl",12,""),A=w(e,"payloadJson",12,""),me=w(e,"docCount",8,0),G=w(e,"docChars",8,0),we=w(e,"docs",24,()=>[]),se=w(e,"onClose",8),Ie=w(e,"onSetTheme",8),Z=w(e,"onSelectTab",8),oe=w(e,"onProviderChange",8),Fe=w(e,"onApiKeyInput",8),st=w(e,"onApiKeySaveToggle",8),at=w(e,"onModelInput",8),Je=w(e,"onRefreshModels",8),Ae=w(e,"onApplyBuilderSettings",8),lt=w(e,"onAddDocument",8),We=w(e,"onRemoveDocument",8),Ve=w(e,"onFileInput",8),He=w(e,"onApplyImportUrl",8),Ge=w(e,"onApplyPayloadJson",8),J=w(e,"onResetPayload",8);function W(X){X.target===X.currentTarget&&se()()}Vt();var ee=ji();let ke;var $e=m(ee);let Ne;var Te=m($e),Me=_(m(Te),2),ge=m(Me);Nn(ge,{size:18}),v(Me),v(Te);var be=_(Te,2),Se=m(be);let qe;var je=_(Se,2);let Re;var wt=_(je,2);let Be;v(be);var ct=_(be,2),Ke=m(ct);{var dt=X=>{var fe=Ri(),H=m(fe);{var te=re=>{var Y=Ti(),ie=m(Y,!0);v(Y),ue(()=>V(ie,g())),L(re,Y)};ve(H,re=>{i()==="connection"&&g()&&re(te)})}var xe=_(H,2);{var he=re=>{var Y=Mi(),ie=m(Y,!0);v(Y),ue(()=>V(ie,T())),L(re,Y)},ae=re=>{var Y=Ei(),ie=m(Y,!0);v(Y),ue(()=>V(ie,C())),L(re,Y)};ve(xe,re=>{T()?re(he):C()&&re(ae,1)})}v(fe),L(X,fe)};ve(Ke,X=>{(i()==="connection"&&g()||T()||C())&&X(dt)})}var D=_(Ke,2);{var $=X=>{var fe=Ni(),H=_(m(fe),2),te=_(m(H),2),xe=m(te);let he;var ae=_(xe,2);let re;v(te),v(H);var Y=_(H,2),ie=_(m(Y));Et(ie,5,s,Ot,(q,j)=>{var pe=Li(),St=m(pe,!0);v(pe);var ye={};ue(()=>{V(St,(ne(kt),r(j),K(()=>kt[r(j)]))),ye!==(ye=r(j))&&(pe.value=(pe.__value=r(j))??"")}),L(q,pe)}),v(ie);var P;Zn(ie),v(Y);var ce=_(Y,2),_e=_(m(ce));gt(_e),v(ce);var Q=_(ce,2),et=m(Q),mt=m(et);gt(mt),ln(),v(et),ln(2),v(Q);var ut=_(Q,2),bt=_(m(ut));{var ze=q=>{var j=zi();gt(j),ue(()=>rn(j,c())),L(q,j)},Ye=q=>{var j=Di(),pe=m(j);Et(pe,1,a,Ot,(ft,ot)=>{var de=Pi(),Xe=m(de,!0);v(de);var Dt={};ue(()=>{V(Xe,r(ot)),Dt!==(Dt=r(ot))&&(de.value=(de.__value=r(ot))??"")}),L(ft,de)});var St=_(pe);{var ye=ft=>{var ot=Oi(),de=m(ot,!0);v(ot);var Xe={};ue(()=>{V(de,c()),Xe!==(Xe=c())&&(ot.value=(ot.__value=c())??"")}),L(ft,ot)},xt=xo(()=>(ne(c()),ne(a()),K(()=>c()&&!a().includes(c()))));ve(St,ft=>{r(xt)&&ft(ye)})}v(j);var nt;Zn(j),ue(()=>{nt!==(nt=c())&&(j.value=(j.__value=c())??"",qn(j,c()))}),F("change",j,function(...ft){at()?.apply(this,ft)}),L(q,j)},le=q=>{var j=Fi();gt(j),ue(()=>rn(j,c())),F("input",j,function(...pe){at()?.apply(this,pe)}),L(q,j)};ve(bt,q=>{h()?q(ze):(ne(a()),K(()=>a().length>0)?q(Ye,1):q(le,!1))})}v(ut);var Ue=_(ut,2),Qe=m(Ue),tt=m(Qe,!0);v(Qe),v(Ue),v(fe),ue(()=>{he=Ze(xe,1,"ghost theme-option",null,he,{"selected-theme":d()==="light"}),re=Ze(ae,1,"ghost theme-option",null,re,{"selected-theme":d()==="dark"}),P!==(P=l())&&(ie.value=(ie.__value=l())??"",qn(ie,l())),rn(_e,f()),Cr(mt,x()),Qe.disabled=h(),V(tt,h()?"Loading models…":"Refresh model list")}),F("click",xe,()=>Ie()("light")),F("click",ae,()=>Ie()("dark")),F("change",ie,function(...q){oe()?.apply(this,q)}),F("input",_e,function(...q){Fe()?.apply(this,q)}),F("change",mt,function(...q){st()?.apply(this,q)}),F("click",Qe,function(...q){Je()?.apply(this,q)}),L(X,fe)},Le=X=>{var fe=Ki(),H=_(m(fe),2),te=_(m(H));gt(te),v(H);var xe=_(H,2),he=_(m(xe));on(he),v(xe);var ae=_(xe,2),re=m(ae);v(ae),v(fe),Ct(te,y),Ct(he,I),F("click",re,function(...Y){Ae()?.apply(this,Y)}),L(X,fe)},vt=X=>{var fe=Vi(),H=Ee(fe),te=_(m(H),2),xe=m(te);v(te);var he=_(te,2);Et(he,5,we,Ot,(de,Xe,Dt)=>{var Wt=Ui(),Ht=m(Wt),Gt=m(Ht),dn=m(Gt);v(Gt);var un=_(Gt,2);v(Ht);var Xt=_(Ht,2),fn=m(Xt);v(Xt),v(Wt),ue(Zt=>{V(dn,`${Dt+1}. ${r(Xe),K(()=>r(Xe).title)??""}`),V(fn,`${Zt??""}${r(Xe),K(()=>r(Xe).content.length>220?"...":"")??""}`)},[()=>(r(Xe),K(()=>r(Xe).content.slice(0,220)))]),F("click",un,()=>We()(r(Xe).id)),L(de,Wt)}),v(he);var ae=_(he,2),re=_(m(ae));gt(re),v(ae);var Y=_(ae,2),ie=_(m(Y));on(ie),v(Y);var P=_(Y,2),ce=m(P);v(P);var _e=_(P,2),Q=_(m(_e));v(_e);var et=_(_e,2),mt=_(m(et));gt(mt),v(et);var ut=_(et,2),bt=m(ut);v(ut),v(H);var ze=_(H,2),Ye=_(m(ze),2),le=m(Ye),Ue=_(m(le));gt(Ue),v(le);var Qe=_(le,2),tt=_(m(Qe));gt(tt),v(Qe);var q=_(Qe,2),j=_(m(q));gt(j),v(q),v(Ye);var pe=_(Ye,2),St=m(pe);v(pe),v(ze);var ye=_(ze,2),xt=_(m(ye),2);on(xt);var nt=_(xt,2),ft=m(nt),ot=_(ft,2);v(nt),v(ye),ue(de=>V(xe,`${me()??""} doc(s), ${de??""} characters`),[()=>(ne(G()),K(()=>G().toLocaleString()))]),Ct(re,z),Ct(ie,b),F("click",ce,function(...de){lt()?.apply(this,de)}),F("change",Q,function(...de){Ve()?.apply(this,de)}),Ct(mt,k),F("click",bt,function(...de){He()?.apply(this,de)}),Ct(Ue,E),Ct(tt,O),Ct(j,M),F("click",St,function(...de){Ae()?.apply(this,de)}),Ct(xt,A),F("click",ft,function(...de){Ge()?.apply(this,de)}),F("click",ot,function(...de){J()?.apply(this,de)}),L(X,fe)};ve(D,X=>{i()==="connection"?X($):i()==="systemPrompt"?X(Le,1):X(vt,!1)})}v(ct),v($e),v(ee),ue(()=>{ke=Ze(ee,1,"settings-drawer-backdrop",null,ke,{open:t(),modal:o()==="modal"}),Ne=Ze($e,1,"settings-drawer",null,Ne,{open:t(),modal:o()==="modal",drawer:o()==="drawer"}),qe=Ze(Se,1,"",null,qe,{selected:i()==="connection"}),Re=Ze(je,1,"",null,Re,{selected:i()==="systemPrompt"}),Be=Ze(wt,1,"",null,Be,{selected:i()==="data"})}),F("click",Me,function(...X){se()?.apply(this,X)}),F("click",Se,()=>Z()("connection")),F("click",je,()=>Z()("systemPrompt")),F("click",wt,()=>Z()("data")),F("click",ee,W),L(n,ee),Bt()}var _n={exports:{}},no;function Ji(){return no||(no=1,(function(n){var e=(function(){var t=String.fromCharCode,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function l(c,a){if(!s[c]){s[c]={};for(var h=0;h<c.length;h++)s[c][c.charAt(h)]=h}return s[c][a]}var d={compressToBase64:function(c){if(c==null)return"";var a=d._compress(c,6,function(h){return o.charAt(h)});switch(a.length%4){default:case 0:return a;case 1:return a+"===";case 2:return a+"==";case 3:return a+"="}},decompressFromBase64:function(c){return c==null?"":c==""?null:d._decompress(c.length,32,function(a){return l(o,c.charAt(a))})},compressToUTF16:function(c){return c==null?"":d._compress(c,15,function(a){return t(a+32)})+" "},decompressFromUTF16:function(c){return c==null?"":c==""?null:d._decompress(c.length,16384,function(a){return c.charCodeAt(a)-32})},compressToUint8Array:function(c){for(var a=d.compress(c),h=new Uint8Array(a.length*2),g=0,f=a.length;g<f;g++){var x=a.charCodeAt(g);h[g*2]=x>>>8,h[g*2+1]=x%256}return h},decompressFromUint8Array:function(c){if(c==null)return d.decompress(c);for(var a=new Array(c.length/2),h=0,g=a.length;h<g;h++)a[h]=c[h*2]*256+c[h*2+1];var f=[];return a.forEach(function(x){f.push(t(x))}),d.decompress(f.join(""))},compressToEncodedURIComponent:function(c){return c==null?"":d._compress(c,6,function(a){return i.charAt(a)})},decompressFromEncodedURIComponent:function(c){return c==null?"":c==""?null:(c=c.replace(/ /g,"+"),d._decompress(c.length,32,function(a){return l(i,c.charAt(a))}))},compress:function(c){return d._compress(c,16,function(a){return t(a)})},_compress:function(c,a,h){if(c==null)return"";var g,f,x={},T={},C="",y="",I="",E=2,O=3,M=2,z=[],b=0,k=0,A;for(A=0;A<c.length;A+=1)if(C=c.charAt(A),Object.prototype.hasOwnProperty.call(x,C)||(x[C]=O++,T[C]=!0),y=I+C,Object.prototype.hasOwnProperty.call(x,y))I=y;else{if(Object.prototype.hasOwnProperty.call(T,I)){if(I.charCodeAt(0)<256){for(g=0;g<M;g++)b=b<<1,k==a-1?(k=0,z.push(h(b)),b=0):k++;for(f=I.charCodeAt(0),g=0;g<8;g++)b=b<<1|f&1,k==a-1?(k=0,z.push(h(b)),b=0):k++,f=f>>1}else{for(f=1,g=0;g<M;g++)b=b<<1|f,k==a-1?(k=0,z.push(h(b)),b=0):k++,f=0;for(f=I.charCodeAt(0),g=0;g<16;g++)b=b<<1|f&1,k==a-1?(k=0,z.push(h(b)),b=0):k++,f=f>>1}E--,E==0&&(E=Math.pow(2,M),M++),delete T[I]}else for(f=x[I],g=0;g<M;g++)b=b<<1|f&1,k==a-1?(k=0,z.push(h(b)),b=0):k++,f=f>>1;E--,E==0&&(E=Math.pow(2,M),M++),x[y]=O++,I=String(C)}if(I!==""){if(Object.prototype.hasOwnProperty.call(T,I)){if(I.charCodeAt(0)<256){for(g=0;g<M;g++)b=b<<1,k==a-1?(k=0,z.push(h(b)),b=0):k++;for(f=I.charCodeAt(0),g=0;g<8;g++)b=b<<1|f&1,k==a-1?(k=0,z.push(h(b)),b=0):k++,f=f>>1}else{for(f=1,g=0;g<M;g++)b=b<<1|f,k==a-1?(k=0,z.push(h(b)),b=0):k++,f=0;for(f=I.charCodeAt(0),g=0;g<16;g++)b=b<<1|f&1,k==a-1?(k=0,z.push(h(b)),b=0):k++,f=f>>1}E--,E==0&&(E=Math.pow(2,M),M++),delete T[I]}else for(f=x[I],g=0;g<M;g++)b=b<<1|f&1,k==a-1?(k=0,z.push(h(b)),b=0):k++,f=f>>1;E--,E==0&&(E=Math.pow(2,M),M++)}for(f=2,g=0;g<M;g++)b=b<<1|f&1,k==a-1?(k=0,z.push(h(b)),b=0):k++,f=f>>1;for(;;)if(b=b<<1,k==a-1){z.push(h(b));break}else k++;return z.join("")},decompress:function(c){return c==null?"":c==""?null:d._decompress(c.length,32768,function(a){return c.charCodeAt(a)})},_decompress:function(c,a,h){var g=[],f=4,x=4,T=3,C="",y=[],I,E,O,M,z,b,k,A={val:h(0),position:a,index:1};for(I=0;I<3;I+=1)g[I]=I;for(O=0,z=Math.pow(2,2),b=1;b!=z;)M=A.val&A.position,A.position>>=1,A.position==0&&(A.position=a,A.val=h(A.index++)),O|=(M>0?1:0)*b,b<<=1;switch(O){case 0:for(O=0,z=Math.pow(2,8),b=1;b!=z;)M=A.val&A.position,A.position>>=1,A.position==0&&(A.position=a,A.val=h(A.index++)),O|=(M>0?1:0)*b,b<<=1;k=t(O);break;case 1:for(O=0,z=Math.pow(2,16),b=1;b!=z;)M=A.val&A.position,A.position>>=1,A.position==0&&(A.position=a,A.val=h(A.index++)),O|=(M>0?1:0)*b,b<<=1;k=t(O);break;case 2:return""}for(g[3]=k,E=k,y.push(k);;){if(A.index>c)return"";for(O=0,z=Math.pow(2,T),b=1;b!=z;)M=A.val&A.position,A.position>>=1,A.position==0&&(A.position=a,A.val=h(A.index++)),O|=(M>0?1:0)*b,b<<=1;switch(k=O){case 0:for(O=0,z=Math.pow(2,8),b=1;b!=z;)M=A.val&A.position,A.position>>=1,A.position==0&&(A.position=a,A.val=h(A.index++)),O|=(M>0?1:0)*b,b<<=1;g[x++]=t(O),k=x-1,f--;break;case 1:for(O=0,z=Math.pow(2,16),b=1;b!=z;)M=A.val&A.position,A.position>>=1,A.position==0&&(A.position=a,A.val=h(A.index++)),O|=(M>0?1:0)*b,b<<=1;g[x++]=t(O),k=x-1,f--;break;case 2:return y.join("")}if(f==0&&(f=Math.pow(2,T),T++),g[k])C=g[k];else if(k===x)C=E+E.charAt(0);else return null;y.push(C),g[x++]=E+C.charAt(0),f--,E=C,f==0&&(f=Math.pow(2,T),T++)}}};return d})();n!=null?n.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})(_n)),_n.exports}var Io=Ji();const oo=1,Rn="r",sn={topK:4,chunkSize:800,overlap:120},Wi=`Static Rag Chat is a static chat app that compresses RAG documents into a URL hash for sharing.
Context data travels inside the shared URL, and each user can reproduce the same session by entering their own API key locally in the browser.
The key idea is that one URL can share the same contextual conversation without running any backend.`;function yn(){return{v:1,title:"Static Rag Chat",systemPrompt:"You are a helpful assistant. Prefer answers grounded in the provided context. If the context is insufficient, clearly say what is missing.",docs:[{id:"doc-1",title:"About Static Rag Chat",content:Wi}],retrieval:{...sn}}}function Hi(n,e){const t=typeof n=="object"&&n!==null?n:{},o=typeof t.id=="string"&&t.id.trim()?t.id.trim():`doc-${e+1}`,i=typeof t.title=="string"&&t.title.trim()?t.title.trim():`Document ${e+1}`,s=typeof t.content=="string"?t.content.trim():"";return{id:o,title:i,content:s}}function Pt(n){if(typeof n!="object"||n===null)throw new Error("Payload must be a JSON object.");const e=n,o=(Array.isArray(e.docs)?e.docs:[]).map((x,T)=>Hi(x,T)).filter(x=>x.content.length>0),i=typeof e.retrieval=="object"&&e.retrieval!==null?e.retrieval:{},s=Number(i.topK),l=Number(i.chunkSize),d=Number(i.overlap),c=Number.isFinite(s)?Math.min(Math.max(Math.floor(s),1),12):sn.topK,a=Number.isFinite(l)&&l>=200?Math.min(Math.floor(l),4e3):sn.chunkSize,h=Number.isFinite(d)&&d>=0?Math.min(Math.floor(d),Math.floor(a/2)):sn.overlap,g=Number(e.v),f=Number.isFinite(g)?Math.floor(g):oo;if(f!==oo)throw new Error(`Unsupported payload version: ${f}`);return{v:1,title:typeof e.title=="string"&&e.title.trim()?e.title.trim():"Static Rag Chat",systemPrompt:typeof e.systemPrompt=="string"?e.systemPrompt.trim():"",docs:o,retrieval:{topK:c,chunkSize:a,overlap:h}}}function Ao(n){const e=Pt(n),t=JSON.stringify(e),o=Io.compressToEncodedURIComponent(t);if(!o)throw new Error("Failed to encode payload.");return o}function Gi(n){const e=Io.decompressFromEncodedURIComponent(n);if(!e)throw new Error("Invalid encoded payload.");const t=JSON.parse(e);return Pt(t)}function $i(n){const e=n.startsWith("#")?n.slice(1):n;if(!e)return null;const t=new URLSearchParams(e);return t.has(Rn)?t.get(Rn):e}function ro(n){return`#${Rn}=${Ao(n)}`}function io(n){const e=$i(n);if(!e)return{payload:null,error:null};try{return{payload:Gi(e),error:null}}catch(t){return{payload:null,error:t instanceof Error?t.message:"Unable to parse URL payload."}}}function wn(n){return JSON.stringify(n,null,2)}const Yi="ENTRIES",To="KEYS",Mo="VALUES",De="";class bn{constructor(e,t){const o=e._tree,i=Array.from(o.keys());this.set=e,this._type=t,this._path=i.length>0?[{node:o,keys:i}]:[]}next(){const e=this.dive();return this.backtrack(),e}dive(){if(this._path.length===0)return{done:!0,value:void 0};const{node:e,keys:t}=Ft(this._path);if(Ft(t)===De)return{done:!1,value:this.result()};const o=e.get(Ft(t));return this._path.push({node:o,keys:Array.from(o.keys())}),this.dive()}backtrack(){if(this._path.length===0)return;const e=Ft(this._path).keys;e.pop(),!(e.length>0)&&(this._path.pop(),this.backtrack())}key(){return this.set._prefix+this._path.map(({keys:e})=>Ft(e)).filter(e=>e!==De).join("")}value(){return Ft(this._path).node.get(De)}result(){switch(this._type){case Mo:return this.value();case To:return this.key();default:return[this.key(),this.value()]}}[Symbol.iterator](){return this}}const Ft=n=>n[n.length-1],Qi=(n,e,t)=>{const o=new Map;if(e===void 0)return o;const i=e.length+1,s=i+t,l=new Uint8Array(s*i).fill(t+1);for(let d=0;d<i;++d)l[d]=d;for(let d=1;d<s;++d)l[d*i]=d;return Eo(n,e,t,o,l,1,i,""),o},Eo=(n,e,t,o,i,s,l,d)=>{const c=s*l;e:for(const a of n.keys())if(a===De){const h=i[c-1];h<=t&&o.set(d,[n.get(a),h])}else{let h=s;for(let g=0;g<a.length;++g,++h){const f=a[g],x=l*h,T=x-l;let C=i[x];const y=Math.max(0,h-t-1),I=Math.min(l-1,h+t);for(let E=y;E<I;++E){const O=f!==e[E],M=i[T+E]+ +O,z=i[T+E+1]+1,b=i[x+E]+1,k=i[x+E+1]=Math.min(M,z,b);k<C&&(C=k)}if(C>t)continue e}Eo(n.get(a),e,t,o,i,h,l,d+a)}};class Tt{constructor(e=new Map,t=""){this._size=void 0,this._tree=e,this._prefix=t}atPrefix(e){if(!e.startsWith(this._prefix))throw new Error("Mismatched prefix");const[t,o]=cn(this._tree,e.slice(this._prefix.length));if(t===void 0){const[i,s]=Kn(o);for(const l of i.keys())if(l!==De&&l.startsWith(s)){const d=new Map;return d.set(l.slice(s.length),i.get(l)),new Tt(d,e)}}return new Tt(t,e)}clear(){this._size=void 0,this._tree.clear()}delete(e){return this._size=void 0,Xi(this._tree,e)}entries(){return new bn(this,Yi)}forEach(e){for(const[t,o]of this)e(t,o,this)}fuzzyGet(e,t){return Qi(this._tree,e,t)}get(e){const t=Ln(this._tree,e);return t!==void 0?t.get(De):void 0}has(e){const t=Ln(this._tree,e);return t!==void 0&&t.has(De)}keys(){return new bn(this,To)}set(e,t){if(typeof e!="string")throw new Error("key must be a string");return this._size=void 0,Sn(this._tree,e).set(De,t),this}get size(){if(this._size)return this._size;this._size=0;const e=this.entries();for(;!e.next().done;)this._size+=1;return this._size}update(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;const o=Sn(this._tree,e);return o.set(De,t(o.get(De))),this}fetch(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;const o=Sn(this._tree,e);let i=o.get(De);return i===void 0&&o.set(De,i=t()),i}values(){return new bn(this,Mo)}[Symbol.iterator](){return this.entries()}static from(e){const t=new Tt;for(const[o,i]of e)t.set(o,i);return t}static fromObject(e){return Tt.from(Object.entries(e))}}const cn=(n,e,t=[])=>{if(e.length===0||n==null)return[n,t];for(const o of n.keys())if(o!==De&&e.startsWith(o))return t.push([n,o]),cn(n.get(o),e.slice(o.length),t);return t.push([n,e]),cn(void 0,"",t)},Ln=(n,e)=>{if(e.length===0||n==null)return n;for(const t of n.keys())if(t!==De&&e.startsWith(t))return Ln(n.get(t),e.slice(t.length))},Sn=(n,e)=>{const t=e.length;e:for(let o=0;n&&o<t;){for(const s of n.keys())if(s!==De&&e[o]===s[0]){const l=Math.min(t-o,s.length);let d=1;for(;d<l&&e[o+d]===s[d];)++d;const c=n.get(s);if(d===s.length)n=c;else{const a=new Map;a.set(s.slice(d),c),n.set(e.slice(o,o+d),a),n.delete(s),n=a}o+=d;continue e}const i=new Map;return n.set(e.slice(o),i),i}return n},Xi=(n,e)=>{const[t,o]=cn(n,e);if(t!==void 0){if(t.delete(De),t.size===0)Ro(o);else if(t.size===1){const[i,s]=t.entries().next().value;Lo(o,i,s)}}},Ro=n=>{if(n.length===0)return;const[e,t]=Kn(n);if(e.delete(t),e.size===0)Ro(n.slice(0,-1));else if(e.size===1){const[o,i]=e.entries().next().value;o!==De&&Lo(n.slice(0,-1),o,i)}},Lo=(n,e,t)=>{if(n.length===0)return;const[o,i]=Kn(n);o.set(i+e,t),o.delete(i)},Kn=n=>n[n.length-1],Un="or",zo="and",Zi="and_not";class Ut{constructor(e){if(e?.fields==null)throw new Error('MiniSearch: option "fields" must be provided');const t=e.autoVacuum==null||e.autoVacuum===!0?kn:e.autoVacuum;this._options={...Cn,...e,autoVacuum:t,searchOptions:{...so,...e.searchOptions||{}},autoSuggestOptions:{...os,...e.autoSuggestOptions||{}}},this._index=new Tt,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=Pn,this.addFields(this._options.fields)}add(e){const{extractField:t,stringifyField:o,tokenize:i,processTerm:s,fields:l,idField:d}=this._options,c=t(e,d);if(c==null)throw new Error(`MiniSearch: document does not have ID field "${d}"`);if(this._idToShortId.has(c))throw new Error(`MiniSearch: duplicate ID ${c}`);const a=this.addDocumentId(c);this.saveStoredFields(a,e);for(const h of l){const g=t(e,h);if(g==null)continue;const f=i(o(g,h),h),x=this._fieldIds[h],T=new Set(f).size;this.addFieldLength(a,x,this._documentCount-1,T);for(const C of f){const y=s(C,h);if(Array.isArray(y))for(const I of y)this.addTerm(x,a,I);else y&&this.addTerm(x,a,y)}}}addAll(e){for(const t of e)this.add(t)}addAllAsync(e,t={}){const{chunkSize:o=10}=t,i={chunk:[],promise:Promise.resolve()},{chunk:s,promise:l}=e.reduce(({chunk:d,promise:c},a,h)=>(d.push(a),(h+1)%o===0?{chunk:[],promise:c.then(()=>new Promise(g=>setTimeout(g,0))).then(()=>this.addAll(d))}:{chunk:d,promise:c}),i);return l.then(()=>this.addAll(s))}remove(e){const{tokenize:t,processTerm:o,extractField:i,stringifyField:s,fields:l,idField:d}=this._options,c=i(e,d);if(c==null)throw new Error(`MiniSearch: document does not have ID field "${d}"`);const a=this._idToShortId.get(c);if(a==null)throw new Error(`MiniSearch: cannot remove document with ID ${c}: it is not in the index`);for(const h of l){const g=i(e,h);if(g==null)continue;const f=t(s(g,h),h),x=this._fieldIds[h],T=new Set(f).size;this.removeFieldLength(a,x,this._documentCount,T);for(const C of f){const y=o(C,h);if(Array.isArray(y))for(const I of y)this.removeTerm(x,a,I);else y&&this.removeTerm(x,a,y)}}this._storedFields.delete(a),this._documentIds.delete(a),this._idToShortId.delete(c),this._fieldLength.delete(a),this._documentCount-=1}removeAll(e){if(e)for(const t of e)this.remove(t);else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new Tt,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}}discard(e){const t=this._idToShortId.get(e);if(t==null)throw new Error(`MiniSearch: cannot discard document with ID ${e}: it is not in the index`);this._idToShortId.delete(e),this._documentIds.delete(t),this._storedFields.delete(t),(this._fieldLength.get(t)||[]).forEach((o,i)=>{this.removeFieldLength(t,i,this._documentCount,o)}),this._fieldLength.delete(t),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()}maybeAutoVacuum(){if(this._options.autoVacuum===!1)return;const{minDirtFactor:e,minDirtCount:t,batchSize:o,batchWait:i}=this._options.autoVacuum;this.conditionalVacuum({batchSize:o,batchWait:i},{minDirtCount:t,minDirtFactor:e})}discardAll(e){const t=this._options.autoVacuum;try{this._options.autoVacuum=!1;for(const o of e)this.discard(o)}finally{this._options.autoVacuum=t}this.maybeAutoVacuum()}replace(e){const{idField:t,extractField:o}=this._options,i=o(e,t);this.discard(i),this.add(e)}vacuum(e={}){return this.conditionalVacuum(e)}conditionalVacuum(e,t){return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&t,this._enqueuedVacuum!=null?this._enqueuedVacuum:(this._enqueuedVacuum=this._currentVacuum.then(()=>{const o=this._enqueuedVacuumConditions;return this._enqueuedVacuumConditions=Pn,this.performVacuuming(e,o)}),this._enqueuedVacuum)):this.vacuumConditionsMet(t)===!1?Promise.resolve():(this._currentVacuum=this.performVacuuming(e),this._currentVacuum)}async performVacuuming(e,t){const o=this._dirtCount;if(this.vacuumConditionsMet(t)){const i=e.batchSize||zn.batchSize,s=e.batchWait||zn.batchWait;let l=1;for(const[d,c]of this._index){for(const[a,h]of c)for(const[g]of h)this._documentIds.has(g)||(h.size<=1?c.delete(a):h.delete(g));this._index.get(d).size===0&&this._index.delete(d),l%i===0&&await new Promise(a=>setTimeout(a,s)),l+=1}this._dirtCount-=o}await null,this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null}vacuumConditionsMet(e){if(e==null)return!0;let{minDirtCount:t,minDirtFactor:o}=e;return t=t||kn.minDirtCount,o=o||kn.minDirtFactor,this.dirtCount>=t&&this.dirtFactor>=o}get isVacuuming(){return this._currentVacuum!=null}get dirtCount(){return this._dirtCount}get dirtFactor(){return this._dirtCount/(1+this._documentCount+this._dirtCount)}has(e){return this._idToShortId.has(e)}getStoredFields(e){const t=this._idToShortId.get(e);if(t!=null)return this._storedFields.get(t)}search(e,t={}){const{searchOptions:o}=this._options,i={...o,...t},s=this.executeQuery(e,t),l=[];for(const[d,{score:c,terms:a,match:h}]of s){const g=a.length||1,f={id:this._documentIds.get(d),score:c*g,terms:Object.keys(h),queryTerms:a,match:h};Object.assign(f,this._storedFields.get(d)),(i.filter==null||i.filter(f))&&l.push(f)}return e===Ut.wildcard&&i.boostDocument==null||l.sort(lo),l}autoSuggest(e,t={}){t={...this._options.autoSuggestOptions,...t};const o=new Map;for(const{score:s,terms:l}of this.search(e,t)){const d=l.join(" "),c=o.get(d);c!=null?(c.score+=s,c.count+=1):o.set(d,{score:s,terms:l,count:1})}const i=[];for(const[s,{score:l,terms:d,count:c}]of o)i.push({suggestion:s,terms:d,score:l/c});return i.sort(lo),i}get documentCount(){return this._documentCount}get termCount(){return this._index.size}static loadJSON(e,t){if(t==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(e),t)}static async loadJSONAsync(e,t){if(t==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJSAsync(JSON.parse(e),t)}static getDefault(e){if(Cn.hasOwnProperty(e))return xn(Cn,e);throw new Error(`MiniSearch: unknown option "${e}"`)}static loadJS(e,t){const{index:o,documentIds:i,fieldLength:s,storedFields:l,serializationVersion:d}=e,c=this.instantiateMiniSearch(e,t);c._documentIds=qt(i),c._fieldLength=qt(s),c._storedFields=qt(l);for(const[a,h]of c._documentIds)c._idToShortId.set(h,a);for(const[a,h]of o){const g=new Map;for(const f of Object.keys(h)){let x=h[f];d===1&&(x=x.ds),g.set(parseInt(f,10),qt(x))}c._index.set(a,g)}return c}static async loadJSAsync(e,t){const{index:o,documentIds:i,fieldLength:s,storedFields:l,serializationVersion:d}=e,c=this.instantiateMiniSearch(e,t);c._documentIds=await en(i),c._fieldLength=await en(s),c._storedFields=await en(l);for(const[h,g]of c._documentIds)c._idToShortId.set(g,h);let a=0;for(const[h,g]of o){const f=new Map;for(const x of Object.keys(g)){let T=g[x];d===1&&(T=T.ds),f.set(parseInt(x,10),await en(T))}++a%1e3===0&&await Po(0),c._index.set(h,f)}return c}static instantiateMiniSearch(e,t){const{documentCount:o,nextId:i,fieldIds:s,averageFieldLength:l,dirtCount:d,serializationVersion:c}=e;if(c!==1&&c!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");const a=new Ut(t);return a._documentCount=o,a._nextId=i,a._idToShortId=new Map,a._fieldIds=s,a._avgFieldLength=l,a._dirtCount=d||0,a._index=new Tt,a}executeQuery(e,t={}){if(e===Ut.wildcard)return this.executeWildcardQuery(t);if(typeof e!="string"){const f={...t,...e,queries:void 0},x=e.queries.map(T=>this.executeQuery(T,f));return this.combineResults(x,f.combineWith)}const{tokenize:o,processTerm:i,searchOptions:s}=this._options,l={tokenize:o,processTerm:i,...s,...t},{tokenize:d,processTerm:c}=l,g=d(e).flatMap(f=>c(f)).filter(f=>!!f).map(ns(l)).map(f=>this.executeQuerySpec(f,l));return this.combineResults(g,l.combineWith)}executeQuerySpec(e,t){const o={...this._options.searchOptions,...t},i=(o.fields||this._options.fields).reduce((C,y)=>({...C,[y]:xn(o.boost,y)||1}),{}),{boostDocument:s,weights:l,maxFuzzy:d,bm25:c}=o,{fuzzy:a,prefix:h}={...so.weights,...l},g=this._index.get(e.term),f=this.termResults(e.term,e.term,1,e.termBoost,g,i,s,c);let x,T;if(e.prefix&&(x=this._index.atPrefix(e.term)),e.fuzzy){const C=e.fuzzy===!0?.2:e.fuzzy,y=C<1?Math.min(d,Math.round(e.term.length*C)):C;y&&(T=this._index.fuzzyGet(e.term,y))}if(x)for(const[C,y]of x){const I=C.length-e.term.length;if(!I)continue;T?.delete(C);const E=h*C.length/(C.length+.3*I);this.termResults(e.term,C,E,e.termBoost,y,i,s,c,f)}if(T)for(const C of T.keys()){const[y,I]=T.get(C);if(!I)continue;const E=a*C.length/(C.length+I);this.termResults(e.term,C,E,e.termBoost,y,i,s,c,f)}return f}executeWildcardQuery(e){const t=new Map,o={...this._options.searchOptions,...e};for(const[i,s]of this._documentIds){const l=o.boostDocument?o.boostDocument(s,"",this._storedFields.get(i)):1;t.set(i,{score:l,terms:[],match:{}})}return t}combineResults(e,t=Un){if(e.length===0)return new Map;const o=t.toLowerCase(),i=qi[o];if(!i)throw new Error(`Invalid combination operator: ${t}`);return e.reduce(i)||new Map}toJSON(){const e=[];for(const[t,o]of this._index){const i={};for(const[s,l]of o)i[s]=Object.fromEntries(l);e.push([t,i])}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:e,serializationVersion:2}}termResults(e,t,o,i,s,l,d,c,a=new Map){if(s==null)return a;for(const h of Object.keys(l)){const g=l[h],f=this._fieldIds[h],x=s.get(f);if(x==null)continue;let T=x.size;const C=this._avgFieldLength[f];for(const y of x.keys()){if(!this._documentIds.has(y)){this.removeTerm(f,y,t),T-=1;continue}const I=d?d(this._documentIds.get(y),t,this._storedFields.get(y)):1;if(!I)continue;const E=x.get(y),O=this._fieldLength.get(y)[f],M=ts(E,T,this._documentCount,O,C,c),z=o*i*g*I*M,b=a.get(y);if(b){b.score+=z,rs(b.terms,e);const k=xn(b.match,t);k?k.push(h):b.match[t]=[h]}else a.set(y,{score:z,terms:[e],match:{[t]:[h]}})}}return a}addTerm(e,t,o){const i=this._index.fetch(o,co);let s=i.get(e);if(s==null)s=new Map,s.set(t,1),i.set(e,s);else{const l=s.get(t);s.set(t,(l||0)+1)}}removeTerm(e,t,o){if(!this._index.has(o)){this.warnDocumentChanged(t,e,o);return}const i=this._index.fetch(o,co),s=i.get(e);s==null||s.get(t)==null?this.warnDocumentChanged(t,e,o):s.get(t)<=1?s.size<=1?i.delete(e):s.delete(t):s.set(t,s.get(t)-1),this._index.get(o).size===0&&this._index.delete(o)}warnDocumentChanged(e,t,o){for(const i of Object.keys(this._fieldIds))if(this._fieldIds[i]===t){this._options.logger("warn",`MiniSearch: document with ID ${this._documentIds.get(e)} has changed before removal: term "${o}" was not present in field "${i}". Removing a document after it has changed can corrupt the index!`,"version_conflict");return}}addDocumentId(e){const t=this._nextId;return this._idToShortId.set(e,t),this._documentIds.set(t,e),this._documentCount+=1,this._nextId+=1,t}addFields(e){for(let t=0;t<e.length;t++)this._fieldIds[e[t]]=t}addFieldLength(e,t,o,i){let s=this._fieldLength.get(e);s==null&&this._fieldLength.set(e,s=[]),s[t]=i;const d=(this._avgFieldLength[t]||0)*o+i;this._avgFieldLength[t]=d/(o+1)}removeFieldLength(e,t,o,i){if(o===1){this._avgFieldLength[t]=0;return}const s=this._avgFieldLength[t]*o-i;this._avgFieldLength[t]=s/(o-1)}saveStoredFields(e,t){const{storeFields:o,extractField:i}=this._options;if(o==null||o.length===0)return;let s=this._storedFields.get(e);s==null&&this._storedFields.set(e,s={});for(const l of o){const d=i(t,l);d!==void 0&&(s[l]=d)}}}Ut.wildcard=Symbol("*");const xn=(n,e)=>Object.prototype.hasOwnProperty.call(n,e)?n[e]:void 0,qi={[Un]:(n,e)=>{for(const t of e.keys()){const o=n.get(t);if(o==null)n.set(t,e.get(t));else{const{score:i,terms:s,match:l}=e.get(t);o.score=o.score+i,o.match=Object.assign(o.match,l),ao(o.terms,s)}}return n},[zo]:(n,e)=>{const t=new Map;for(const o of e.keys()){const i=n.get(o);if(i==null)continue;const{score:s,terms:l,match:d}=e.get(o);ao(i.terms,l),t.set(o,{score:i.score+s,terms:i.terms,match:Object.assign(i.match,d)})}return t},[Zi]:(n,e)=>{for(const t of e.keys())n.delete(t);return n}},es={k:1.2,b:.7,d:.5},ts=(n,e,t,o,i,s)=>{const{k:l,b:d,d:c}=s;return Math.log(1+(t-e+.5)/(e+.5))*(c+n*(l+1)/(n+l*(1-d+d*o/i)))},ns=n=>(e,t,o)=>{const i=typeof n.fuzzy=="function"?n.fuzzy(e,t,o):n.fuzzy||!1,s=typeof n.prefix=="function"?n.prefix(e,t,o):n.prefix===!0,l=typeof n.boostTerm=="function"?n.boostTerm(e,t,o):1;return{term:e,fuzzy:i,prefix:s,termBoost:l}},Cn={idField:"id",extractField:(n,e)=>n[e],stringifyField:(n,e)=>n.toString(),tokenize:n=>n.split(is),processTerm:n=>n.toLowerCase(),fields:void 0,searchOptions:void 0,storeFields:[],logger:(n,e)=>{typeof console?.[n]=="function"&&console[n](e)},autoVacuum:!0},so={combineWith:Un,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:es},os={combineWith:zo,prefix:(n,e,t)=>e===t.length-1},zn={batchSize:1e3,batchWait:10},Pn={minDirtFactor:.1,minDirtCount:20},kn={...zn,...Pn},rs=(n,e)=>{n.includes(e)||n.push(e)},ao=(n,e)=>{for(const t of e)n.includes(t)||n.push(t)},lo=({score:n},{score:e})=>e-n,co=()=>new Map,qt=n=>{const e=new Map;for(const t of Object.keys(n))e.set(parseInt(t,10),n[t]);return e},en=async n=>{const e=new Map;let t=0;for(const o of Object.keys(n))e.set(parseInt(o,10),n[o]),++t%1e3===0&&await Po(0);return e},Po=n=>new Promise(e=>setTimeout(e,n)),is=/[\n\r\p{Z}\p{P}]+/u,ss=/[\p{L}\p{N}_-]+/gu,as=new Set(["the","and","for","are","that","this","from","with","have","your","what","when","where","which","will","would","about","into","then","than","there","they","them","you","how","can","use","using","used","been","also","was","were","has","had","our"]),ls=["ingly","edly","ing","ed","ies","es","ly","s"],cs=["으로부터","에서","에게","에게서","으로","로","에도","에게도","에도","에서부터","까지","만","라도","과","와","을","를","의","가","이","은","는","에서","에","도","랑","와는","과는","으로는","로는","에게는","의는","처럼","같이"];function ds(n){if(n.length<=2)return[n];const e=new Set([n]),t=[n];for(;t.length>0;){const o=t.shift();if(o)for(const i of ls){if(!o.endsWith(i)||o.length<=i.length+2)continue;let s=o.slice(0,-i.length);i==="ies"&&s.length>1&&(s=`${s}y`),!(s.length<=2)&&(e.has(s)||(e.add(s),t.push(s)))}}return[...e]}function us(n){return/[가-힣]/.test(n)}function fs(n){const e=new Set([n]);for(const t of cs){if(n.length<=t.length+1||!n.endsWith(t))continue;const o=n.slice(0,-t.length);o.length>1&&e.add(o)}return[...e]}function On(n){const t=n.toLowerCase().match(ss);return t?t.flatMap(o=>(us(o)?fs(o):ds(o)).map(s=>s.trim()).filter(s=>s.length>1&&!as.has(s))):[]}function hs(n,e,t){if(n.length<=e)return[n];const o=[];let i=0;const s=Math.max(e-t,100);for(;i<n.length;){const l=Math.min(i+e,n.length);if(o.push(n.slice(i,l).trim()),l===n.length)break;i+=s}return o.filter(Boolean)}function ps(n){const e=[],t=new Map;for(const i of n.docs){const s=hs(i.content,n.retrieval.chunkSize,n.retrieval.overlap);let l=0;for(const d of s){const c=On(d),a=`${i.id}#${l}`;l+=1;const h={docId:a,docTitle:i.title,content:d,contentTokenCount:c.length};e.push(h),t.set(a,h)}}const o=new Ut({idField:"id",fields:["docTitle","content"],storeFields:["docTitle","content"],tokenize:On,searchOptions:{prefix:!0}});for(const i of e)o.add({...i,id:`${i.docId}`});return{chunks:e,topK:n.retrieval.topK,searchIndex:o,chunkById:t}}function vs(n,e,t=n.topK){return On(e).length===0||n.chunks.length===0?[]:n.searchIndex.search(e,{limit:t,prefix:!0,fuzzy:.15}).map(l=>{const d=n.chunkById.get(l.id);return d?{docTitle:l.docTitle??d.docTitle,content:l.content??d.content,score:l.score}:null}).filter(l=>!!l).sort((l,d)=>d.score-l.score).slice(0,t)}function ms(n,e){return n.length<=e?n:`${n.slice(0,Math.max(e-16,32)).trimEnd()}
...[truncated]`}function gs(n,e=12e3){if(n.length===0)return"";const t=[];let o=0;for(let i=0;i<n.length;i+=1){const s=n[i],l=ms(s.content,2200),d=`[${i+1}] ${s.docTitle}
${l}`,c=o+d.length+2;if(c>e)break;t.push(d),o=c}return t.join(`

`)}function In(){return`${Date.now()}-${Math.random().toString(36).slice(2,10)}`}function tn(n){const e=Pt(n),t=JSON.stringify(e);let o=2166136261;for(let i=0;i<t.length;i++)o^=t.charCodeAt(i),o+=(o<<1)+(o<<4)+(o<<7)+(o<<8)+(o<<24);return(o>>>0).toString(16).padStart(8,"0")}function _s(){return typeof window>"u"?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function uo(n){return new Date(n).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function fo(n,e){return"modal"}function ys(n,e,t,o){const i=[],s=[];e.systemPrompt.trim()&&s.push(e.systemPrompt.trim()),t.trim()&&s.push(`Ground answers in the supplied context whenever possible. If context is insufficient, clearly say what is missing.

Context:
${t}`),s.length>0&&i.push({role:"system",content:s.join(`

`)});const l=n.slice(-12);for(const d of l)i.push({role:d.role,content:d.content});return i}function ho(n){return ps(n)}function ws(n){if(typeof n!="object"||n===null)return!1;const e=n;return typeof e.id=="string"&&(e.role==="user"||e.role==="assistant")&&typeof e.content=="string"&&typeof e.createdAt=="number"}function Oo(n){const e=n.find(o=>o.role==="user");if(!e)return"New Conversation";const t=e.content.replace(/\s+/g," ").trim();return t?t.length>40?`${t.slice(0,40)}...`:t:"New Conversation"}function bs(n,e){const t=typeof n=="string"?n.trim():"";return t||Oo(e)}function Ss(n){const e=Date.now();return{id:`${e}-${Math.random().toString(36).slice(2,10)}`,title:"New Conversation",messages:[],createdAt:e,updatedAt:e,payloadDigest:n}}function xs(n,e){if(typeof n!="object"||n===null)return null;const t=n;if(typeof t.id!="string"||!t.id.trim())return null;const i=(Array.isArray(t.messages)?t.messages:[]).filter(ws),s=Number(t.createdAt)||Date.now(),l=Number(t.updatedAt)||s,d=bs(typeof t.title=="string"?t.title:"",i);return{id:t.id,title:d,messages:i,createdAt:s,updatedAt:l,payloadDigest:typeof t.payloadDigest=="string"?t.payloadDigest:e}}const Mt="static-rag-chat",po=["openai","anthropic","gemini"],vo=`${Mt}:payload-draft`,mo=`${Mt}:theme`,Cs=`${Mt}:left-rail-collapsed`,ks=`${Mt}:chat-sessions`,An=24,Is=12,As=12e3,go="(max-width: 1100px)",Tn="(max-width: 760px)";var Ts=U('<button type="button" aria-label="Close side menu"></button>'),Ms=U('<button type="button" class="context-sheet-backdrop" aria-label="Close context"></button>'),Es=U("<!> <!>",1),Rs=U('<div class="app-shell"><!> <!> <!> <!></div> <!>',1);function Ls(n,e){jt(e,!1);const t=N();let o=N("openai"),i=N(""),s=N(Lt.openai),l=N([]),d=N(!1),c=N(""),a=N(yn()),h=N(wn(r(a))),g=N(""),f=N(""),x=N(!1),T=N(""),C=N([]),y=N(""),I=N([]),E=N([]),O=N(""),M=N(ho(r(a))),z=null,b=null,k=N(!1),A=N("connection"),me=N("modal"),G=N(!1),we=N("light"),se=N(!1),Ie=N(!1),Z=N(!1),oe=N(!1),Fe=N(!1),st=N(!1),at=N(!1),Je=N(0),Ae=N(0),lt=N("New Conversation"),We=N(r(a).title),Ve=N(r(a).systemPrompt),He=N(r(a).retrieval.topK),Ge=N(r(a).retrieval.chunkSize),J=N(r(a).retrieval.overlap),W=N(""),ee=N(""),ke=N("");function $e(){return typeof window<"u"?window.matchMedia(Tn).matches:!1}let Ne=N(0),Te=N(0),Me=N("ok"),ge="",be=null;const Se={openai:null,anthropic:null,gemini:null};function qe(){return Cs}function je(){typeof window>"u"||window.localStorage.getItem(qe())}function Re(u){return`${ks}:${u}`}function wt(){if(typeof window>"u")return;const u=window.localStorage.getItem(mo);if(u==="light"||u==="dark"){p(we,u);return}p(we,_s())}function Be(u){p(we,u),typeof window<"u"&&window.localStorage.setItem(mo,u),p(f,`Theme: ${u}`)}function ct(){Be(r(we)==="dark"?"light":"dark")}function Ke(u="connection",S){p(A,u),p(me,S??fo(r(Z))),p(k,!0),p(oe,!1),p(se,!1),u==="connection"&&P()}function dt(){p(k,!1)}function D(){const u=$e();p(Z,u),u&&(X(),p(oe,!0))}function $(){p(oe,!1)}function Le(){if(r(oe)){$();return}D()}function vt(){p(se,!r(se))}function X(){p(se,!1)}function fe(){Zt(),X()}function H(u){return`${Mt}:api:${u}`}function te(u){return`${Mt}:model:${u}`}function xe(u){return`${Mt}:api-save:${u}`}function he(){return`${Mt}:provider`}function ae(u){if(typeof window>"u")return!1;const S=window.localStorage.getItem(xe(u));return S==="true"||S==="false"?S==="true":!!window.localStorage.getItem(H(u))}function re(){p(We,r(a).title),p(Ve,r(a).systemPrompt),p(He,r(a).retrieval.topK),p(Ge,r(a).retrieval.chunkSize),p(J,r(a).retrieval.overlap)}function Y(u){const S=r(Ie)?window.localStorage.getItem(H(u))??"":"";return(r(i)||S||gn(u)).trim()}function ie(u,S,R){const B=Lt[R];return S.includes(u)?u:B&&S.includes(B)?B:S[0]||u||B}async function P(){if(typeof window>"u")return;const u=Y(r(o));if(!u){p(l,[]),p(s,r(s).trim()||Lt[r(o)]),p(c,"API key is required to load models.");return}const S=Se[r(o)];if(S&&S.key===u){p(l,S.models),p(s,ie(r(s),r(l),r(o))),Q(),p(c,"");return}p(d,!0),p(c,"");try{const R=await zr(r(o),u);Se[r(o)]={key:u,models:R},p(l,R),p(s,ie(r(s),r(l),r(o))),r(s).trim()||p(s,Lt[r(o)]),Q()}catch(R){p(c,R instanceof Error?R.message:"Failed to fetch model list.")}finally{p(d,!1)}}function ce(){be&&clearTimeout(be),be=setTimeout(()=>{P()},700)}function _e(){if(typeof window>"u")return;const u=window.localStorage.getItem(he());(u==="openai"||u==="anthropic"||u==="gemini")&&p(o,u),p(Ie,ae(r(o))),p(s,window.localStorage.getItem(te(r(o)))??Lt[r(o)]);const S=r(Ie)?window.localStorage.getItem(H(r(o)))??"":"";p(i,S.trim()||gn(r(o))),P()}function Q(){typeof window>"u"||(window.localStorage.setItem(he(),r(o)),window.localStorage.setItem(te(r(o)),r(s)),window.localStorage.setItem(xe(r(o)),String(r(Ie))),r(Ie)?window.localStorage.setItem(H(r(o)),r(i)):window.localStorage.removeItem(H(r(o))))}function et(u){const R=u.currentTarget.checked;if(R&&typeof window<"u"){const B=window.localStorage.getItem(H(r(o)));B&&(window.alert("An API key already exists in localStorage for this browser. Enabling this will overwrite it with your current input."),r(i).trim()||p(i,B))}p(Ie,R),Q()}function mt(u,S={}){const R=r(C).find(B=>B.id===u);R&&(p(y,R.id),p(I,[...R.messages]),p(E,[]),p(G,!1),p(T,""),X(),S.focusComposer)}function ut(u){const S=r(C).findIndex(B=>B.id===r(y));if(S===-1)return;const R=Oo(u);Qn(C,r(C)[S]={...r(C)[S],messages:u,title:r(C)[S].title==="New Conversation"?R:r(C)[S].title,updatedAt:Date.now()}),p(I,u),p(C,[...r(C).sort((B,Ce)=>Ce.updatedAt-B.updatedAt)]),ze()}function bt(){const u=tn(r(a));u&&(u!==ge&&(ge=u,Ye()),(!r(y)||!r(C).some(S=>S.id===r(y)))&&le())}function ze(){if(typeof window>"u"||!ge)return;const u=r(C).map(S=>({...S,messages:S.messages.slice(-120)})).slice(0,An);window.localStorage.setItem(Re(ge),JSON.stringify(u))}function Ye(){if(typeof window>"u")return;ge||(ge=tn(r(a)));const u=window.localStorage.getItem(Re(ge));if(!u){p(C,[]),le();return}try{const S=JSON.parse(u);if(!Array.isArray(S))throw new Error("Invalid session list");const R=S.map(Ce=>xs(Ce,ge)).filter(Ce=>Ce!==null).sort((Ce,Pe)=>Pe.updatedAt-Ce.updatedAt).slice(0,An);p(C,R);const B=r(C)[0];B?mt(B.id):le()}catch{window.localStorage.removeItem(Re(ge)),p(C,[]),le()}}function le(){ge||(ge=tn(r(a)));const u=Ss(ge);p(C,[u,...r(C)].slice(0,An)),p(y,u.id),p(I,[]),p(E,[]),p(G,!1),p(f,"Started new chat"),p(T,""),ze()}function Ue(u,S){if(u.preventDefault(),u.stopPropagation(),!!window.confirm("Delete this conversation?")){if(p(C,r(C).filter(R=>R.id!==S)),r(y)===S){le();return}if(!r(C).length){le();return}ze(),p(f,"Chat deleted")}}function Qe(u,S){const R=r(C).findIndex(Ce=>Ce.id===u);if(R<0)return;const B=S.trim();if(!B){p(f,"Conversation title is empty. Keeping previous title.");return}Qn(C,r(C)[R]={...r(C)[R],title:B,updatedAt:Date.now()}),p(C,[...r(C)]),ze(),p(f,"Conversation renamed")}function tt(u){return`${vo}:${tn(u)}`}function q(){typeof window>"u"||window.localStorage.removeItem(vo)}function j(u){if(typeof window>"u")return;const S=r(a);if(S)try{window.localStorage.setItem(tt(S),wn(S))}catch{return}}function pe(){if(typeof window>"u")return;const u=ro(r(a));p(O,`${window.location.origin}${window.location.pathname}${window.location.search}${u}`)}function St(){if(typeof window>"u")return;const u=ro(r(a));window.location.hash!==u&&window.history.replaceState(null,"",u),pe()}function ye(u,S={}){p(a,Pt(u)),p(h,wn(r(a))),p(g,""),re(),j(),bt(),S.statusMessage&&p(f,S.statusMessage),S.syncHash===!1?pe():St()}function xt(u={}){if(typeof window>"u")return!1;const S=!!u.fallbackToDefault,{payload:R,error:B}=io(window.location.hash);return R?(q(),ye(R,{syncHash:!1,statusMessage:`URL payload loaded (${R.docs.length} doc(s))`}),!0):S&&window.location.hash.length===0?(q(),ye(yn(),{syncHash:!1,statusMessage:"Loaded default payload from URL"}),!0):B?(p(g,`Failed to parse URL payload: ${B}`),p(f,""),pe(),!1):(pe(),!1)}function nt(u){const R=u.currentTarget.value;if(po.includes(R)){if(p(o,R),typeof window<"u"){p(s,window.localStorage.getItem(te(r(o)))??Lt[r(o)]),p(Ie,ae(r(o)));const B=r(Ie)?window.localStorage.getItem(H(r(o)))??"":"";p(i,B.trim()||gn(r(o)))}Q(),P()}}function ft(u){const S=u.currentTarget;p(i,S.value),Q(),ce()}function ot(u){const S=u.currentTarget;p(s,S.value),Q()}function de(){try{const u=Pt({...r(a),title:r(We),systemPrompt:r(Ve),retrieval:{topK:Number(r(He)),chunkSize:Number(r(Ge)),overlap:Number(r(J))}});ye(u,{statusMessage:"Builder settings updated"})}catch(u){const S=u instanceof Error?u.message:"Invalid settings";p(g,S),p(f,"")}}function Xe(){try{const u=JSON.parse(r(h)),S=Pt(u);ye(S,{statusMessage:`Payload updated (${S.docs.length} doc(s))`})}catch(u){const S=u instanceof Error?u.message:"Invalid payload JSON";p(g,S),p(f,"")}}function Dt(){ye(yn(),{statusMessage:"Payload reset to sample"})}function Wt(){const u=r(ee).trim(),S=r(W).trim();if(!u){p(g,"Document content cannot be empty."),p(f,"");return}const R={id:`doc-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,title:S||`Document ${r(a).docs.length+1}`,content:u};ye({...r(a),docs:[...r(a).docs,R]},{statusMessage:`Added document: ${R.title}`}),p(W,""),p(ee,"")}function Ht(u){const S=r(a).docs.filter(R=>R.id!==u);ye({...r(a),docs:S},{statusMessage:`Removed document. ${S.length} doc(s) left.`})}function Gt(u){return u.replace(/\.[^.]+$/,"").replace(/[_-]+/g," ").trim()||u}async function dn(u){if(u.length===0)return;if(p(g,""),p(f,"Importing files..."),u.length===1&&u[0].name.toLowerCase().endsWith(".json")){const R=await u[0].text();try{const B=JSON.parse(R),Ce=Pt(B);ye(Ce,{statusMessage:`Imported payload from ${u[0].name}`});return}catch{}}const S=[];for(const R of u){const B=(await R.text()).trim();B&&S.push({id:`doc-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,title:Gt(R.name),content:B})}if(S.length===0){p(f,""),p(g,"No readable content found in imported files.");return}ye({...r(a),docs:[...r(a).docs,...S]},{statusMessage:`Imported ${S.length} file(s)`})}function un(u){const S=u.currentTarget,R=S.files?Array.from(S.files):[];S.value="",dn(R)}function Xt(){const u=r(ke).trim();if(!u)return;let S="";if(u.startsWith("#"))S=u;else try{S=new URL(u).hash}catch{S=`#r=${u}`}if(!S){p(g,"Input URL does not contain a payload hash."),p(f,"");return}const{payload:R,error:B}=io(S);if(!R){p(g,B?`Failed to import URL payload: ${B}`:"Failed to import URL payload."),p(f,"");return}ye(R,{statusMessage:`Imported payload from URL (${R.docs.length} doc(s))`}),p(ke,"")}async function fn(){if(!r(O)){p(f,"No share URL available");return}try{await navigator.clipboard.writeText(r(O)),p(f,"Share URL copied")}catch{p(f,"Clipboard access failed. Copy from the field manually.")}}function Zt(){le()}async function Vn(){if(!r(st))return;bt(),r(y)||le(),p(g,""),p(f,"");const u=r(T).trim();p(T,"");const S={id:In(),role:"user",content:u,createdAt:Date.now()},R=[...r(I),S];ut(R),p(E,vs(r(M),u,r(a).retrieval.topK)),p(G,r(E).length>0);const B=gs(r(E),As);p(x,!0);const Ce=new AbortController;z=Ce;try{const Pe=await jr({provider:r(o),apiKey:r(i).trim(),model:r(s).trim()||Lt[r(o)],messages:ys(R,r(a),B,Is),signal:Ce.signal});ut([...R,{id:In(),role:"assistant",content:Pe,createdAt:Date.now()}]),p(f,`Response generated with ${kt[r(o)]}`)}catch(Pe){if(Pe instanceof DOMException&&Pe.name==="AbortError"){p(f,"Generation canceled");return}const Rt=Pe instanceof Error?Pe.message:"Request failed";p(g,Rt),ut([...R,{id:In(),role:"assistant",content:Rt,createdAt:Date.now(),isError:!0}])}finally{p(x,!1),z=null}}function Do(u){u.preventDefault(),Vn()}function Fo(u){u.isComposing||u.key==="Process"||u.keyCode===229||u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),Vn())}function No(u){const S=u.currentTarget;p(T,S.value)}function jn(){if(typeof window>"u"){p(Z,!1),p(oe,!1),p(se,!1);return}window.matchMedia(go).matches,p(Z,window.matchMedia(Tn).matches),r(Z)||p(oe,!1),r(k)&&p(me,fo(r(Z)))}function Ko(){z&&z.abort()}Go(()=>{jn(),wt(),_e(),je(),!xt({fallbackToDefault:window.location.hash.length===0})&&window.location.hash.length===0&&St(),bt();const S=()=>{xt({fallbackToDefault:window.location.hash.length===0}),bt()},R=Rt=>{if(Rt.key==="Escape"){if(r(oe)){p(oe,!1);return}if(r(se)){p(se,!1);return}dt()}},B=window.matchMedia(go),Ce=window.matchMedia(Tn),Pe=()=>jn();return B.addEventListener("change",Pe),Ce.addEventListener("change",Pe),window.addEventListener("hashchange",S),window.addEventListener("keydown",R),()=>{B.removeEventListener("change",Pe),Ce.removeEventListener("change",Pe),window.removeEventListener("hashchange",S),window.removeEventListener("keydown",R),typeof document<"u"&&(document.body.style.overflow="")}}),ht(()=>r(a),()=>{p(M,ho(r(a)))}),ht(()=>r(i),()=>{p(Fe,r(i).trim().length>0)}),ht(()=>(r(x),r(Fe),r(T)),()=>{p(st,!r(x)&&r(Fe)&&r(T).trim().length>0)}),ht(()=>r(I),()=>{p(at,r(I).length>0)}),ht(()=>r(a),()=>{p(Je,r(a).docs.length)}),ht(()=>r(a),()=>{p(Ae,r(a).docs.reduce((u,S)=>u+S.content.length,0))}),ht(()=>(r(C),r(y)),()=>{p(lt,r(C).find(u=>u.id===r(y))?.title??"New Conversation")}),ht(()=>r(a),()=>{try{p(Ne,Ao(r(a)).length)}catch{p(Ne,0)}}),ht(()=>r(O),()=>{p(Te,r(O).length)}),ht(()=>(r(Te),r(Ne)),()=>{r(Te)>=7800||r(Ne)>=7200?p(Me,"danger"):r(Te)>=4500||r(Ne)>=4e3?p(Me,"warn"):p(Me,"ok")}),ht(()=>(r(we),r(k),r(se),r(Z),r(oe)),()=>{typeof document<"u"&&(document.documentElement.dataset.theme=r(we),document.documentElement.style.colorScheme=r(we),document.body.style.overflow=r(k)||r(se)||r(Z)&&r(oe)?"hidden":"")}),ht(()=>(r(Z),r(oe)),()=>{p(t,!r(Z)||r(oe))}),Sr(),Vt();var Bn=Rs(),hn=Ee(Bn),Jn=m(hn);{var Uo=u=>{var S=Ts();Ze(S,1,"left-rail-backdrop",null,{},{open}),F("click",S,X),L(u,S)};ve(Jn,u=>{r(se)&&u(Uo)})}var Wn=_(Jn,2);Ai(Wn,{get mobileOpen(){return r(se)},get payloadTitle(){return r(a),K(()=>r(a).title)},get docCount(){return r(Je)},get docChars(){return r(Ae)},get providerLabel(){return ne(kt),r(o),K(()=>kt[r(o)])},get model(){return r(s)},get chatSessions(){return r(C)},get activeSessionId(){return r(y)},get urlRisk(){return r(Me)},get urlLength(){return r(Te)},get encodedLength(){return r(Ne)},get theme(){return r(we)},get formatMessageTime(){return uo},onStartNewSession:fe,onCloseMobileRail:X,onOpenSettings:Ke,onToggleTheme:ct,onSetActiveSession:mt,onDeleteSession:Ue,onRenameSession:Qe,onCopyShareUrl:fn});var Hn=_(Wn,2);ci(Hn,{get mobileLeftRailOpen(){return r(se)},get activeSessionTitle(){return r(lt)},get payloadTitle(){return r(a),K(()=>r(a).title)},get hasApiKey(){return r(Fe)},get providerLabel(){return ne(kt),r(o),K(()=>kt[r(o)])},get hasConversation(){return r(at)},get chatMessages(){return r(I)},get canSend(){return r(st)},get loading(){return r(x)},get prompt(){return r(T)},get mobileContextOpen(){return r(oe)},get ragDocs(){return r(a),K(()=>r(a).docs)},get formatMessageTime(){return uo},onToggleLeftRail:vt,onClearChat:Zt,onToggleContext:Le,onOpenSettings:Ke,onSubmit:Do,onPromptInput:No,onPromptKeydown:Fo,onStopGeneration:Ko,bindComposerTextarea:b});var Vo=_(Hn,2);{var jo=u=>{var S=Es(),R=Ee(S);{var B=Pe=>{var Rt=Ms();F("click",Rt,$),L(Pe,Rt)};ve(R,Pe=>{r(Z)&&Pe(B)})}var Ce=_(R,2);wi(Ce,{get isNarrowViewport(){return r(Z)},get mobileContextOpen(){return r(oe)},get retrievedChunks(){return r(E)},get showRetrievedContext(){return r(G)},get providerLabel(){return ne(kt),r(o),K(()=>kt[r(o)])},get model(){return r(s)},get hasApiKey(){return r(Fe)},get payloadError(){return r(g)},get status(){return r(f)},onClose:$,onToggleRetrievedContext:()=>{p(G,!r(G))},onOpenSettings:Ke}),L(u,S)};ve(Vo,u=>{r(t)&&u(jo)})}v(hn);var Bo=_(hn,2);Bi(Bo,{get settingsOpen(){return r(k)},get settingsPresentation(){return r(me)},get settingsTab(){return r(A)},get providers(){return po},get provider(){return r(o)},get theme(){return r(we)},get model(){return r(s)},get modelOptions(){return r(l)},get isModelCatalogLoading(){return r(d)},get modelCatalogError(){return r(c)},get apiKey(){return r(i)},get persistApiKey(){return r(Ie)},get payloadError(){return r(g)},get status(){return r(f)},get docCount(){return r(Je)},get docChars(){return r(Ae)},get docs(){return r(a),K(()=>r(a).docs)},onClose:dt,onSetTheme:Be,onSelectTab:Ke,onProviderChange:nt,onApiKeyInput:ft,onApiKeySaveToggle:et,onModelInput:ot,onRefreshModels:()=>{P()},onApplyBuilderSettings:de,onAddDocument:Wt,onRemoveDocument:Ht,onFileInput:un,onApplyImportUrl:Xt,onApplyPayloadJson:Xe,onResetPayload:Dt,get titleInput(){return r(We)},set titleInput(u){p(We,u)},get systemPromptInput(){return r(Ve)},set systemPromptInput(u){p(Ve,u)},get topKInput(){return r(He)},set topKInput(u){p(He,u)},get chunkSizeInput(){return r(Ge)},set chunkSizeInput(u){p(Ge,u)},get overlapInput(){return r(J)},set overlapInput(u){p(J,u)},get newDocTitle(){return r(W)},set newDocTitle(u){p(W,u)},get newDocContent(){return r(ee)},set newDocContent(u){p(ee,u)},get importUrl(){return r(ke)},set importUrl(u){p(ke,u)},get payloadJson(){return r(h)},set payloadJson(u){p(h,u)},$$legacy:!0}),L(n,Bn),Bt()}function Vs(n){Ls(n,{})}export{Vs as component};
