import{c as Jo,l as Ho,a as L,m as Wo,d as st,o as N,f as V}from"../chunks/DQQpVooK.js";import{i as Vt}from"../chunks/DDxtbRRp.js";import{o as Go}from"../chunks/CxCM4Tq1.js";import{I as go,h as Oe,J as an,l as r,ah as $o,L as Yo,_ as Wn,Y as Kt,aa as Qt,e as Pt,K as Qo,af as Xo,X as Gn,c as Ft,a as nn,b2 as At,b as Tn,b3 as Zo,s as qo,at as er,aR as tr,ad as Dn,b4 as nr,b5 as or,aM as F,G as $n,b6 as rr,r as _o,p as yo,b7 as hn,b8 as ir,ac as sr,d as ar,a8 as lr,a6 as wo,b9 as bo,F as cr,ba as dr,bb as ur,a1 as fr,aE as hr,bc as pr,H as vr,aB as mr,bd as gr,aN as _r,i as K,D as yr,be as wr,v as jt,y as Bt,n as ne,z as m,B as _,A as v,w as Ee,aP as So,bf as br,x as ue,bg as on,Z as ln,ao as p,bh as pt,bi as Sr,bj as Yn}from"../chunks/Ct7evnEA.js";import{l as it,p as w,s as yt,i as pe,b as xr}from"../chunks/CiDdCK_m.js";import{a as Qn,b as qe,c as rn,r as _t,i as Xn,d as Zn,e as Cr}from"../chunks/BZXTrd9i.js";import{s as j}from"../chunks/BEjHsQSY.js";import{B as kr}from"../chunks/uC2UA348.js";function Ot(n,e){return e}function Ir(n,e,t){for(var o=[],i=e.length,a,l=e.length,d=0;d<i;d++){let g=e[d];yo(g,()=>{if(a){if(a.pending.delete(g),a.done.add(g),a.pending.size===0){var f=n.outrogroups;En(Dn(a.done)),f.delete(a),f.size===0&&(n.outrogroups=null)}}else l-=1},!1)}if(l===0){var c=o.length===0&&t!==null;if(c){var s=t,h=s.parentNode;sr(h),h.append(s),n.items.clear()}En(e,!c)}else a={pending:new Set(e),done:new Set},(n.outrogroups??=new Set).add(a)}function En(n,e=!0){for(var t=0;t<n.length;t++)ar(n[t],e)}var qn;function Lt(n,e,t,o,i,a=null){var l=n,d=new Map,c=(e&bo)!==0;if(c){var s=n;l=Oe?Kt(wo(s)):s.appendChild(nn())}Oe&&an();var h=null,g=er(()=>{var I=t();return tr(I)?I:I==null?[]:Dn(I)}),f,S=!0;function M(){y.fallback=h,Ar(y,f,l,e,o),h!==null&&(f.length===0?(h.f&At)===0?_o(h):(h.f^=At,Yt(h,null,l)):yo(h,()=>{h=null}))}var C=go(()=>{f=r(g);var I=f.length;let E=!1;if(Oe){var O=$o(l)===Yo;O!==(I===0)&&(l=Wn(),Kt(l),Qt(!1),E=!0)}for(var T=new Set,z=Ft,b=qo(),k=0;k<I;k+=1){Oe&&Pt.nodeType===Qo&&Pt.data===Xo&&(l=Pt,E=!0,Qt(!1));var A=f[k],ve=o(A,k),W=S?null:d.get(ve);W?(W.v&&Gn(W.v,A),W.i&&Gn(W.i,k),b&&z.unskip_effect(W.e)):(W=Mr(d,S?l:qn??=nn(),A,ve,k,i,e,t),S||(W.e.f|=At),d.set(ve,W)),T.add(ve)}if(I===0&&a&&!h&&(S?h=Tn(()=>a(l)):(h=Tn(()=>a(qn??=nn())),h.f|=At)),I>T.size&&Zo(),Oe&&I>0&&Kt(Wn()),!S)if(b){for(const[_e,se]of d)T.has(_e)||z.skip_effect(se.e);z.oncommit(M),z.ondiscard(()=>{})}else M();E&&Qt(!0),r(g)}),y={effect:C,items:d,outrogroups:null,fallback:h};S=!1,Oe&&(l=Pt)}function $t(n){for(;n!==null&&(n.f&ir)===0;)n=n.next;return n}function Ar(n,e,t,o,i){var a=(o&dr)!==0,l=e.length,d=n.items,c=$t(n.effect.first),s,h=null,g,f=[],S=[],M,C,y,I;if(a)for(I=0;I<l;I+=1)M=e[I],C=i(M,I),y=d.get(C).e,(y.f&At)===0&&(y.nodes?.a?.measure(),(g??=new Set).add(y));for(I=0;I<l;I+=1){if(M=e[I],C=i(M,I),y=d.get(C).e,n.outrogroups!==null)for(const W of n.outrogroups)W.pending.delete(y),W.done.delete(y);if((y.f&At)!==0)if(y.f^=At,y===c)Yt(y,null,t);else{var E=h?h.next:c;y===n.effect.last&&(n.effect.last=y.prev),y.prev&&(y.prev.next=y.next),y.next&&(y.next.prev=y.prev),Mt(n,h,y),Mt(n,y,E),Yt(y,E,t),h=y,f=[],S=[],c=$t(h.next);continue}if((y.f&hn)!==0&&(_o(y),a&&(y.nodes?.a?.unfix(),(g??=new Set).delete(y))),y!==c){if(s!==void 0&&s.has(y)){if(f.length<S.length){var O=S[0],T;h=O.prev;var z=f[0],b=f[f.length-1];for(T=0;T<f.length;T+=1)Yt(f[T],O,t);for(T=0;T<S.length;T+=1)s.delete(S[T]);Mt(n,z.prev,b.next),Mt(n,h,z),Mt(n,b,O),c=O,h=b,I-=1,f=[],S=[]}else s.delete(y),Yt(y,c,t),Mt(n,y.prev,y.next),Mt(n,y,h===null?n.effect.first:h.next),Mt(n,h,y),h=y;continue}for(f=[],S=[];c!==null&&c!==y;)(s??=new Set).add(c),S.push(c),c=$t(c.next);if(c===null)continue}(y.f&At)===0&&f.push(y),h=y,c=$t(y.next)}if(n.outrogroups!==null){for(const W of n.outrogroups)W.pending.size===0&&(En(Dn(W.done)),n.outrogroups?.delete(W));n.outrogroups.size===0&&(n.outrogroups=null)}if(c!==null||s!==void 0){var k=[];if(s!==void 0)for(y of s)(y.f&hn)===0&&k.push(y);for(;c!==null;)(c.f&hn)===0&&c!==n.fallback&&k.push(c),c=$t(c.next);var A=k.length;if(A>0){var ve=(o&bo)!==0&&l===0?t:null;if(a){for(I=0;I<A;I+=1)k[I].nodes?.a?.measure();for(I=0;I<A;I+=1)k[I].nodes?.a?.fix()}Ir(n,k,ve)}}a&&cr(()=>{if(g!==void 0)for(y of g)y.nodes?.a?.apply()})}function Mr(n,e,t,o,i,a,l,d){var c=(l&nr)!==0?(l&or)===0?F(t,!1,!1):$n(t):null,s=(l&rr)!==0?$n(i):null;return{v:c,i:s,e:Tn(()=>(a(e,c??t,s??i,d),()=>{n.delete(o)}))}}function Yt(n,e,t){if(n.nodes)for(var o=n.nodes.start,i=n.nodes.end,a=e&&(e.f&At)===0?e.nodes.start:t;o!==null;){var l=lr(o);if(a.before(o),o===i)return;o=l}}function Mt(n,e,t){e===null?n.effect.first=t:e.next=t,t===null?n.effect.last=e:t.prev=e}function vt(n,e,t,o,i){Oe&&an();var a=e.$$slots?.[t],l=!1;a===!0&&(a=e.children,l=!0),a===void 0||a(n,l?()=>o:o)}function Tr(n,e,t,o,i,a){let l=Oe;Oe&&an();var d=null;Oe&&Pt.nodeType===ur&&(d=Pt,an());var c=Oe?Pt:n,s=new kr(c,!1);go(()=>{const h=e()||null;var g=pr;if(h===null){s.ensure(null,null);return}return s.ensure(h,f=>{if(h){if(d=Oe?d:hr(h,g),Jo(d,d),o){Oe&&Ho(h)&&d.append(document.createComment(""));var S=Oe?wo(d):d.appendChild(nn());Oe&&(S===null?Qt(!1):Kt(S)),o(d,S)}vr.nodes.end=d,f.before(d)}Oe&&Kt(f)}),()=>{}},fr),mr(()=>{}),l&&(Qt(!0),Kt(c))}function Ct(n,e,t=e){var o=new WeakSet;gr(n,"input",async i=>{var a=i?n.defaultValue:n.value;if(a=pn(n)?vn(a):a,t(a),Ft!==null&&o.add(Ft),await _r(),a!==(a=e())){var l=n.selectionStart,d=n.selectionEnd,c=n.value.length;if(n.value=a??"",d!==null){var s=n.value.length;l===d&&d===c&&s>c?(n.selectionStart=s,n.selectionEnd=s):(n.selectionStart=l,n.selectionEnd=Math.min(d,s))}}}),(Oe&&n.defaultValue!==n.value||K(e)==null&&n.value)&&(t(pn(n)?vn(n.value):n.value),Ft!==null&&o.add(Ft)),yr(()=>{var i=e();if(n===document.activeElement){var a=wr??Ft;if(o.has(a))return}pn(n)&&i===vn(n.value)||n.type==="date"&&!i&&!n.value||i!==n.value&&(n.value=i??"")})}function pn(n){var e=n.type;return e==="number"||e==="range"}function vn(n){return n===""?null:+n}const zt={openai:"gpt-4.1-mini",anthropic:"claude-3-5-sonnet-latest",gemini:"gemini-2.0-flash"},kt={openai:"OpenAI",anthropic:"Claude (Anthropic)",gemini:"Gemini (Google)"};function xo(n){return Array.isArray(n)?n.map(e=>{if(typeof e=="string")return e;if(e&&typeof e=="object"){const t=(typeof e.id=="string"&&e.id)??(typeof e.name=="string"&&e.name)??"";return typeof t=="string"?t:""}return""}).filter(Boolean):[]}function Er(n){const e=n.toLowerCase().trim(),t=e.startsWith("ft:")?e.slice(3):e;return["instruct","whisper","tts","speech","audio","image","search","realtime","transcribe","transcription","embedding","moderation","text-","dall-e","dalle","sora","davinci","babbage","curie","ada"].some(i=>t.includes(i))?!1:/^(gpt-(4|5|3\.5|oss)|chatgpt-|o[1-9])/.test(t)}function Rr(n){return Array.isArray(n)?n.map(e=>{if(!e||typeof e!="object")return"";const t=e,o=typeof t.name=="string"?t.name:"";return(Array.isArray(t.supportedGenerationMethods)?t.supportedGenerationMethods:[]).some(l=>typeof l=="string"&&l==="generateContent")?o.startsWith("models/")?o.slice(7):o:""}).filter(Boolean):[]}function Nn(n){const e=new Set;return n.map(o=>o.trim()).filter(o=>o.length>0).filter(o=>{const i=o.toLowerCase();return e.has(i)?!1:(e.add(i),!0)}).sort((o,i)=>o.localeCompare(i))}const Lr={openai:"",anthropic:"",gemini:""};function mn(n){return Lr[n]?.trim()??""}async function zr(n,e){if(!e.trim())return[];switch(n){case"openai":return Pr(e);case"anthropic":return Or(e);case"gemini":return Dr(e);default:return[]}}async function Pr(n){const e=await fetch("https://api.openai.com/v1/models",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}}),t=await Jt(e,"openai"),o=xo(t?.data).filter(Er);return Nn(o)}async function Or(n){const e=await fetch("https://api.anthropic.com/v1/models",{method:"GET",headers:{"x-api-key":n,"anthropic-version":"2023-06-01","anthropic-dangerous-direct-browser-access":"true"}}),t=await Jt(e,"anthropic"),o=xo(t?.data);return Nn(o)}async function Dr(n){const e=await fetch(`https://generativelanguage.googleapis.com/v1/models?key=${encodeURIComponent(n)}`,{method:"GET",headers:{"Content-Type":"application/json"}}),t=await Jt(e,"gemini"),o=Rr(t?.models);return Nn(o)}function Nr(n){if(typeof n!="object"||n===null)return null;const e=n;if(typeof e.error=="string")return e.error;if(typeof e.message=="string")return e.message;if(typeof e.error=="object"&&e.error!==null){const t=e.error;if(typeof t.message=="string")return t.message}return null}async function Fr(n){try{return await n.json()}catch{return null}}async function Jt(n,e){const t=await Fr(n);if(!n.ok){const o=Nr(t)??`HTTP ${n.status}`;throw new Error(`${kt[e]} request failed: ${o}`)}return t}async function Kr(n){const e=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.apiKey}`},body:JSON.stringify({model:n.model,messages:n.messages,temperature:n.temperature??.2,max_tokens:n.maxTokens??1e3}),signal:n.signal}),t=await Jt(e,"openai"),l=(Array.isArray(t.choices)?t.choices:[])[0]?.message?.content;if(typeof l=="string"&&l.trim())return l;if(Array.isArray(l)){const d=l.map(c=>{if(typeof c=="object"&&c!==null&&"text"in c){const s=c.text;return typeof s=="string"?s:""}return""}).filter(Boolean).join(`
`);if(d.trim())return d}throw new Error("OpenAI response did not include text content.")}async function Ur(n){const e=n.messages.filter(d=>d.role==="system").map(d=>d.content).join(`

`),t=n.messages.filter(d=>d.role!=="system").map(d=>({role:d.role==="assistant"?"assistant":"user",content:[{type:"text",text:d.content}]})),o=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":n.apiKey,"anthropic-version":"2023-06-01","anthropic-dangerous-direct-browser-access":"true"},body:JSON.stringify({model:n.model,system:e,messages:t,temperature:n.temperature??.2,max_tokens:n.maxTokens??1e3}),signal:n.signal}),i=await Jt(o,"anthropic"),l=(Array.isArray(i.content)?i.content:[]).map(d=>{if(typeof d=="object"&&d!==null){const c=d;if(c.type==="text"&&typeof c.text=="string")return c.text}return""}).filter(Boolean).join(`
`);if(!l.trim())throw new Error("Claude response did not include text content.");return l}async function Vr(n){const e=n.messages.filter(f=>f.role==="system").map(f=>f.content).join(`

`),t=n.messages.filter(f=>f.role!=="system").map(f=>({role:f.role==="assistant"?"model":"user",parts:[{text:f.content}]})),o=`https://generativelanguage.googleapis.com/v1beta/models/${encodeURIComponent(n.model)}:generateContent?key=${encodeURIComponent(n.apiKey)}`,i={contents:t,generationConfig:{temperature:n.temperature??.2,maxOutputTokens:n.maxTokens??1e3}};e.trim()&&(i.systemInstruction={parts:[{text:e}]});const a=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i),signal:n.signal}),l=await Jt(a,"gemini"),s=(Array.isArray(l.candidates)?l.candidates:[])[0]?.content,g=(Array.isArray(s?.parts)?s?.parts:[]).map(f=>{if(typeof f=="object"&&f!==null&&"text"in f){const S=f.text;return typeof S=="string"?S:""}return""}).filter(Boolean).join(`
`);if(!g.trim())throw new Error("Gemini response did not include text content.");return g}async function jr(n){if(!n.apiKey.trim())throw new Error("API key is required.");if(!n.model.trim())throw new Error("Model is required.");switch(n.provider){case"openai":return Kr(n);case"anthropic":return Ur(n);case"gemini":return Vr(n);default:throw new Error(`Unsupported provider: ${n.provider}`)}}const Br={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const Jr=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0;return!1};const eo=(...n)=>n.filter((e,t,o)=>!!e&&e.trim()!==""&&o.indexOf(e)===t).join(" ").trim();var Hr=Wo("<svg><!><!></svg>");function wt(n,e){const t=it(e,["children","$$slots","$$events","$$legacy"]),o=it(t,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);jt(e,!1);let i=w(e,"name",8,void 0),a=w(e,"color",8,"currentColor"),l=w(e,"size",8,24),d=w(e,"strokeWidth",8,2),c=w(e,"absoluteStrokeWidth",8,!1),s=w(e,"iconNode",24,()=>[]);Vt();var h=Hr();Qn(h,(S,M,C)=>({...Br,...S,...o,width:l(),height:l(),stroke:a(),"stroke-width":M,class:C}),[()=>Jr(o)?void 0:{"aria-hidden":"true"},()=>(ne(c()),ne(d()),ne(l()),K(()=>c()?Number(d())*24/Number(l()):d())),()=>(ne(eo),ne(i()),ne(t),K(()=>eo("lucide-icon","lucide",i()?`lucide-${i()}`:"",t.class)))]);var g=m(h);Lt(g,1,s,Ot,(S,M)=>{var C=So(()=>br(r(M),2));let y=()=>r(C)[0],I=()=>r(C)[1];var E=st(),O=Ee(E);Tr(O,y,!0,(T,z)=>{Qn(T,()=>({...I()}))}),L(S,E)});var f=_(g);vt(f,e,"default",{}),v(h),L(n,h),Bt()}function Wr(n,e){const t=it(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M20 6 9 17l-5-5"}]];wt(n,yt({name:"check"},()=>t,{get iconNode(){return o},children:(i,a)=>{var l=st(),d=Ee(l);vt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}function Gr(n,e){const t=it(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M4 5h16"}],["path",{d:"M4 12h16"}],["path",{d:"M4 19h16"}]];wt(n,yt({name:"menu"},()=>t,{get iconNode(){return o},children:(i,a)=>{var l=st(),d=Ee(l);vt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}function $r(n,e){const t=it(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"}]];wt(n,yt({name:"moon"},()=>t,{get iconNode(){return o},children:(i,a)=>{var l=st(),d=Ee(l);vt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}function Co(n,e){const t=it(e,["children","$$slots","$$events","$$legacy"]);const o=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"}],["path",{d:"M9 3v18"}],["path",{d:"m16 15-3-3 3-3"}]];wt(n,yt({name:"panel-left-close"},()=>t,{get iconNode(){return o},children:(i,a)=>{var l=st(),d=Ee(l);vt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}function Yr(n,e){const t=it(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];wt(n,yt({name:"pencil"},()=>t,{get iconNode(){return o},children:(i,a)=>{var l=st(),d=Ee(l);vt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}function Qr(n,e){const t=it(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M5 12h14"}],["path",{d:"M12 5v14"}]];wt(n,yt({name:"plus"},()=>t,{get iconNode(){return o},children:(i,a)=>{var l=st(),d=Ee(l);vt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}function Xr(n,e){const t=it(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]];wt(n,yt({name:"send"},()=>t,{get iconNode(){return o},children:(i,a)=>{var l=st(),d=Ee(l);vt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}function Zr(n,e){const t=it(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915"}],["circle",{cx:"12",cy:"12",r:"3"}]];wt(n,yt({name:"settings"},()=>t,{get iconNode(){return o},children:(i,a)=>{var l=st(),d=Ee(l);vt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}function qr(n,e){const t=it(e,["children","$$slots","$$events","$$legacy"]);const o=[["circle",{cx:"12",cy:"12",r:"4"}],["path",{d:"M12 2v2"}],["path",{d:"M12 20v2"}],["path",{d:"m4.93 4.93 1.41 1.41"}],["path",{d:"m17.66 17.66 1.41 1.41"}],["path",{d:"M2 12h2"}],["path",{d:"M20 12h2"}],["path",{d:"m6.34 17.66-1.41 1.41"}],["path",{d:"m19.07 4.93-1.41 1.41"}]];wt(n,yt({name:"sun"},()=>t,{get iconNode(){return o},children:(i,a)=>{var l=st(),d=Ee(l);vt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}function ei(n,e){const t=it(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M10 11v6"}],["path",{d:"M14 11v6"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}],["path",{d:"M3 6h18"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}]];wt(n,yt({name:"trash-2"},()=>t,{get iconNode(){return o},children:(i,a)=>{var l=st(),d=Ee(l);vt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}function Fn(n,e){const t=it(e,["children","$$slots","$$events","$$legacy"]);const o=[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]];wt(n,yt({name:"x"},()=>t,{get iconNode(){return o},children:(i,a)=>{var l=st(),d=Ee(l);vt(d,e,"default",{}),L(i,l)},$$slots:{default:!0}}))}var ti=V('<div class="notice warning"><span>You must enter an API key before sending messages.</span> <button type="button">Open Settings</button></div>'),ni=V('<article class="starter-card"><span> </span> <small> </small></article>'),oi=V("<p>There are currently no documents in this Static Rag Chat payload.</p>"),ri=V('<section class="empty-state"><h3>Loaded documents in Static Rag Chat</h3> <p>These documents are embedded in the current payload and available for retrieval in this session.</p> <div class="starter-grid"><!></div></section>'),ii=V('<article><div class="message-avatar"> </div> <div class="message-bubble"><div class="message-meta"><strong> </strong> <span> </span></div> <p> </p></div></article>'),si=V('<article class="message-row assistant"><div class="message-avatar">AI</div> <div class="message-bubble typing"><div class="message-meta"><strong>Assistant</strong> <span>Thinking...</span></div> <div class="typing-indicator" aria-hidden="true"><span></span> <span></span> <span></span></div></div></article>'),ai=V('<button type="button" class="danger">Stop</button>'),li=V('<section class="chat-column"><header class="chat-header"><button type="button" class="icon-btn mobile-menu-btn" aria-label="Toggle side menu"><!></button> <div class="chat-title"><p class="kicker">Conversation</p> <h2> </h2> <p class="chat-subtitle"> </p></div> <div class="chat-toolbar"><span> </span> <span class="chat-pill"> </span> <button type="button" class="chat-pill ghost mobile-pill-btn mobile-toolbar-btn">New</button> <button type="button" class="chat-pill ghost mobile-pill-btn mobile-toolbar-btn"> </button></div></header> <!> <div class="message-stream" aria-live="polite"><!> <!> <!></div> <form class="composer"><textarea rows="3" placeholder="Ask about this shared Static Rag Chat context... (Enter send / Shift+Enter newline)"></textarea> <div class="composer-foot"><p>Context-aware responses combine multi-turn history with retrieved chunks.</p> <div class="composer-actions"><!> <button type="submit" class="send-btn"><span> </span> <!></button></div></div></form></section>');function ci(n,e){jt(e,!1);let t=w(e,"mobileLeftRailOpen",8),o=w(e,"activeSessionTitle",8),i=w(e,"payloadTitle",8),a=w(e,"hasApiKey",8),l=w(e,"providerLabel",8),d=w(e,"hasConversation",8),c=w(e,"chatMessages",24,()=>[]),s=w(e,"canSend",8,!1),h=w(e,"loading",8,!1),g=w(e,"prompt",8,""),f=w(e,"mobileContextOpen",8,!1),S=w(e,"ragDocs",24,()=>[]),M=w(e,"formatMessageTime",8),C=w(e,"onToggleLeftRail",8),y=w(e,"onClearChat",8),I=w(e,"onToggleContext",8),E=w(e,"onOpenSettings",8),O=w(e,"onSubmit",8),T=w(e,"onPromptInput",8),z=w(e,"onPromptKeydown",8),b=w(e,"onStopGeneration",8),k=w(e,"bindComposerTextarea",12);Vt();var A=li(),ve=m(A),W=m(ve),_e=m(W);{var se=D=>{Co(D,{size:18})},ke=D=>{Gr(D,{size:18})};pe(_e,D=>{t()?D(se):D(ke,!1)})}v(W);var Z=_(W,2),oe=_(m(Z),2),Ne=m(oe,!0);v(oe);var at=_(oe,2),lt=m(at);v(at),v(Z);var Je=_(Z,2),Ie=m(Je),ct=m(Ie,!0);v(Ie);var He=_(Ie,2),Ve=m(He,!0);v(He);var We=_(He,2),Ge=_(We,2),B=m(Ge,!0);v(Ge),v(Je),v(ve);var J=_(ve,2);{var q=D=>{var $=ti(),Le=_(m($),2);v($),N("click",Le,()=>E()("connection")),L(D,$)};pe(J,D=>{a()||D(q)})}var Ce=_(J,2),$e=m(Ce);{var Fe=D=>{var $=ri(),Le=_(m($),4),mt=m(Le);{var X=H=>{var ee=st(),Se=Ee(ee);Lt(Se,1,S,Ot,(he,ae,re)=>{var Y=ni(),ie=m(Y),P=m(ie);v(ie);var ce=_(ie,2),ge=m(ce);v(ce),v(Y),ue(Q=>{j(P,`${re+1}. ${r(ae),K(()=>r(ae).title)??""}`),j(ge,`${Q??""}${r(ae),K(()=>r(ae).content.length>240?"…":"")??""}`)},[()=>(r(ae),K(()=>r(ae).content.slice(0,240)))]),L(he,Y)}),L(H,ee)},fe=H=>{var ee=oi();L(H,ee)};pe(mt,H=>{ne(S()),K(()=>S().length>0)?H(X):H(fe,!1)})}v(Le),v($),L(D,$)};pe($e,D=>{d()||D(Fe)})}var Ae=_($e,2);Lt(Ae,1,c,Ot,(D,$)=>{var Le=ii(),mt=m(Le),X=m(mt,!0);v(mt);var fe=_(mt,2),H=m(fe),ee=m(H),Se=m(ee,!0);v(ee);var he=_(ee,2),ae=m(he,!0);v(he),v(H);var re=_(H,2),Y=m(re,!0);v(re),v(fe),v(Le),ue(ie=>{qe(Le,1,`message-row ${r($),K(()=>r($).role)??""} ${r($),K(()=>r($).isError?"message-error":"")??""}`),j(X,(r($),K(()=>r($).role==="user"?"ME":"AI"))),j(Se,(r($),K(()=>r($).role==="user"?"You":r($).isError?"System Error":"Assistant"))),j(ae,ie),j(Y,(r($),K(()=>r($).content)))},[()=>(ne(M()),r($),K(()=>M()(r($).createdAt)))]),L(D,Le)});var Me=_(Ae,2);{var me=D=>{var $=si();L(D,$)};pe(Me,D=>{h()&&D(me)})}v(Ce);var we=_(Ce,2),be=m(we);on(be),xr(be,D=>k(D),()=>k());var et=_(be,2),je=_(m(et),2),Re=m(je);{var bt=D=>{var $=ai();N("click",$,function(...Le){b()?.apply(this,Le)}),L(D,$)};pe(Re,D=>{h()&&D(bt)})}var Be=_(Re,2),dt=m(Be),Ke=m(dt,!0);v(dt);var ut=_(dt,2);Xr(ut,{size:16}),v(Be),v(je),v(et),v(we),v(A),ue(()=>{j(Ne,o()),j(lt,`${i()??""} · ${a()?"API key loaded":"API key required"} · ${ne(d()),ne(c()),K(()=>d()?`${c().length} messages`:"empty conversation")??""}`),qe(Ie,1,`chat-pill ${a()?"chat-pill-ok":"chat-pill-warn"}`),j(ct,a()?"API Connected":"API Missing"),j(Ve,l()),j(B,f()?"Close Context":"Context"),rn(be,g()),Be.disabled=!s(),j(Ke,h()?"Sending...":"Send Message")}),N("click",W,function(...D){C()?.apply(this,D)}),N("click",We,function(...D){y()?.apply(this,D)}),N("click",Ge,function(...D){I()?.apply(this,D)}),N("input",be,function(...D){T()?.apply(this,D)}),N("compositionend",be,function(...D){T()?.apply(this,D)}),N("keydown",be,function(...D){z()?.apply(this,D)}),N("submit",we,function(...D){O()?.apply(this,D)}),L(n,A),Bt()}var di=V('<div class="mobile-context-head"><h3>Session Context</h3> <button type="button" class="icon-btn" aria-label="Close context sheet"><!></button></div>'),ui=V('<button type="button" class="ghost mini-btn"> </button>'),fi=V('<p class="panel-empty">Send a message to show matched document chunks here.</p>'),hi=V('<article class="retrieval-item"><div class="retrieval-head"><strong> </strong> <span> </span></div> <p> </p></article>'),pi=V('<div class="retrieval-list"></div>'),vi=V('<p class="panel-meta"> </p> <!>',1),mi=V('<p class="error"> </p>'),gi=V('<p class="status"> </p>'),_i=V('<p class="panel-empty">No recent status.</p>'),yi=V('<aside><!> <section class="context-card"><h3>Session</h3> <p>Provider: <strong> </strong></p> <p>Model: <strong> </strong></p> <p>API Key: <strong> </strong></p> <div class="rail-inline-actions"><button type="button" class="ghost">Manage</button></div></section> <section class="context-card"><div class="card-head"><h3>Retrieved Context</h3> <!></div> <!></section> <section class="context-card"><h3>Activity</h3> <!></section></aside>');function wi(n,e){jt(e,!1);let t=w(e,"isNarrowViewport",8),o=w(e,"mobileContextOpen",8),i=w(e,"retrievedChunks",24,()=>[]),a=w(e,"showRetrievedContext",8),l=w(e,"providerLabel",8),d=w(e,"model",8),c=w(e,"hasApiKey",8),s=w(e,"payloadError",8),h=w(e,"status",8),g=w(e,"onClose",8),f=w(e,"onToggleRetrievedContext",8),S=w(e,"onOpenSettings",8);Vt();var M=yi();let C;var y=m(M);{var I=B=>{var J=di(),q=_(m(J),2),Ce=m(q);Fn(Ce,{size:16}),v(q),v(J),N("click",q,function(...$e){g()?.apply(this,$e)}),L(B,J)};pe(y,B=>{t()&&B(I)})}var E=_(y,2),O=_(m(E),2),T=_(m(O)),z=m(T,!0);v(T),v(O);var b=_(O,2),k=_(m(b)),A=m(k,!0);v(k),v(b);var ve=_(b,2),W=_(m(ve)),_e=m(W,!0);v(W),v(ve);var se=_(ve,2),ke=m(se);v(se),v(E);var Z=_(E,2),oe=m(Z),Ne=_(m(oe),2);{var at=B=>{var J=ui(),q=m(J,!0);v(J),ue(()=>j(q,a()?"Hide":"Show")),N("click",J,function(...Ce){f()?.apply(this,Ce)}),L(B,J)};pe(Ne,B=>{ne(i()),K(()=>i().length>0)&&B(at)})}v(oe);var lt=_(oe,2);{var Je=B=>{var J=fi();L(B,J)},Ie=B=>{var J=vi(),q=Ee(J),Ce=m(q);v(q);var $e=_(q,2);{var Fe=Ae=>{var Me=pi();Lt(Me,5,i,Ot,(me,we,be)=>{var et=hi(),je=m(et),Re=m(je),bt=m(Re);v(Re);var Be=_(Re,2),dt=m(Be,!0);v(Be),v(je);var Ke=_(je,2),ut=m(Ke,!0);v(Ke),v(et),ue(D=>{j(bt,`${be+1}. ${r(we),K(()=>r(we).docTitle)??""}`),j(dt,D),j(ut,(r(we),K(()=>r(we).content)))},[()=>(r(we),K(()=>r(we).score.toFixed(3)))]),L(me,et)}),v(Me),L(Ae,Me)};pe($e,Ae=>{a()&&Ae(Fe)})}ue(()=>j(Ce,`${ne(i()),K(()=>i().length)??""} chunk(s) selected`)),L(B,J)};pe(lt,B=>{ne(i()),K(()=>i().length===0)?B(Je):B(Ie,!1)})}v(Z);var ct=_(Z,2),He=_(m(ct),2);{var Ve=B=>{var J=mi(),q=m(J,!0);v(J),ue(()=>j(q,s())),L(B,J)},We=B=>{var J=gi(),q=m(J,!0);v(J),ue(()=>j(q,h())),L(B,J)},Ge=B=>{var J=_i();L(B,J)};pe(He,B=>{s()?B(Ve):h()?B(We,1):B(Ge,!1)})}v(ct),v(M),ue(()=>{C=qe(M,1,"context-column",null,C,{"mobile-open":o()&&t()}),j(z,l()),j(A,d()),j(_e,c()?"Loaded":"Missing")}),N("click",ke,()=>S()("connection")),L(n,M),Bt()}var bi=V('<p class="rail-note">No conversation yet. Start a new chat.</p>'),Si=V('<div class="session-edit"><input type="text" class="session-title-input"/> <button type="button" class="icon-btn mini-btn session-rename-confirm" aria-label="Save title"><!></button> <button type="button" class="icon-btn mini-btn" aria-label="Cancel rename"><!></button></div>'),xi=V('<button type="button" class="session-btn"><span class="session-title"> </span> <span class="session-meta"> </span></button> <div class="session-actions"><button type="button" class="icon-btn mini-btn" aria-label="Rename chat"><!></button> <button type="button" class="icon-btn mini-btn session-delete danger" aria-label="Delete chat"><!></button></div>',1),Ci=V("<div><!></div>"),ki=V('<div class="session-list"></div>'),Ii=V('<aside><button type="button" class="icon-btn rail-toggle" aria-label="Close side menu"><!></button> <div class="rail-content"><div class="brand"><p class="kicker">Static Rag Chat</p> <h1 class="rail-label">Static Rag Chat</h1> <p class="rail-note">Share one URL + your own API key so anyone can run the same Static Rag Chat session.</p></div> <div class="rail-actions"><button type="button"><span class="rail-icon" aria-hidden="true"><!></span> <span class="rail-label">New Chat</span></button> <button type="button" class="ghost"><span class="rail-icon" aria-hidden="true"><!></span> <span class="rail-label">Settings</span></button> <button type="button" class="ghost"><span class="rail-icon" aria-hidden="true"><!></span> <span class="rail-label"> </span></button></div> <section class="rail-card primary"><h2> </h2> <p> </p> <div class="chip-row"><span> </span> <span> </span></div></section> <section class="rail-card"><div class="card-head"><h3>Chat List</h3> <span class="pill"> </span></div> <!></section> <section class="rail-card"><div class="card-head"><h3>Share Bundle</h3> <span> </span></div> <p class="rail-note">Pack the RAG payload into the URL hash to share and deploy directly.</p> <div class="rail-inline-actions"><button type="button" class="ghost">Copy URL</button> <button type="button" class="ghost">RAG</button></div> <p class="rail-meta"> </p></section></div></aside>');function Ai(n,e){jt(e,!1);let t=w(e,"mobileOpen",8),o=w(e,"payloadTitle",8),i=w(e,"docCount",8),a=w(e,"docChars",8),l=w(e,"providerLabel",8),d=w(e,"model",8),c=w(e,"chatSessions",24,()=>[]),s=w(e,"activeSessionId",8),h=w(e,"urlRisk",8,"ok"),g=w(e,"urlLength",8),f=w(e,"encodedLength",8),S=w(e,"theme",8),M=w(e,"formatMessageTime",8),C=w(e,"onStartNewSession",8),y=w(e,"onCloseMobileRail",8),I=w(e,"onOpenSettings",8),E=w(e,"onToggleTheme",8),O=w(e,"onSetActiveSession",8),T=w(e,"onDeleteSession",8),z=w(e,"onRenameSession",8),b=w(e,"onCopyShareUrl",8),k=F(""),A=F("");function ve(){y()()}function W(P,ce,ge){P.preventDefault(),P.stopPropagation(),p(k,ce),p(A,ge)}function _e(P){P&&(P.preventDefault(),P.stopPropagation()),p(k,""),p(A,"")}function se(P,ce){if(P.preventDefault(),P.stopPropagation(),r(k)!==ce)return;const ge=r(A).trim();if(!ge){_e();return}z()(ce,ge),p(k,""),p(A,"")}function ke(P,ce){P.key==="Enter"&&(P.preventDefault(),se(P,ce)),P.key==="Escape"&&(P.preventDefault(),_e())}Vt();var Z=Ii();let oe;var Ne=m(Z),at=m(Ne);Co(at,{size:18}),v(Ne);var lt=_(Ne,2),Je=_(m(lt),2),Ie=m(Je),ct=m(Ie),He=m(ct);Qr(He,{size:16}),v(ct),ln(2),v(Ie);var Ve=_(Ie,2),We=m(Ve),Ge=m(We);Zr(Ge,{size:16}),v(We),ln(2),v(Ve);var B=_(Ve,2),J=m(B),q=m(J);{var Ce=P=>{qr(P,{size:16})},$e=P=>{$r(P,{size:16})};pe(q,P=>{S()==="dark"?P(Ce):P($e,!1)})}v(J);var Fe=_(J,2),Ae=m(Fe,!0);v(Fe),v(B),v(Je);var Me=_(Je,2),me=m(Me),we=m(me,!0);v(me);var be=_(me,2),et=m(be);v(be);var je=_(be,2),Re=m(je),bt=m(Re,!0);v(Re);var Be=_(Re,2),dt=m(Be,!0);v(Be),v(je),v(Me);var Ke=_(Me,2),ut=m(Ke),D=_(m(ut),2),$=m(D,!0);v(D),v(ut);var Le=_(ut,2);{var mt=P=>{var ce=bi();L(P,ce)},X=P=>{var ce=ki();Lt(ce,5,c,ge=>ge.id,(ge,Q)=>{var tt=Ci(),gt=m(tt);{var ft=ze=>{var Ye=Si(),le=m(Ye);_t(le);var Ue=_(le,2),Qe=m(Ue);Wr(Qe,{size:13}),v(Ue);var nt=_(Ue,2),te=m(nt);Fn(te,{size:13}),v(nt),v(Ye),Ct(le,()=>r(A),U=>p(A,U)),N("focus",le,U=>U.currentTarget.select()),N("keydown",le,U=>ke(U,r(Q).id)),N("focusout",le,U=>se(U,r(Q).id)),N("click",Ue,U=>se(U,r(Q).id)),N("click",nt,_e),L(ze,Ye)},St=ze=>{var Ye=xi(),le=Ee(Ye),Ue=m(le),Qe=m(Ue,!0);v(Ue);var nt=_(Ue,2),te=m(nt);v(nt),v(le);var U=_(le,2),ye=m(U),Te=m(ye);Yr(Te,{size:13}),v(ye);var Xe=_(ye,2),It=m(Xe);ei(It,{size:14}),v(Xe),v(U),ue(ot=>{j(Qe,(r(Q),K(()=>r(Q).title))),j(te,`${r(Q),K(()=>r(Q).messages.length)??""} msgs · ${ot??""}`)},[()=>(ne(M()),r(Q),K(()=>M()(r(Q).updatedAt)))]),N("click",le,()=>O()(r(Q).id)),N("click",ye,ot=>W(ot,r(Q).id,r(Q).title)),N("click",Xe,ot=>T()(ot,r(Q).id)),L(ze,Ye)};pe(gt,ze=>{r(k),r(Q),K(()=>r(k)===r(Q).id)?ze(ft):ze(St,!1)})}v(tt),ue(()=>qe(tt,1,`session-item ${ne(s()),r(Q),K(()=>s()===r(Q).id?"active":"")??""}`)),L(ge,tt)}),v(ce),L(P,ce)};pe(Le,P=>{ne(c()),K(()=>c().length===0)?P(mt):P(X,!1)})}v(Ke);var fe=_(Ke,2),H=m(fe),ee=_(m(H),2),Se=m(ee,!0);v(ee),v(H);var he=_(H,4),ae=m(he),re=_(ae,2);v(he);var Y=_(he,2),ie=m(Y);v(Y),v(fe),v(lt),v(Z),ue((P,ce,ge)=>{oe=qe(Z,1,"left-rail",null,oe,{"mobile-open":t()}),j(Ae,S()==="dark"?"Switch Light":"Switch Dark"),j(we,o()),j(et,`${i()??""} docs · ${P??""} chars`),j(bt,l()),j(dt,d()),j($,(ne(c()),K(()=>c().length))),qe(ee,1,`pill ${h()??""}`),j(Se,h()==="ok"?"Stable":h()==="warn"?"Long":"Risky"),j(ie,`URL length ${ce??""} / payload ${ge??""}`)},[()=>(ne(a()),K(()=>a().toLocaleString())),()=>(ne(g()),K(()=>g().toLocaleString())),()=>(ne(f()),K(()=>f().toLocaleString()))]),N("click",Ne,ve),N("click",Ie,function(...P){C()?.apply(this,P)}),N("click",Ve,()=>I()("connection")),N("click",B,function(...P){E()?.apply(this,P)}),N("click",ae,function(...P){b()?.apply(this,P)}),N("click",re,()=>I()("data")),L(n,Z),Bt()}var Mi=V('<p class="error"> </p>'),Ti=V('<p class="error"> </p>'),Ei=V('<p class="status"> </p>'),Ri=V('<div class="settings-alert-stack"><!> <!></div>'),Li=V("<option> </option>"),zi=V('<input type="text" disabled=""/>'),Pi=V("<option> </option>"),Oi=V("<option> </option>"),Di=V("<select><!><!></select>"),Ni=V('<input type="text"/>'),Fi=V(`<div class="panel-block"><h3>Provider & Model</h3> <div class="theme-row"><span class="theme-label">Theme</span> <div class="theme-options"><button type="button">Light</button> <button type="button">Dark</button></div></div> <label>Provider <select></select></label> <label>API key (saved in localStorage) <input type="password" placeholder="Paste your API key"/></label> <label class="toggle-field"><span><input type="checkbox" aria-label="Save API key in this browser"/> Save API key in localStorage</span> <small class="caution">Notice: localStorage is stored only in this browser. Disable saving on shared computers and delete
							it after use.</small></label> <label>Model <!></label> <div class="actions"><button type="button" class="ghost"> </button></div></div>`),Ki=V('<div class="panel-block"><h3>System Prompt</h3> <label>Chat title <input type="text"/></label> <label>System prompt <textarea rows="4"></textarea></label> <div class="actions"><button type="button">Apply Settings</button></div></div>'),Ui=V('<article><div class="doc-head"><strong> </strong> <button type="button" class="danger">Remove</button></div> <p> </p></article>'),Vi=V('<div class="panel-block"><h3>Documents</h3> <p class="help"> </p> <div class="doc-list"></div> <label>New document title (optional) <input type="text" placeholder="Example: Product FAQ"/></label> <label>New document content <textarea rows="5" placeholder="Paste source text here"></textarea></label> <div class="actions"><button type="button">Add Document</button></div> <label>Import files (.txt, .md, .json) <input type="file" multiple="" accept=".txt,.md,.json"/></label> <label>Import from shared URL/hash <input type="text" placeholder="https://.../#r=... or #r=..."/></label> <div class="actions"><button type="button" class="ghost">Import URL Payload</button></div></div> <div class="panel-block"><h3>Retrieval Settings</h3> <div class="retrieval-grid"><label>Top K <input type="number" min="1" max="12"/></label> <label>Chunk size <input type="number" min="200" max="4000" step="50"/></label> <label>Overlap <input type="number" min="0" max="2000" step="10"/></label></div> <div class="actions"><button type="button">Apply Settings</button></div></div> <div class="panel-block"><h3>Advanced JSON</h3> <textarea rows="12" spellcheck="false"></textarea> <div class="actions"><button type="button">Apply JSON</button> <button type="button" class="ghost">Reset Sample</button></div></div>',1),ji=V('<div role="presentation"><div role="dialog" aria-modal="true" aria-label="Settings"><header class="drawer-head"><div><p class="kicker">Configuration</p> <h2>Settings</h2></div> <button type="button" class="icon-btn" aria-label="Close settings"><!></button></header> <nav class="tab-row" aria-label="settings tabs"><button type="button">Connection</button> <button type="button">System Prompt</button> <button type="button">RAG</button></nav> <div class="tab-panel"><!> <!></div></div></div>');function Bi(n,e){jt(e,!1);let t=w(e,"settingsOpen",8,!1),o=w(e,"settingsPresentation",8,"modal"),i=w(e,"settingsTab",8,"connection"),a=w(e,"providers",24,()=>[]),l=w(e,"provider",8,"openai"),d=w(e,"theme",8,"light"),c=w(e,"model",8,""),s=w(e,"modelOptions",24,()=>[]),h=w(e,"isModelCatalogLoading",8,!1),g=w(e,"modelCatalogError",8,""),f=w(e,"apiKey",8,""),S=w(e,"persistApiKey",8,!1),M=w(e,"payloadError",8,""),C=w(e,"status",8,""),y=w(e,"titleInput",12,""),I=w(e,"systemPromptInput",12,""),E=w(e,"topKInput",12,1),O=w(e,"chunkSizeInput",12,500),T=w(e,"overlapInput",12,100),z=w(e,"newDocTitle",12,""),b=w(e,"newDocContent",12,""),k=w(e,"importUrl",12,""),A=w(e,"payloadJson",12,""),ve=w(e,"docCount",8,0),W=w(e,"docChars",8,0),_e=w(e,"docs",24,()=>[]),se=w(e,"onClose",8),ke=w(e,"onSetTheme",8),Z=w(e,"onSelectTab",8),oe=w(e,"onProviderChange",8),Ne=w(e,"onApiKeyInput",8),at=w(e,"onApiKeySaveToggle",8),lt=w(e,"onModelInput",8),Je=w(e,"onRefreshModels",8),Ie=w(e,"onApplyBuilderSettings",8),ct=w(e,"onAddDocument",8),He=w(e,"onRemoveDocument",8),Ve=w(e,"onFileInput",8),We=w(e,"onApplyImportUrl",8),Ge=w(e,"onApplyPayloadJson",8),B=w(e,"onResetPayload",8);function J(X){X.target===X.currentTarget&&se()()}Vt();var q=ji();let Ce;var $e=m(q);let Fe;var Ae=m($e),Me=_(m(Ae),2),me=m(Me);Fn(me,{size:18}),v(Me),v(Ae);var we=_(Ae,2),be=m(we);let et;var je=_(be,2);let Re;var bt=_(je,2);let Be;v(we);var dt=_(we,2),Ke=m(dt);{var ut=X=>{var fe=Ri(),H=m(fe);{var ee=re=>{var Y=Mi(),ie=m(Y,!0);v(Y),ue(()=>j(ie,g())),L(re,Y)};pe(H,re=>{i()==="connection"&&g()&&re(ee)})}var Se=_(H,2);{var he=re=>{var Y=Ti(),ie=m(Y,!0);v(Y),ue(()=>j(ie,M())),L(re,Y)},ae=re=>{var Y=Ei(),ie=m(Y,!0);v(Y),ue(()=>j(ie,C())),L(re,Y)};pe(Se,re=>{M()?re(he):C()&&re(ae,1)})}v(fe),L(X,fe)};pe(Ke,X=>{(i()==="connection"&&g()||M()||C())&&X(ut)})}var D=_(Ke,2);{var $=X=>{var fe=Fi(),H=_(m(fe),2),ee=_(m(H),2),Se=m(ee);let he;var ae=_(Se,2);let re;v(ee),v(H);var Y=_(H,2),ie=_(m(Y));Lt(ie,5,a,Ot,(te,U)=>{var ye=Li(),Te=m(ye,!0);v(ye);var Xe={};ue(()=>{j(Te,(ne(kt),r(U),K(()=>kt[r(U)]))),Xe!==(Xe=r(U))&&(ye.value=(ye.__value=r(U))??"")}),L(te,ye)}),v(ie);var P;Xn(ie),v(Y);var ce=_(Y,2),ge=_(m(ce));_t(ge),v(ce);var Q=_(ce,2),tt=m(Q),gt=m(tt);_t(gt),ln(),v(tt),ln(2),v(Q);var ft=_(Q,2),St=_(m(ft));{var ze=te=>{var U=zi();_t(U),ue(()=>rn(U,c())),L(te,U)},Ye=te=>{var U=Di(),ye=m(U);Lt(ye,1,s,Ot,(ht,rt)=>{var de=Pi(),Ze=m(de,!0);v(de);var Dt={};ue(()=>{j(Ze,r(rt)),Dt!==(Dt=r(rt))&&(de.value=(de.__value=r(rt))??"")}),L(ht,de)});var Te=_(ye);{var Xe=ht=>{var rt=Oi(),de=m(rt,!0);v(rt);var Ze={};ue(()=>{j(de,c()),Ze!==(Ze=c())&&(rt.value=(rt.__value=c())??"")}),L(ht,rt)},It=So(()=>(ne(c()),ne(s()),K(()=>c()&&!s().includes(c()))));pe(Te,ht=>{r(It)&&ht(Xe)})}v(U);var ot;Xn(U),ue(()=>{ot!==(ot=c())&&(U.value=(U.__value=c())??"",Zn(U,c()))}),N("change",U,function(...ht){lt()?.apply(this,ht)}),L(te,U)},le=te=>{var U=Ni();_t(U),ue(()=>rn(U,c())),N("input",U,function(...ye){lt()?.apply(this,ye)}),L(te,U)};pe(St,te=>{h()?te(ze):(ne(s()),K(()=>s().length>0)?te(Ye,1):te(le,!1))})}v(ft);var Ue=_(ft,2),Qe=m(Ue),nt=m(Qe,!0);v(Qe),v(Ue),v(fe),ue(()=>{he=qe(Se,1,"ghost theme-option",null,he,{"selected-theme":d()==="light"}),re=qe(ae,1,"ghost theme-option",null,re,{"selected-theme":d()==="dark"}),P!==(P=l())&&(ie.value=(ie.__value=l())??"",Zn(ie,l())),rn(ge,f()),Cr(gt,S()),Qe.disabled=h(),j(nt,h()?"Loading models…":"Refresh model list")}),N("click",Se,()=>ke()("light")),N("click",ae,()=>ke()("dark")),N("change",ie,function(...te){oe()?.apply(this,te)}),N("input",ge,function(...te){Ne()?.apply(this,te)}),N("change",gt,function(...te){at()?.apply(this,te)}),N("click",Qe,function(...te){Je()?.apply(this,te)}),L(X,fe)},Le=X=>{var fe=Ki(),H=_(m(fe),2),ee=_(m(H));_t(ee),v(H);var Se=_(H,2),he=_(m(Se));on(he),v(Se);var ae=_(Se,2),re=m(ae);v(ae),v(fe),Ct(ee,y),Ct(he,I),N("click",re,function(...Y){Ie()?.apply(this,Y)}),L(X,fe)},mt=X=>{var fe=Vi(),H=Ee(fe),ee=_(m(H),2),Se=m(ee);v(ee);var he=_(ee,2);Lt(he,5,_e,Ot,(de,Ze,Dt)=>{var Ht=Ui(),Wt=m(Ht),Gt=m(Wt),dn=m(Gt);v(Gt);var un=_(Gt,2);v(Wt);var Xt=_(Wt,2),Zt=m(Xt);v(Xt),v(Ht),ue(qt=>{j(dn,`${Dt+1}. ${r(Ze),K(()=>r(Ze).title)??""}`),j(Zt,`${qt??""}${r(Ze),K(()=>r(Ze).content.length>220?"...":"")??""}`)},[()=>(r(Ze),K(()=>r(Ze).content.slice(0,220)))]),N("click",un,()=>He()(r(Ze).id)),L(de,Ht)}),v(he);var ae=_(he,2),re=_(m(ae));_t(re),v(ae);var Y=_(ae,2),ie=_(m(Y));on(ie),v(Y);var P=_(Y,2),ce=m(P);v(P);var ge=_(P,2),Q=_(m(ge));v(ge);var tt=_(ge,2),gt=_(m(tt));_t(gt),v(tt);var ft=_(tt,2),St=m(ft);v(ft),v(H);var ze=_(H,2),Ye=_(m(ze),2),le=m(Ye),Ue=_(m(le));_t(Ue),v(le);var Qe=_(le,2),nt=_(m(Qe));_t(nt),v(Qe);var te=_(Qe,2),U=_(m(te));_t(U),v(te),v(Ye);var ye=_(Ye,2),Te=m(ye);v(ye),v(ze);var Xe=_(ze,2),It=_(m(Xe),2);on(It);var ot=_(It,2),ht=m(ot),rt=_(ht,2);v(ot),v(Xe),ue(de=>j(Se,`${ve()??""} doc(s), ${de??""} characters`),[()=>(ne(W()),K(()=>W().toLocaleString()))]),Ct(re,z),Ct(ie,b),N("click",ce,function(...de){ct()?.apply(this,de)}),N("change",Q,function(...de){Ve()?.apply(this,de)}),Ct(gt,k),N("click",St,function(...de){We()?.apply(this,de)}),Ct(Ue,E),Ct(nt,O),Ct(U,T),N("click",Te,function(...de){Ie()?.apply(this,de)}),Ct(It,A),N("click",ht,function(...de){Ge()?.apply(this,de)}),N("click",rt,function(...de){B()?.apply(this,de)}),L(X,fe)};pe(D,X=>{i()==="connection"?X($):i()==="systemPrompt"?X(Le,1):X(mt,!1)})}v(dt),v($e),v(q),ue(()=>{Ce=qe(q,1,"settings-drawer-backdrop",null,Ce,{open:t(),modal:o()==="modal"}),Fe=qe($e,1,"settings-drawer",null,Fe,{open:t(),modal:o()==="modal",drawer:o()==="drawer"}),et=qe(be,1,"",null,et,{selected:i()==="connection"}),Re=qe(je,1,"",null,Re,{selected:i()==="systemPrompt"}),Be=qe(bt,1,"",null,Be,{selected:i()==="data"})}),N("click",Me,function(...X){se()?.apply(this,X)}),N("click",be,()=>Z()("connection")),N("click",je,()=>Z()("systemPrompt")),N("click",bt,()=>Z()("data")),N("click",q,J),L(n,q),Bt()}var gn={exports:{}},to;function Ji(){return to||(to=1,(function(n){var e=(function(){var t=String.fromCharCode,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",a={};function l(c,s){if(!a[c]){a[c]={};for(var h=0;h<c.length;h++)a[c][c.charAt(h)]=h}return a[c][s]}var d={compressToBase64:function(c){if(c==null)return"";var s=d._compress(c,6,function(h){return o.charAt(h)});switch(s.length%4){default:case 0:return s;case 1:return s+"===";case 2:return s+"==";case 3:return s+"="}},decompressFromBase64:function(c){return c==null?"":c==""?null:d._decompress(c.length,32,function(s){return l(o,c.charAt(s))})},compressToUTF16:function(c){return c==null?"":d._compress(c,15,function(s){return t(s+32)})+" "},decompressFromUTF16:function(c){return c==null?"":c==""?null:d._decompress(c.length,16384,function(s){return c.charCodeAt(s)-32})},compressToUint8Array:function(c){for(var s=d.compress(c),h=new Uint8Array(s.length*2),g=0,f=s.length;g<f;g++){var S=s.charCodeAt(g);h[g*2]=S>>>8,h[g*2+1]=S%256}return h},decompressFromUint8Array:function(c){if(c==null)return d.decompress(c);for(var s=new Array(c.length/2),h=0,g=s.length;h<g;h++)s[h]=c[h*2]*256+c[h*2+1];var f=[];return s.forEach(function(S){f.push(t(S))}),d.decompress(f.join(""))},compressToEncodedURIComponent:function(c){return c==null?"":d._compress(c,6,function(s){return i.charAt(s)})},decompressFromEncodedURIComponent:function(c){return c==null?"":c==""?null:(c=c.replace(/ /g,"+"),d._decompress(c.length,32,function(s){return l(i,c.charAt(s))}))},compress:function(c){return d._compress(c,16,function(s){return t(s)})},_compress:function(c,s,h){if(c==null)return"";var g,f,S={},M={},C="",y="",I="",E=2,O=3,T=2,z=[],b=0,k=0,A;for(A=0;A<c.length;A+=1)if(C=c.charAt(A),Object.prototype.hasOwnProperty.call(S,C)||(S[C]=O++,M[C]=!0),y=I+C,Object.prototype.hasOwnProperty.call(S,y))I=y;else{if(Object.prototype.hasOwnProperty.call(M,I)){if(I.charCodeAt(0)<256){for(g=0;g<T;g++)b=b<<1,k==s-1?(k=0,z.push(h(b)),b=0):k++;for(f=I.charCodeAt(0),g=0;g<8;g++)b=b<<1|f&1,k==s-1?(k=0,z.push(h(b)),b=0):k++,f=f>>1}else{for(f=1,g=0;g<T;g++)b=b<<1|f,k==s-1?(k=0,z.push(h(b)),b=0):k++,f=0;for(f=I.charCodeAt(0),g=0;g<16;g++)b=b<<1|f&1,k==s-1?(k=0,z.push(h(b)),b=0):k++,f=f>>1}E--,E==0&&(E=Math.pow(2,T),T++),delete M[I]}else for(f=S[I],g=0;g<T;g++)b=b<<1|f&1,k==s-1?(k=0,z.push(h(b)),b=0):k++,f=f>>1;E--,E==0&&(E=Math.pow(2,T),T++),S[y]=O++,I=String(C)}if(I!==""){if(Object.prototype.hasOwnProperty.call(M,I)){if(I.charCodeAt(0)<256){for(g=0;g<T;g++)b=b<<1,k==s-1?(k=0,z.push(h(b)),b=0):k++;for(f=I.charCodeAt(0),g=0;g<8;g++)b=b<<1|f&1,k==s-1?(k=0,z.push(h(b)),b=0):k++,f=f>>1}else{for(f=1,g=0;g<T;g++)b=b<<1|f,k==s-1?(k=0,z.push(h(b)),b=0):k++,f=0;for(f=I.charCodeAt(0),g=0;g<16;g++)b=b<<1|f&1,k==s-1?(k=0,z.push(h(b)),b=0):k++,f=f>>1}E--,E==0&&(E=Math.pow(2,T),T++),delete M[I]}else for(f=S[I],g=0;g<T;g++)b=b<<1|f&1,k==s-1?(k=0,z.push(h(b)),b=0):k++,f=f>>1;E--,E==0&&(E=Math.pow(2,T),T++)}for(f=2,g=0;g<T;g++)b=b<<1|f&1,k==s-1?(k=0,z.push(h(b)),b=0):k++,f=f>>1;for(;;)if(b=b<<1,k==s-1){z.push(h(b));break}else k++;return z.join("")},decompress:function(c){return c==null?"":c==""?null:d._decompress(c.length,32768,function(s){return c.charCodeAt(s)})},_decompress:function(c,s,h){var g=[],f=4,S=4,M=3,C="",y=[],I,E,O,T,z,b,k,A={val:h(0),position:s,index:1};for(I=0;I<3;I+=1)g[I]=I;for(O=0,z=Math.pow(2,2),b=1;b!=z;)T=A.val&A.position,A.position>>=1,A.position==0&&(A.position=s,A.val=h(A.index++)),O|=(T>0?1:0)*b,b<<=1;switch(O){case 0:for(O=0,z=Math.pow(2,8),b=1;b!=z;)T=A.val&A.position,A.position>>=1,A.position==0&&(A.position=s,A.val=h(A.index++)),O|=(T>0?1:0)*b,b<<=1;k=t(O);break;case 1:for(O=0,z=Math.pow(2,16),b=1;b!=z;)T=A.val&A.position,A.position>>=1,A.position==0&&(A.position=s,A.val=h(A.index++)),O|=(T>0?1:0)*b,b<<=1;k=t(O);break;case 2:return""}for(g[3]=k,E=k,y.push(k);;){if(A.index>c)return"";for(O=0,z=Math.pow(2,M),b=1;b!=z;)T=A.val&A.position,A.position>>=1,A.position==0&&(A.position=s,A.val=h(A.index++)),O|=(T>0?1:0)*b,b<<=1;switch(k=O){case 0:for(O=0,z=Math.pow(2,8),b=1;b!=z;)T=A.val&A.position,A.position>>=1,A.position==0&&(A.position=s,A.val=h(A.index++)),O|=(T>0?1:0)*b,b<<=1;g[S++]=t(O),k=S-1,f--;break;case 1:for(O=0,z=Math.pow(2,16),b=1;b!=z;)T=A.val&A.position,A.position>>=1,A.position==0&&(A.position=s,A.val=h(A.index++)),O|=(T>0?1:0)*b,b<<=1;g[S++]=t(O),k=S-1,f--;break;case 2:return y.join("")}if(f==0&&(f=Math.pow(2,M),M++),g[k])C=g[k];else if(k===S)C=E+E.charAt(0);else return null;y.push(C),g[S++]=E+C.charAt(0),f--,E=C,f==0&&(f=Math.pow(2,M),M++)}}};return d})();n!=null?n.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})(gn)),gn.exports}var ko=Ji();const no=1,Rn="r",sn={topK:4,chunkSize:800,overlap:120},Hi=`Static Rag Chat is a static chat app that compresses RAG documents into a URL hash for sharing.
Context data travels inside the shared URL, and each user can reproduce the same session by entering their own API key locally in the browser.
The key idea is that one URL can share the same contextual conversation without running any backend.`;function oo(){return{v:1,title:"Static Rag Chat",systemPrompt:"You are a helpful assistant. Prefer answers grounded in the provided context. If the context is insufficient, clearly say what is missing.",docs:[{id:"doc-1",title:"About Static Rag Chat",content:Hi}],retrieval:{...sn}}}function Wi(n,e){const t=typeof n=="object"&&n!==null?n:{},o=typeof t.id=="string"&&t.id.trim()?t.id.trim():`doc-${e+1}`,i=typeof t.title=="string"&&t.title.trim()?t.title.trim():`Document ${e+1}`,a=typeof t.content=="string"?t.content.trim():"";return{id:o,title:i,content:a}}function Tt(n){if(typeof n!="object"||n===null)throw new Error("Payload must be a JSON object.");const e=n,o=(Array.isArray(e.docs)?e.docs:[]).map((S,M)=>Wi(S,M)).filter(S=>S.content.length>0),i=typeof e.retrieval=="object"&&e.retrieval!==null?e.retrieval:{},a=Number(i.topK),l=Number(i.chunkSize),d=Number(i.overlap),c=Number.isFinite(a)?Math.min(Math.max(Math.floor(a),1),12):sn.topK,s=Number.isFinite(l)&&l>=200?Math.min(Math.floor(l),4e3):sn.chunkSize,h=Number.isFinite(d)&&d>=0?Math.min(Math.floor(d),Math.floor(s/2)):sn.overlap,g=Number(e.v),f=Number.isFinite(g)?Math.floor(g):no;if(f!==no)throw new Error(`Unsupported payload version: ${f}`);return{v:1,title:typeof e.title=="string"&&e.title.trim()?e.title.trim():"Static Rag Chat",systemPrompt:typeof e.systemPrompt=="string"?e.systemPrompt.trim():"",docs:o,retrieval:{topK:c,chunkSize:s,overlap:h}}}function Io(n){const e=Tt(n),t=JSON.stringify(e),o=ko.compressToEncodedURIComponent(t);if(!o)throw new Error("Failed to encode payload.");return o}function Gi(n){const e=ko.decompressFromEncodedURIComponent(n);if(!e)throw new Error("Invalid encoded payload.");const t=JSON.parse(e);return Tt(t)}function $i(n){const e=n.startsWith("#")?n.slice(1):n;if(!e)return null;const t=new URLSearchParams(e);return t.has(Rn)?t.get(Rn):e}function ro(n){return`#${Rn}=${Io(n)}`}function io(n){const e=$i(n);if(!e)return{payload:null,error:null};try{return{payload:Gi(e),error:null}}catch(t){return{payload:null,error:t instanceof Error?t.message:"Unable to parse URL payload."}}}function _n(n){return JSON.stringify(n,null,2)}const Yi="ENTRIES",Ao="KEYS",Mo="VALUES",De="";class yn{constructor(e,t){const o=e._tree,i=Array.from(o.keys());this.set=e,this._type=t,this._path=i.length>0?[{node:o,keys:i}]:[]}next(){const e=this.dive();return this.backtrack(),e}dive(){if(this._path.length===0)return{done:!0,value:void 0};const{node:e,keys:t}=Nt(this._path);if(Nt(t)===De)return{done:!1,value:this.result()};const o=e.get(Nt(t));return this._path.push({node:o,keys:Array.from(o.keys())}),this.dive()}backtrack(){if(this._path.length===0)return;const e=Nt(this._path).keys;e.pop(),!(e.length>0)&&(this._path.pop(),this.backtrack())}key(){return this.set._prefix+this._path.map(({keys:e})=>Nt(e)).filter(e=>e!==De).join("")}value(){return Nt(this._path).node.get(De)}result(){switch(this._type){case Mo:return this.value();case Ao:return this.key();default:return[this.key(),this.value()]}}[Symbol.iterator](){return this}}const Nt=n=>n[n.length-1],Qi=(n,e,t)=>{const o=new Map;if(e===void 0)return o;const i=e.length+1,a=i+t,l=new Uint8Array(a*i).fill(t+1);for(let d=0;d<i;++d)l[d]=d;for(let d=1;d<a;++d)l[d*i]=d;return To(n,e,t,o,l,1,i,""),o},To=(n,e,t,o,i,a,l,d)=>{const c=a*l;e:for(const s of n.keys())if(s===De){const h=i[c-1];h<=t&&o.set(d,[n.get(s),h])}else{let h=a;for(let g=0;g<s.length;++g,++h){const f=s[g],S=l*h,M=S-l;let C=i[S];const y=Math.max(0,h-t-1),I=Math.min(l-1,h+t);for(let E=y;E<I;++E){const O=f!==e[E],T=i[M+E]+ +O,z=i[M+E+1]+1,b=i[S+E]+1,k=i[S+E+1]=Math.min(T,z,b);k<C&&(C=k)}if(C>t)continue e}To(n.get(s),e,t,o,i,h,l,d+s)}};class Et{constructor(e=new Map,t=""){this._size=void 0,this._tree=e,this._prefix=t}atPrefix(e){if(!e.startsWith(this._prefix))throw new Error("Mismatched prefix");const[t,o]=cn(this._tree,e.slice(this._prefix.length));if(t===void 0){const[i,a]=Kn(o);for(const l of i.keys())if(l!==De&&l.startsWith(a)){const d=new Map;return d.set(l.slice(a.length),i.get(l)),new Et(d,e)}}return new Et(t,e)}clear(){this._size=void 0,this._tree.clear()}delete(e){return this._size=void 0,Xi(this._tree,e)}entries(){return new yn(this,Yi)}forEach(e){for(const[t,o]of this)e(t,o,this)}fuzzyGet(e,t){return Qi(this._tree,e,t)}get(e){const t=Ln(this._tree,e);return t!==void 0?t.get(De):void 0}has(e){const t=Ln(this._tree,e);return t!==void 0&&t.has(De)}keys(){return new yn(this,Ao)}set(e,t){if(typeof e!="string")throw new Error("key must be a string");return this._size=void 0,wn(this._tree,e).set(De,t),this}get size(){if(this._size)return this._size;this._size=0;const e=this.entries();for(;!e.next().done;)this._size+=1;return this._size}update(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;const o=wn(this._tree,e);return o.set(De,t(o.get(De))),this}fetch(e,t){if(typeof e!="string")throw new Error("key must be a string");this._size=void 0;const o=wn(this._tree,e);let i=o.get(De);return i===void 0&&o.set(De,i=t()),i}values(){return new yn(this,Mo)}[Symbol.iterator](){return this.entries()}static from(e){const t=new Et;for(const[o,i]of e)t.set(o,i);return t}static fromObject(e){return Et.from(Object.entries(e))}}const cn=(n,e,t=[])=>{if(e.length===0||n==null)return[n,t];for(const o of n.keys())if(o!==De&&e.startsWith(o))return t.push([n,o]),cn(n.get(o),e.slice(o.length),t);return t.push([n,e]),cn(void 0,"",t)},Ln=(n,e)=>{if(e.length===0||n==null)return n;for(const t of n.keys())if(t!==De&&e.startsWith(t))return Ln(n.get(t),e.slice(t.length))},wn=(n,e)=>{const t=e.length;e:for(let o=0;n&&o<t;){for(const a of n.keys())if(a!==De&&e[o]===a[0]){const l=Math.min(t-o,a.length);let d=1;for(;d<l&&e[o+d]===a[d];)++d;const c=n.get(a);if(d===a.length)n=c;else{const s=new Map;s.set(a.slice(d),c),n.set(e.slice(o,o+d),s),n.delete(a),n=s}o+=d;continue e}const i=new Map;return n.set(e.slice(o),i),i}return n},Xi=(n,e)=>{const[t,o]=cn(n,e);if(t!==void 0){if(t.delete(De),t.size===0)Eo(o);else if(t.size===1){const[i,a]=t.entries().next().value;Ro(o,i,a)}}},Eo=n=>{if(n.length===0)return;const[e,t]=Kn(n);if(e.delete(t),e.size===0)Eo(n.slice(0,-1));else if(e.size===1){const[o,i]=e.entries().next().value;o!==De&&Ro(n.slice(0,-1),o,i)}},Ro=(n,e,t)=>{if(n.length===0)return;const[o,i]=Kn(n);o.set(i+e,t),o.delete(i)},Kn=n=>n[n.length-1],Un="or",Lo="and",Zi="and_not";class Ut{constructor(e){if(e?.fields==null)throw new Error('MiniSearch: option "fields" must be provided');const t=e.autoVacuum==null||e.autoVacuum===!0?xn:e.autoVacuum;this._options={...Sn,...e,autoVacuum:t,searchOptions:{...so,...e.searchOptions||{}},autoSuggestOptions:{...os,...e.autoSuggestOptions||{}}},this._index=new Et,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=Pn,this.addFields(this._options.fields)}add(e){const{extractField:t,stringifyField:o,tokenize:i,processTerm:a,fields:l,idField:d}=this._options,c=t(e,d);if(c==null)throw new Error(`MiniSearch: document does not have ID field "${d}"`);if(this._idToShortId.has(c))throw new Error(`MiniSearch: duplicate ID ${c}`);const s=this.addDocumentId(c);this.saveStoredFields(s,e);for(const h of l){const g=t(e,h);if(g==null)continue;const f=i(o(g,h),h),S=this._fieldIds[h],M=new Set(f).size;this.addFieldLength(s,S,this._documentCount-1,M);for(const C of f){const y=a(C,h);if(Array.isArray(y))for(const I of y)this.addTerm(S,s,I);else y&&this.addTerm(S,s,y)}}}addAll(e){for(const t of e)this.add(t)}addAllAsync(e,t={}){const{chunkSize:o=10}=t,i={chunk:[],promise:Promise.resolve()},{chunk:a,promise:l}=e.reduce(({chunk:d,promise:c},s,h)=>(d.push(s),(h+1)%o===0?{chunk:[],promise:c.then(()=>new Promise(g=>setTimeout(g,0))).then(()=>this.addAll(d))}:{chunk:d,promise:c}),i);return l.then(()=>this.addAll(a))}remove(e){const{tokenize:t,processTerm:o,extractField:i,stringifyField:a,fields:l,idField:d}=this._options,c=i(e,d);if(c==null)throw new Error(`MiniSearch: document does not have ID field "${d}"`);const s=this._idToShortId.get(c);if(s==null)throw new Error(`MiniSearch: cannot remove document with ID ${c}: it is not in the index`);for(const h of l){const g=i(e,h);if(g==null)continue;const f=t(a(g,h),h),S=this._fieldIds[h],M=new Set(f).size;this.removeFieldLength(s,S,this._documentCount,M);for(const C of f){const y=o(C,h);if(Array.isArray(y))for(const I of y)this.removeTerm(S,s,I);else y&&this.removeTerm(S,s,y)}}this._storedFields.delete(s),this._documentIds.delete(s),this._idToShortId.delete(c),this._fieldLength.delete(s),this._documentCount-=1}removeAll(e){if(e)for(const t of e)this.remove(t);else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new Et,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}}discard(e){const t=this._idToShortId.get(e);if(t==null)throw new Error(`MiniSearch: cannot discard document with ID ${e}: it is not in the index`);this._idToShortId.delete(e),this._documentIds.delete(t),this._storedFields.delete(t),(this._fieldLength.get(t)||[]).forEach((o,i)=>{this.removeFieldLength(t,i,this._documentCount,o)}),this._fieldLength.delete(t),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()}maybeAutoVacuum(){if(this._options.autoVacuum===!1)return;const{minDirtFactor:e,minDirtCount:t,batchSize:o,batchWait:i}=this._options.autoVacuum;this.conditionalVacuum({batchSize:o,batchWait:i},{minDirtCount:t,minDirtFactor:e})}discardAll(e){const t=this._options.autoVacuum;try{this._options.autoVacuum=!1;for(const o of e)this.discard(o)}finally{this._options.autoVacuum=t}this.maybeAutoVacuum()}replace(e){const{idField:t,extractField:o}=this._options,i=o(e,t);this.discard(i),this.add(e)}vacuum(e={}){return this.conditionalVacuum(e)}conditionalVacuum(e,t){return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&t,this._enqueuedVacuum!=null?this._enqueuedVacuum:(this._enqueuedVacuum=this._currentVacuum.then(()=>{const o=this._enqueuedVacuumConditions;return this._enqueuedVacuumConditions=Pn,this.performVacuuming(e,o)}),this._enqueuedVacuum)):this.vacuumConditionsMet(t)===!1?Promise.resolve():(this._currentVacuum=this.performVacuuming(e),this._currentVacuum)}async performVacuuming(e,t){const o=this._dirtCount;if(this.vacuumConditionsMet(t)){const i=e.batchSize||zn.batchSize,a=e.batchWait||zn.batchWait;let l=1;for(const[d,c]of this._index){for(const[s,h]of c)for(const[g]of h)this._documentIds.has(g)||(h.size<=1?c.delete(s):h.delete(g));this._index.get(d).size===0&&this._index.delete(d),l%i===0&&await new Promise(s=>setTimeout(s,a)),l+=1}this._dirtCount-=o}await null,this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null}vacuumConditionsMet(e){if(e==null)return!0;let{minDirtCount:t,minDirtFactor:o}=e;return t=t||xn.minDirtCount,o=o||xn.minDirtFactor,this.dirtCount>=t&&this.dirtFactor>=o}get isVacuuming(){return this._currentVacuum!=null}get dirtCount(){return this._dirtCount}get dirtFactor(){return this._dirtCount/(1+this._documentCount+this._dirtCount)}has(e){return this._idToShortId.has(e)}getStoredFields(e){const t=this._idToShortId.get(e);if(t!=null)return this._storedFields.get(t)}search(e,t={}){const{searchOptions:o}=this._options,i={...o,...t},a=this.executeQuery(e,t),l=[];for(const[d,{score:c,terms:s,match:h}]of a){const g=s.length||1,f={id:this._documentIds.get(d),score:c*g,terms:Object.keys(h),queryTerms:s,match:h};Object.assign(f,this._storedFields.get(d)),(i.filter==null||i.filter(f))&&l.push(f)}return e===Ut.wildcard&&i.boostDocument==null||l.sort(lo),l}autoSuggest(e,t={}){t={...this._options.autoSuggestOptions,...t};const o=new Map;for(const{score:a,terms:l}of this.search(e,t)){const d=l.join(" "),c=o.get(d);c!=null?(c.score+=a,c.count+=1):o.set(d,{score:a,terms:l,count:1})}const i=[];for(const[a,{score:l,terms:d,count:c}]of o)i.push({suggestion:a,terms:d,score:l/c});return i.sort(lo),i}get documentCount(){return this._documentCount}get termCount(){return this._index.size}static loadJSON(e,t){if(t==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(e),t)}static async loadJSONAsync(e,t){if(t==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJSAsync(JSON.parse(e),t)}static getDefault(e){if(Sn.hasOwnProperty(e))return bn(Sn,e);throw new Error(`MiniSearch: unknown option "${e}"`)}static loadJS(e,t){const{index:o,documentIds:i,fieldLength:a,storedFields:l,serializationVersion:d}=e,c=this.instantiateMiniSearch(e,t);c._documentIds=en(i),c._fieldLength=en(a),c._storedFields=en(l);for(const[s,h]of c._documentIds)c._idToShortId.set(h,s);for(const[s,h]of o){const g=new Map;for(const f of Object.keys(h)){let S=h[f];d===1&&(S=S.ds),g.set(parseInt(f,10),en(S))}c._index.set(s,g)}return c}static async loadJSAsync(e,t){const{index:o,documentIds:i,fieldLength:a,storedFields:l,serializationVersion:d}=e,c=this.instantiateMiniSearch(e,t);c._documentIds=await tn(i),c._fieldLength=await tn(a),c._storedFields=await tn(l);for(const[h,g]of c._documentIds)c._idToShortId.set(g,h);let s=0;for(const[h,g]of o){const f=new Map;for(const S of Object.keys(g)){let M=g[S];d===1&&(M=M.ds),f.set(parseInt(S,10),await tn(M))}++s%1e3===0&&await zo(0),c._index.set(h,f)}return c}static instantiateMiniSearch(e,t){const{documentCount:o,nextId:i,fieldIds:a,averageFieldLength:l,dirtCount:d,serializationVersion:c}=e;if(c!==1&&c!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");const s=new Ut(t);return s._documentCount=o,s._nextId=i,s._idToShortId=new Map,s._fieldIds=a,s._avgFieldLength=l,s._dirtCount=d||0,s._index=new Et,s}executeQuery(e,t={}){if(e===Ut.wildcard)return this.executeWildcardQuery(t);if(typeof e!="string"){const f={...t,...e,queries:void 0},S=e.queries.map(M=>this.executeQuery(M,f));return this.combineResults(S,f.combineWith)}const{tokenize:o,processTerm:i,searchOptions:a}=this._options,l={tokenize:o,processTerm:i,...a,...t},{tokenize:d,processTerm:c}=l,g=d(e).flatMap(f=>c(f)).filter(f=>!!f).map(ns(l)).map(f=>this.executeQuerySpec(f,l));return this.combineResults(g,l.combineWith)}executeQuerySpec(e,t){const o={...this._options.searchOptions,...t},i=(o.fields||this._options.fields).reduce((C,y)=>({...C,[y]:bn(o.boost,y)||1}),{}),{boostDocument:a,weights:l,maxFuzzy:d,bm25:c}=o,{fuzzy:s,prefix:h}={...so.weights,...l},g=this._index.get(e.term),f=this.termResults(e.term,e.term,1,e.termBoost,g,i,a,c);let S,M;if(e.prefix&&(S=this._index.atPrefix(e.term)),e.fuzzy){const C=e.fuzzy===!0?.2:e.fuzzy,y=C<1?Math.min(d,Math.round(e.term.length*C)):C;y&&(M=this._index.fuzzyGet(e.term,y))}if(S)for(const[C,y]of S){const I=C.length-e.term.length;if(!I)continue;M?.delete(C);const E=h*C.length/(C.length+.3*I);this.termResults(e.term,C,E,e.termBoost,y,i,a,c,f)}if(M)for(const C of M.keys()){const[y,I]=M.get(C);if(!I)continue;const E=s*C.length/(C.length+I);this.termResults(e.term,C,E,e.termBoost,y,i,a,c,f)}return f}executeWildcardQuery(e){const t=new Map,o={...this._options.searchOptions,...e};for(const[i,a]of this._documentIds){const l=o.boostDocument?o.boostDocument(a,"",this._storedFields.get(i)):1;t.set(i,{score:l,terms:[],match:{}})}return t}combineResults(e,t=Un){if(e.length===0)return new Map;const o=t.toLowerCase(),i=qi[o];if(!i)throw new Error(`Invalid combination operator: ${t}`);return e.reduce(i)||new Map}toJSON(){const e=[];for(const[t,o]of this._index){const i={};for(const[a,l]of o)i[a]=Object.fromEntries(l);e.push([t,i])}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:e,serializationVersion:2}}termResults(e,t,o,i,a,l,d,c,s=new Map){if(a==null)return s;for(const h of Object.keys(l)){const g=l[h],f=this._fieldIds[h],S=a.get(f);if(S==null)continue;let M=S.size;const C=this._avgFieldLength[f];for(const y of S.keys()){if(!this._documentIds.has(y)){this.removeTerm(f,y,t),M-=1;continue}const I=d?d(this._documentIds.get(y),t,this._storedFields.get(y)):1;if(!I)continue;const E=S.get(y),O=this._fieldLength.get(y)[f],T=ts(E,M,this._documentCount,O,C,c),z=o*i*g*I*T,b=s.get(y);if(b){b.score+=z,rs(b.terms,e);const k=bn(b.match,t);k?k.push(h):b.match[t]=[h]}else s.set(y,{score:z,terms:[e],match:{[t]:[h]}})}}return s}addTerm(e,t,o){const i=this._index.fetch(o,co);let a=i.get(e);if(a==null)a=new Map,a.set(t,1),i.set(e,a);else{const l=a.get(t);a.set(t,(l||0)+1)}}removeTerm(e,t,o){if(!this._index.has(o)){this.warnDocumentChanged(t,e,o);return}const i=this._index.fetch(o,co),a=i.get(e);a==null||a.get(t)==null?this.warnDocumentChanged(t,e,o):a.get(t)<=1?a.size<=1?i.delete(e):a.delete(t):a.set(t,a.get(t)-1),this._index.get(o).size===0&&this._index.delete(o)}warnDocumentChanged(e,t,o){for(const i of Object.keys(this._fieldIds))if(this._fieldIds[i]===t){this._options.logger("warn",`MiniSearch: document with ID ${this._documentIds.get(e)} has changed before removal: term "${o}" was not present in field "${i}". Removing a document after it has changed can corrupt the index!`,"version_conflict");return}}addDocumentId(e){const t=this._nextId;return this._idToShortId.set(e,t),this._documentIds.set(t,e),this._documentCount+=1,this._nextId+=1,t}addFields(e){for(let t=0;t<e.length;t++)this._fieldIds[e[t]]=t}addFieldLength(e,t,o,i){let a=this._fieldLength.get(e);a==null&&this._fieldLength.set(e,a=[]),a[t]=i;const d=(this._avgFieldLength[t]||0)*o+i;this._avgFieldLength[t]=d/(o+1)}removeFieldLength(e,t,o,i){if(o===1){this._avgFieldLength[t]=0;return}const a=this._avgFieldLength[t]*o-i;this._avgFieldLength[t]=a/(o-1)}saveStoredFields(e,t){const{storeFields:o,extractField:i}=this._options;if(o==null||o.length===0)return;let a=this._storedFields.get(e);a==null&&this._storedFields.set(e,a={});for(const l of o){const d=i(t,l);d!==void 0&&(a[l]=d)}}}Ut.wildcard=Symbol("*");const bn=(n,e)=>Object.prototype.hasOwnProperty.call(n,e)?n[e]:void 0,qi={[Un]:(n,e)=>{for(const t of e.keys()){const o=n.get(t);if(o==null)n.set(t,e.get(t));else{const{score:i,terms:a,match:l}=e.get(t);o.score=o.score+i,o.match=Object.assign(o.match,l),ao(o.terms,a)}}return n},[Lo]:(n,e)=>{const t=new Map;for(const o of e.keys()){const i=n.get(o);if(i==null)continue;const{score:a,terms:l,match:d}=e.get(o);ao(i.terms,l),t.set(o,{score:i.score+a,terms:i.terms,match:Object.assign(i.match,d)})}return t},[Zi]:(n,e)=>{for(const t of e.keys())n.delete(t);return n}},es={k:1.2,b:.7,d:.5},ts=(n,e,t,o,i,a)=>{const{k:l,b:d,d:c}=a;return Math.log(1+(t-e+.5)/(e+.5))*(c+n*(l+1)/(n+l*(1-d+d*o/i)))},ns=n=>(e,t,o)=>{const i=typeof n.fuzzy=="function"?n.fuzzy(e,t,o):n.fuzzy||!1,a=typeof n.prefix=="function"?n.prefix(e,t,o):n.prefix===!0,l=typeof n.boostTerm=="function"?n.boostTerm(e,t,o):1;return{term:e,fuzzy:i,prefix:a,termBoost:l}},Sn={idField:"id",extractField:(n,e)=>n[e],stringifyField:(n,e)=>n.toString(),tokenize:n=>n.split(is),processTerm:n=>n.toLowerCase(),fields:void 0,searchOptions:void 0,storeFields:[],logger:(n,e)=>{typeof console?.[n]=="function"&&console[n](e)},autoVacuum:!0},so={combineWith:Un,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:es},os={combineWith:Lo,prefix:(n,e,t)=>e===t.length-1},zn={batchSize:1e3,batchWait:10},Pn={minDirtFactor:.1,minDirtCount:20},xn={...zn,...Pn},rs=(n,e)=>{n.includes(e)||n.push(e)},ao=(n,e)=>{for(const t of e)n.includes(t)||n.push(t)},lo=({score:n},{score:e})=>e-n,co=()=>new Map,en=n=>{const e=new Map;for(const t of Object.keys(n))e.set(parseInt(t,10),n[t]);return e},tn=async n=>{const e=new Map;let t=0;for(const o of Object.keys(n))e.set(parseInt(o,10),n[o]),++t%1e3===0&&await zo(0);return e},zo=n=>new Promise(e=>setTimeout(e,n)),is=/[\n\r\p{Z}\p{P}]+/u,ss=/[A-Za-z0-9_\-]+/g,as=new Set(["the","and","for","are","that","this","from","with","have","your","what","when","where","which","will","would","about","into","then","than","there","they","them","you","how","can","use","using","used","been","also","was","were","has","had","our"]),ls=["ingly","edly","ing","ed","ies","es","ly","s"];function cs(n){if(n.length<=2)return[n];const e=new Set([n]),t=[n];for(;t.length>0;){const o=t.shift();if(o)for(const i of ls){if(!o.endsWith(i)||o.length<=i.length+2)continue;let a=o.slice(0,-i.length);i==="ies"&&a.length>1&&(a=`${a}y`),!(a.length<=2)&&(e.has(a)||(e.add(a),t.push(a)))}}return[...e]}function On(n){const t=n.toLowerCase().match(ss);return t?t.flatMap(o=>cs(o).map(i=>i.trim()).filter(i=>i.length>1&&!as.has(i))):[]}function ds(n,e,t){if(n.length<=e)return[n];const o=[];let i=0;const a=Math.max(e-t,100);for(;i<n.length;){const l=Math.min(i+e,n.length);if(o.push(n.slice(i,l).trim()),l===n.length)break;i+=a}return o.filter(Boolean)}function us(n){const e=[],t=new Map;for(const i of n.docs){const a=ds(i.content,n.retrieval.chunkSize,n.retrieval.overlap);let l=0;for(const d of a){const c=On(d),s=`${i.id}#${l}`;l+=1;const h={docId:s,docTitle:i.title,content:d,contentTokenCount:c.length};e.push(h),t.set(s,h)}}const o=new Ut({idField:"id",fields:["docTitle","content"],storeFields:["docTitle","content"],tokenize:On,searchOptions:{prefix:!0}});for(const i of e)o.add({...i,id:`${i.docId}`});return{chunks:e,topK:n.retrieval.topK,searchIndex:o,chunkById:t}}function fs(n,e,t=n.topK){return On(e).length===0||n.chunks.length===0?[]:n.searchIndex.search(e,{limit:t,prefix:!0,fuzzy:.15}).map(l=>{const d=n.chunkById.get(l.id);return d?{docTitle:l.docTitle??d.docTitle,content:l.content??d.content,score:l.score}:null}).filter(l=>!!l).sort((l,d)=>d.score-l.score).slice(0,t)}function hs(n,e){return n.length<=e?n:`${n.slice(0,Math.max(e-16,32)).trimEnd()}
...[truncated]`}function ps(n,e=12e3){if(n.length===0)return"";const t=[];let o=0;for(let i=0;i<n.length;i+=1){const a=n[i],l=hs(a.content,2200),d=`[${i+1}] ${a.docTitle}
${l}`,c=o+d.length+2;if(c>e)break;t.push(d),o=c}return t.join(`

`)}function Cn(){return`${Date.now()}-${Math.random().toString(36).slice(2,10)}`}function kn(n){const e=Tt(n),t=JSON.stringify(e);let o=2166136261;for(let i=0;i<t.length;i++)o^=t.charCodeAt(i),o+=(o<<1)+(o<<4)+(o<<7)+(o<<8)+(o<<24);return(o>>>0).toString(16).padStart(8,"0")}function vs(){return typeof window>"u"?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function uo(n){return new Date(n).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function fo(n,e){return"modal"}function ms(n,e,t,o){const i=[],a=[];e.systemPrompt.trim()&&a.push(e.systemPrompt.trim()),t.trim()&&a.push(`Ground answers in the supplied context whenever possible. If context is insufficient, clearly say what is missing.

Context:
${t}`),a.length>0&&i.push({role:"system",content:a.join(`

`)});const l=n.slice(-12);for(const d of l)i.push({role:d.role,content:d.content});return i}function ho(n){return us(n)}function gs(n){if(typeof n!="object"||n===null)return!1;const e=n;return typeof e.id=="string"&&(e.role==="user"||e.role==="assistant")&&typeof e.content=="string"&&typeof e.createdAt=="number"}function Po(n){const e=n.find(o=>o.role==="user");if(!e)return"New Conversation";const t=e.content.replace(/\s+/g," ").trim();return t?t.length>40?`${t.slice(0,40)}...`:t:"New Conversation"}function _s(n,e){const t=typeof n=="string"?n.trim():"";return t||Po(e)}function ys(n){const e=Date.now();return{id:`${e}-${Math.random().toString(36).slice(2,10)}`,title:"New Conversation",messages:[],createdAt:e,updatedAt:e,payloadDigest:n}}function ws(n,e){if(typeof n!="object"||n===null)return null;const t=n;if(typeof t.id!="string"||!t.id.trim())return null;const i=(Array.isArray(t.messages)?t.messages:[]).filter(gs),a=Number(t.createdAt)||Date.now(),l=Number(t.updatedAt)||a,d=_s(typeof t.title=="string"?t.title:"",i);return{id:t.id,title:d,messages:i,createdAt:a,updatedAt:l,payloadDigest:typeof t.payloadDigest=="string"?t.payloadDigest:e}}const Rt="static-rag-chat",po=["openai","anthropic","gemini"],In=`${Rt}:payload-draft`,vo=`${Rt}:theme`,bs=`${Rt}:left-rail-collapsed`,Ss=`${Rt}:chat-sessions`,An=24,xs=12,Cs=12e3,mo="(max-width: 1100px)",Mn="(max-width: 760px)";var ks=V('<button type="button" aria-label="Close side menu"></button>'),Is=V('<button type="button" class="context-sheet-backdrop" aria-label="Close context"></button>'),As=V("<!> <!>",1),Ms=V('<div class="app-shell"><!> <!> <!> <!></div> <!>',1);function Ts(n,e){jt(e,!1);const t=F();let o=F("openai"),i=F(""),a=F(zt.openai),l=F([]),d=F(!1),c=F(""),s=F(oo()),h=F(_n(r(s))),g=F(""),f=F(""),S=F(!1),M=F(""),C=F([]),y=F(""),I=F([]),E=F([]),O=F(""),T=F(ho(r(s))),z=null,b=null,k=F(!1),A=F("connection"),ve=F("modal"),W=F(!1),_e=F("light"),se=F(!1),ke=F(!1),Z=F(!1),oe=F(!1),Ne=F(!1),at=F(!1),lt=F(!1),Je=F(0),Ie=F(0),ct=F("New Conversation"),He=F(r(s).title),Ve=F(r(s).systemPrompt),We=F(r(s).retrieval.topK),Ge=F(r(s).retrieval.chunkSize),B=F(r(s).retrieval.overlap),J=F(""),q=F(""),Ce=F("");function $e(){return typeof window<"u"?window.matchMedia(Mn).matches:!1}let Fe=F(0),Ae=F(0),Me=F("ok"),me="",we=null;const be={openai:null,anthropic:null,gemini:null};function et(){return bs}function je(){typeof window>"u"||window.localStorage.getItem(et())}function Re(u){return`${Ss}:${u}`}function bt(){if(typeof window>"u")return;const u=window.localStorage.getItem(vo);if(u==="light"||u==="dark"){p(_e,u);return}p(_e,vs())}function Be(u){p(_e,u),typeof window<"u"&&window.localStorage.setItem(vo,u),p(f,`Theme: ${u}`)}function dt(){Be(r(_e)==="dark"?"light":"dark")}function Ke(u="connection",x){p(A,u),p(ve,x??fo(r(Z))),p(k,!0),p(oe,!1),p(se,!1),u==="connection"&&P()}function ut(){p(k,!1)}function D(){const u=$e();p(Z,u),u&&(X(),p(oe,!0))}function $(){p(oe,!1)}function Le(){if(r(oe)){$();return}D()}function mt(){p(se,!r(se))}function X(){p(se,!1)}function fe(){Zt(),X()}function H(u){return`${Rt}:api:${u}`}function ee(u){return`${Rt}:model:${u}`}function Se(u){return`${Rt}:api-save:${u}`}function he(){return`${Rt}:provider`}function ae(u){if(typeof window>"u")return!1;const x=window.localStorage.getItem(Se(u));return x==="true"||x==="false"?x==="true":!!window.localStorage.getItem(H(u))}function re(){p(He,r(s).title),p(Ve,r(s).systemPrompt),p(We,r(s).retrieval.topK),p(Ge,r(s).retrieval.chunkSize),p(B,r(s).retrieval.overlap)}function Y(u){const x=r(ke)?window.localStorage.getItem(H(u))??"":"";return(r(i)||x||mn(u)).trim()}function ie(u,x,R){const G=zt[R];return x.includes(u)?u:G&&x.includes(G)?G:x[0]||u||G}async function P(){if(typeof window>"u")return;const u=Y(r(o));if(!u){p(l,[]),p(a,r(a).trim()||zt[r(o)]),p(c,"API key is required to load models.");return}const x=be[r(o)];if(x&&x.key===u){p(l,x.models),p(a,ie(r(a),r(l),r(o))),Q(),p(c,"");return}p(d,!0),p(c,"");try{const R=await zr(r(o),u);be[r(o)]={key:u,models:R},p(l,R),p(a,ie(r(a),r(l),r(o))),r(a).trim()||p(a,zt[r(o)]),Q()}catch(R){p(c,R instanceof Error?R.message:"Failed to fetch model list.")}finally{p(d,!1)}}function ce(){we&&clearTimeout(we),we=setTimeout(()=>{P()},700)}function ge(){if(typeof window>"u")return;const u=window.localStorage.getItem(he());(u==="openai"||u==="anthropic"||u==="gemini")&&p(o,u),p(ke,ae(r(o))),p(a,window.localStorage.getItem(ee(r(o)))??zt[r(o)]);const x=r(ke)?window.localStorage.getItem(H(r(o)))??"":"";p(i,x.trim()||mn(r(o))),P()}function Q(){typeof window>"u"||(window.localStorage.setItem(he(),r(o)),window.localStorage.setItem(ee(r(o)),r(a)),window.localStorage.setItem(Se(r(o)),String(r(ke))),r(ke)?window.localStorage.setItem(H(r(o)),r(i)):window.localStorage.removeItem(H(r(o))))}function tt(u){const R=u.currentTarget.checked;if(R&&typeof window<"u"){const G=window.localStorage.getItem(H(r(o)));G&&(window.alert("An API key already exists in localStorage for this browser. Enabling this will overwrite it with your current input."),r(i).trim()||p(i,G))}p(ke,R),Q()}function gt(u,x={}){const R=r(C).find(G=>G.id===u);R&&(p(y,R.id),p(I,[...R.messages]),p(E,[]),p(W,!1),p(M,""),X(),x.focusComposer)}function ft(u){const x=r(C).findIndex(G=>G.id===r(y));if(x===-1)return;const R=Po(u);Yn(C,r(C)[x]={...r(C)[x],messages:u,title:r(C)[x].title==="New Conversation"?R:r(C)[x].title,updatedAt:Date.now()}),p(I,u),p(C,[...r(C).sort((G,xe)=>xe.updatedAt-G.updatedAt)]),ze()}function St(){const u=kn(r(s));u&&(u!==me&&(me=u,Ye()),(!r(y)||!r(C).some(x=>x.id===r(y)))&&le())}function ze(){if(typeof window>"u"||!me)return;const u=r(C).map(x=>({...x,messages:x.messages.slice(-120)})).slice(0,An);window.localStorage.setItem(Re(me),JSON.stringify(u))}function Ye(){if(typeof window>"u")return;me||(me=kn(r(s)));const u=window.localStorage.getItem(Re(me));if(!u){p(C,[]),le();return}try{const x=JSON.parse(u);if(!Array.isArray(x))throw new Error("Invalid session list");const R=x.map(xe=>ws(xe,me)).filter(xe=>xe!==null).sort((xe,Pe)=>Pe.updatedAt-xe.updatedAt).slice(0,An);p(C,R);const G=r(C)[0];G?gt(G.id):le()}catch{window.localStorage.removeItem(Re(me)),p(C,[]),le()}}function le(){me||(me=kn(r(s)));const u=ys(me);p(C,[u,...r(C)].slice(0,An)),p(y,u.id),p(I,[]),p(E,[]),p(W,!1),p(f,"Started new chat"),p(M,""),ze()}function Ue(u,x){if(u.preventDefault(),u.stopPropagation(),!!window.confirm("Delete this conversation?")){if(p(C,r(C).filter(R=>R.id!==x)),r(y)===x){le();return}if(!r(C).length){le();return}ze(),p(f,"Chat deleted")}}function Qe(u,x){const R=r(C).findIndex(xe=>xe.id===u);if(R<0)return;const G=x.trim();if(!G){p(f,"Conversation title is empty. Keeping previous title.");return}Yn(C,r(C)[R]={...r(C)[R],title:G,updatedAt:Date.now()}),p(C,[...r(C)]),ze(),p(f,"Conversation renamed")}function nt(){typeof window>"u"||window.localStorage.setItem(In,_n(r(s)))}function te(){if(typeof window>"u")return!1;const u=window.localStorage.getItem(In);if(!u)return!1;try{const x=JSON.parse(u),R=Tt(x);return Te(R,{syncHash:!1,statusMessage:`Loaded local draft (${R.docs.length} doc(s))`}),!0}catch{return window.localStorage.removeItem(In),!1}}function U(){if(typeof window>"u")return;const u=ro(r(s));p(O,`${window.location.origin}${window.location.pathname}${window.location.search}${u}`)}function ye(){if(typeof window>"u")return;const u=ro(r(s));window.location.hash!==u&&window.history.replaceState(null,"",u),U()}function Te(u,x={}){p(s,Tt(u)),p(h,_n(r(s))),p(g,""),re(),nt(),St(),x.statusMessage&&p(f,x.statusMessage),x.syncHash===!1?U():ye()}function Xe(){if(typeof window>"u")return!1;const{payload:u,error:x}=io(window.location.hash);return u?(Te(u,{syncHash:!1,statusMessage:`URL payload loaded (${u.docs.length} doc(s))`}),!0):x?(p(g,`Failed to parse URL payload: ${x}`),p(f,""),U(),!1):(U(),!1)}function It(u){const R=u.currentTarget.value;if(po.includes(R)){if(p(o,R),typeof window<"u"){p(a,window.localStorage.getItem(ee(r(o)))??zt[r(o)]),p(ke,ae(r(o)));const G=r(ke)?window.localStorage.getItem(H(r(o)))??"":"";p(i,G.trim()||mn(r(o)))}Q(),P()}}function ot(u){const x=u.currentTarget;p(i,x.value),Q(),ce()}function ht(u){const x=u.currentTarget;p(a,x.value),Q()}function rt(){try{const u=Tt({...r(s),title:r(He),systemPrompt:r(Ve),retrieval:{topK:Number(r(We)),chunkSize:Number(r(Ge)),overlap:Number(r(B))}});Te(u,{statusMessage:"Builder settings updated"})}catch(u){const x=u instanceof Error?u.message:"Invalid settings";p(g,x),p(f,"")}}function de(){try{const u=JSON.parse(r(h)),x=Tt(u);Te(x,{statusMessage:`Payload updated (${x.docs.length} doc(s))`})}catch(u){const x=u instanceof Error?u.message:"Invalid payload JSON";p(g,x),p(f,"")}}function Ze(){Te(oo(),{statusMessage:"Payload reset to sample"})}function Dt(){const u=r(q).trim(),x=r(J).trim();if(!u){p(g,"Document content cannot be empty."),p(f,"");return}const R={id:`doc-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,title:x||`Document ${r(s).docs.length+1}`,content:u};Te({...r(s),docs:[...r(s).docs,R]},{statusMessage:`Added document: ${R.title}`}),p(J,""),p(q,"")}function Ht(u){const x=r(s).docs.filter(R=>R.id!==u);Te({...r(s),docs:x},{statusMessage:`Removed document. ${x.length} doc(s) left.`})}function Wt(u){return u.replace(/\.[^.]+$/,"").replace(/[_-]+/g," ").trim()||u}async function Gt(u){if(u.length===0)return;if(p(g,""),p(f,"Importing files..."),u.length===1&&u[0].name.toLowerCase().endsWith(".json")){const R=await u[0].text();try{const G=JSON.parse(R),xe=Tt(G);Te(xe,{statusMessage:`Imported payload from ${u[0].name}`});return}catch{}}const x=[];for(const R of u){const G=(await R.text()).trim();G&&x.push({id:`doc-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,title:Wt(R.name),content:G})}if(x.length===0){p(f,""),p(g,"No readable content found in imported files.");return}Te({...r(s),docs:[...r(s).docs,...x]},{statusMessage:`Imported ${x.length} file(s)`})}function dn(u){const x=u.currentTarget,R=x.files?Array.from(x.files):[];x.value="",Gt(R)}function un(){const u=r(Ce).trim();if(!u)return;let x="";if(u.startsWith("#"))x=u;else try{x=new URL(u).hash}catch{x=`#r=${u}`}if(!x){p(g,"Input URL does not contain a payload hash."),p(f,"");return}const{payload:R,error:G}=io(x);if(!R){p(g,G?`Failed to import URL payload: ${G}`:"Failed to import URL payload."),p(f,"");return}Te(R,{statusMessage:`Imported payload from URL (${R.docs.length} doc(s))`}),p(Ce,"")}async function Xt(){if(!r(O)){p(f,"No share URL available");return}try{await navigator.clipboard.writeText(r(O)),p(f,"Share URL copied")}catch{p(f,"Clipboard access failed. Copy from the field manually.")}}function Zt(){le()}async function qt(){if(!r(at))return;St(),r(y)||le(),p(g,""),p(f,"");const u=r(M).trim();p(M,"");const x={id:Cn(),role:"user",content:u,createdAt:Date.now()},R=[...r(I),x];ft(R),p(E,fs(r(T),u,r(s).retrieval.topK)),p(W,r(E).length>0);const G=ps(r(E),Cs);p(S,!0);const xe=new AbortController;z=xe;try{const Pe=await jr({provider:r(o),apiKey:r(i).trim(),model:r(a).trim()||zt[r(o)],messages:ms(R,r(s),G,xs),signal:xe.signal});ft([...R,{id:Cn(),role:"assistant",content:Pe,createdAt:Date.now()}]),p(f,`Response generated with ${kt[r(o)]}`)}catch(Pe){if(Pe instanceof DOMException&&Pe.name==="AbortError"){p(f,"Generation canceled");return}const xt=Pe instanceof Error?Pe.message:"Request failed";p(g,xt),ft([...R,{id:Cn(),role:"assistant",content:xt,createdAt:Date.now(),isError:!0}])}finally{p(S,!1),z=null}}function Oo(u){u.preventDefault(),qt()}function Do(u){u.isComposing||u.key==="Process"||u.keyCode===229||u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),qt())}function No(u){const x=u.currentTarget;p(M,x.value)}function Vn(){if(typeof window>"u"){p(Z,!1),p(oe,!1),p(se,!1);return}window.matchMedia(mo).matches,p(Z,window.matchMedia(Mn).matches),r(Z)||p(oe,!1),r(k)&&p(ve,fo(r(Z)))}function Fo(){z&&z.abort()}Go(()=>{if(Vn(),bt(),ge(),je(),!Xe()){const xt=window.location.hash.length===0,Bo=xt?te():!1;xt&&!Bo&&ye()}St();const x=()=>{Xe(),St()},R=xt=>{if(xt.key==="Escape"){if(r(oe)){p(oe,!1);return}if(r(se)){p(se,!1);return}ut()}},G=window.matchMedia(mo),xe=window.matchMedia(Mn),Pe=()=>Vn();return G.addEventListener("change",Pe),xe.addEventListener("change",Pe),window.addEventListener("hashchange",x),window.addEventListener("keydown",R),()=>{G.removeEventListener("change",Pe),xe.removeEventListener("change",Pe),window.removeEventListener("hashchange",x),window.removeEventListener("keydown",R),typeof document<"u"&&(document.body.style.overflow="")}}),pt(()=>r(s),()=>{p(T,ho(r(s)))}),pt(()=>r(i),()=>{p(Ne,r(i).trim().length>0)}),pt(()=>(r(S),r(Ne),r(M)),()=>{p(at,!r(S)&&r(Ne)&&r(M).trim().length>0)}),pt(()=>r(I),()=>{p(lt,r(I).length>0)}),pt(()=>r(s),()=>{p(Je,r(s).docs.length)}),pt(()=>r(s),()=>{p(Ie,r(s).docs.reduce((u,x)=>u+x.content.length,0))}),pt(()=>(r(C),r(y)),()=>{p(ct,r(C).find(u=>u.id===r(y))?.title??"New Conversation")}),pt(()=>r(s),()=>{try{p(Fe,Io(r(s)).length)}catch{p(Fe,0)}}),pt(()=>r(O),()=>{p(Ae,r(O).length)}),pt(()=>(r(Ae),r(Fe)),()=>{r(Ae)>=7800||r(Fe)>=7200?p(Me,"danger"):r(Ae)>=4500||r(Fe)>=4e3?p(Me,"warn"):p(Me,"ok")}),pt(()=>(r(_e),r(k),r(se),r(Z),r(oe)),()=>{typeof document<"u"&&(document.documentElement.dataset.theme=r(_e),document.documentElement.style.colorScheme=r(_e),document.body.style.overflow=r(k)||r(se)||r(Z)&&r(oe)?"hidden":"")}),pt(()=>(r(Z),r(oe)),()=>{p(t,!r(Z)||r(oe))}),Sr(),Vt();var jn=Ms(),fn=Ee(jn),Bn=m(fn);{var Ko=u=>{var x=ks();qe(x,1,"left-rail-backdrop",null,{},{open}),N("click",x,X),L(u,x)};pe(Bn,u=>{r(se)&&u(Ko)})}var Jn=_(Bn,2);Ai(Jn,{get mobileOpen(){return r(se)},get payloadTitle(){return r(s),K(()=>r(s).title)},get docCount(){return r(Je)},get docChars(){return r(Ie)},get providerLabel(){return ne(kt),r(o),K(()=>kt[r(o)])},get model(){return r(a)},get chatSessions(){return r(C)},get activeSessionId(){return r(y)},get urlRisk(){return r(Me)},get urlLength(){return r(Ae)},get encodedLength(){return r(Fe)},get theme(){return r(_e)},get formatMessageTime(){return uo},onStartNewSession:fe,onCloseMobileRail:X,onOpenSettings:Ke,onToggleTheme:dt,onSetActiveSession:gt,onDeleteSession:Ue,onRenameSession:Qe,onCopyShareUrl:Xt});var Hn=_(Jn,2);ci(Hn,{get mobileLeftRailOpen(){return r(se)},get activeSessionTitle(){return r(ct)},get payloadTitle(){return r(s),K(()=>r(s).title)},get hasApiKey(){return r(Ne)},get providerLabel(){return ne(kt),r(o),K(()=>kt[r(o)])},get hasConversation(){return r(lt)},get chatMessages(){return r(I)},get canSend(){return r(at)},get loading(){return r(S)},get prompt(){return r(M)},get mobileContextOpen(){return r(oe)},get ragDocs(){return r(s),K(()=>r(s).docs)},get formatMessageTime(){return uo},onToggleLeftRail:mt,onClearChat:Zt,onToggleContext:Le,onOpenSettings:Ke,onSubmit:Oo,onPromptInput:No,onPromptKeydown:Do,onStopGeneration:Fo,bindComposerTextarea:b});var Uo=_(Hn,2);{var Vo=u=>{var x=As(),R=Ee(x);{var G=Pe=>{var xt=Is();N("click",xt,$),L(Pe,xt)};pe(R,Pe=>{r(Z)&&Pe(G)})}var xe=_(R,2);wi(xe,{get isNarrowViewport(){return r(Z)},get mobileContextOpen(){return r(oe)},get retrievedChunks(){return r(E)},get showRetrievedContext(){return r(W)},get providerLabel(){return ne(kt),r(o),K(()=>kt[r(o)])},get model(){return r(a)},get hasApiKey(){return r(Ne)},get payloadError(){return r(g)},get status(){return r(f)},onClose:$,onToggleRetrievedContext:()=>{p(W,!r(W))},onOpenSettings:Ke}),L(u,x)};pe(Uo,u=>{r(t)&&u(Vo)})}v(fn);var jo=_(fn,2);Bi(jo,{get settingsOpen(){return r(k)},get settingsPresentation(){return r(ve)},get settingsTab(){return r(A)},get providers(){return po},get provider(){return r(o)},get theme(){return r(_e)},get model(){return r(a)},get modelOptions(){return r(l)},get isModelCatalogLoading(){return r(d)},get modelCatalogError(){return r(c)},get apiKey(){return r(i)},get persistApiKey(){return r(ke)},get payloadError(){return r(g)},get status(){return r(f)},get docCount(){return r(Je)},get docChars(){return r(Ie)},get docs(){return r(s),K(()=>r(s).docs)},onClose:ut,onSetTheme:Be,onSelectTab:Ke,onProviderChange:It,onApiKeyInput:ot,onApiKeySaveToggle:tt,onModelInput:ht,onRefreshModels:()=>{P()},onApplyBuilderSettings:rt,onAddDocument:Dt,onRemoveDocument:Ht,onFileInput:dn,onApplyImportUrl:un,onApplyPayloadJson:de,onResetPayload:Ze,get titleInput(){return r(He)},set titleInput(u){p(He,u)},get systemPromptInput(){return r(Ve)},set systemPromptInput(u){p(Ve,u)},get topKInput(){return r(We)},set topKInput(u){p(We,u)},get chunkSizeInput(){return r(Ge)},set chunkSizeInput(u){p(Ge,u)},get overlapInput(){return r(B)},set overlapInput(u){p(B,u)},get newDocTitle(){return r(J)},set newDocTitle(u){p(J,u)},get newDocContent(){return r(q)},set newDocContent(u){p(q,u)},get importUrl(){return r(Ce)},set importUrl(u){p(Ce,u)},get payloadJson(){return r(h)},set payloadJson(u){p(h,u)},$$legacy:!0}),L(n,jn),Bt()}function Fs(n){Ts(n,{})}export{Fs as component};
